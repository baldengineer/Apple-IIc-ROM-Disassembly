<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="SGStyle.css"/>

    <meta name="description" content="SourceGen-generated disassembly of Apple IIc bank1 of 03-342-0445 - A.bin"/>
    <title>Apple IIc bank1 of 03-342-0445 - A.bin Disassembly</title>
</head>

<body>

<p style="font-size:smaller;"><a href="./">(back to project page)</a></p>
<h1>Apple IIc bank1 of 03-342-0445 - A.bin Disassembly</h1>

<div id="code-lines">
    <!-- The CodeLines marker is not optional, and may only appear once -->
<pre>                   ********************************************************************************
                   * Apple IIc ROM3 (slinky)  - Bank 1                                            *
                   * Re-created by James Lewis (@baldengineer)                                    *
                   * ******************************************************************           *
                   *  2023-03-05 v0.9: Decode of bank 1 done                                      *
                   *                   Needs lots of proof-reading!                               *
                   *                     Skipped AppleSoft ($D000-$F7FF).                         *
                   *                     Left ROM Switch Rountines ($C780) un-decoded             *
                   *                      (SourceGen doesn't like the bank 2 addrs)               *
                   * ******************************************************************           *
                   *                                                                              *
                   * For more information visit:                                                  *
                   * https://github.com/baldengineer/Apple-IIc-ROM-Disassembly                    *
                   *                                                                              *
                   * (Original attributions are in comments below, as shown in original ROM       *
                   * Listings.)                                                                   *
                   *                                                                              *
                   * Recreated work licensed as Attribution-NonCommercial-ShareAlike 4.0          *
                   * International.                                                               *
                   *                                                                              *
                   * Generated with 6502bench SourceGen v1.8.4                                    *
                   ********************************************************************************
                   <span id="SymM_Mouse">M_Mouse</span>         EQU     $01    {const}    ;Don't print mouse chars
                   <span id="SymM_VMODE">M_VMODE</span>         EQU     $04    {const}
                   <span id="SymGOODF8">GOODF8</span>          EQU     $06    {const}    ;value of //e, lolly ID byte
                   <span id="SymM_CTL">M_CTL</span>           EQU     $08    {const}    ;Don't print controls
                   <span id="SymM_GOXY">M_GOXY</span>          EQU     $08    {const}    ;GOTOXY IN PROGRESS
                   <span id="SymYHI">YHI</span>             EQU     $08    {const}    ;$CD00-$CCF8
                   <span id="SymM_CURSOR">M_CURSOR</span>        EQU     $10    {const}    ;Don't print cursor
                   <span id="SymESCNUM">ESCNUM</span>          EQU     $13    {const}    ;$CD0C-ESCTAB-1
                   <span id="SymNUMOPS">NUMOPS</span>          EQU     $16    {const}    ;*-OPTBL-1 ; number of bytes to check
                   <span id="SymM_CTL2">M_CTL2</span>          EQU     $20    {const}    ;Don't print controls
                   <span id="Symxon">xon</span>             EQU     $91    {const}    ;XON character
                   <span id="SymPICK">PICK</span>            EQU     $95    {const}    ;CONTROL-U character
                   <span id="SymESC">ESC</span>             EQU     $9B    {const}    ;what ESC generates
                   <span id="Symflags">flags</span>           EQU     $06B8  {const}    ;D7 = Video echo D6 = CRLF 779 &amp; 77A
                   <span id="SymLOC0">LOC0</span>            EQU     $00    {addr/1}   ;vector for autostart from disk
                   <span id="SymLOC1">LOC1</span>            EQU     $01    {addr/1}
                   <span id="Symbadcmd">badcmd</span>          EQU     $01               ;bad command
                   <span id="Symibslot">ibslot</span>          EQU     $01               ;slot * 16
                   <span id="Sympnull">pnull</span>           EQU     $02
                   <span id="SymInitCMD">InitCMD</span>         EQU     $05
                   <span id="Symzused">zused</span>           EQU     $0A               ;tempptr-cmmand+2 ;zero page bytes used
                   <span id="Symibstat">ibstat</span>          EQU     $0D               ;status
                   <span id="Symbadunit">badunit</span>         EQU     $11               ;bad unit number
                   <span id="Sympcrevnum">pcrevnum</span>        EQU     $11               ;smartport rev 1.1
                   <span id="SymWNDLFT">WNDLFT</span>          EQU     $20    {addr/1}   ;left edge of text window
                   <span id="SymWNDWDTH">WNDWDTH</span>         EQU     $21    {addr/1}   ;width of text window
                   <span id="SymWNDTOP">WNDTOP</span>          EQU     $22    {addr/1}   ;top of text window
                   <span id="SymWNDBTM">WNDBTM</span>          EQU     $23    {addr/1}   ;bottom+1 of text window
                   <span id="SymCH">CH</span>              EQU     $24    {addr/1}   ;cursor horizontal position
                   <span id="SymCV">CV</span>              EQU     $25    {addr/1}   ;cursor vertical position
                   <span id="SymGBASL">GBASL</span>           EQU     $26    {addr/1}   ;lo-res graphics base addr.
                   <span id="SymGBASH">GBASH</span>           EQU     $27    {addr/1}
                   <span id="SymBASL">BASL</span>            EQU     $28    {addr/1}   ;text base address
                   <span id="Symnderr">nderr</span>           EQU     $28               ;no device error
                   <span id="SymBASH">BASH</span>            EQU     $29    {addr/1}
                   <span id="SymBAS2L">BAS2L</span>           EQU     $2A    {addr/1}   ;temp base for scrolling
                   <span id="SymSLOTZ">SLOTZ</span>           EQU     $2B               ;Disk II boot rom equate
                   <span id="SymH2">H2</span>              EQU     $2C    {addr/1}   ;temp for lo-res graphics
                   <span id="SymLMNEM">LMNEM</span>           EQU     $2C    {addr/1}   ;temp for mnemonic decoding
                   <span id="SymRTNL">RTNL</span>            EQU     $2C    {addr/1}   ;Step return address
                   <span id="SymRMNEM">RMNEM</span>           EQU     $2D    {addr/1}   ;temp for mnemonic decoding
                   <span id="Symrtnh">rtnh</span>            EQU     $2D    {addr/1}   ;Step return address
                   <span id="SymV2">V2</span>              EQU     $2D    {addr/1}   ;temp for lo-res graphics
                   <span id="SymFORMAT">FORMAT</span>          EQU     $2E    {addr/1}   ;temp for opcode decode
                   <span id="SymMASK">MASK</span>            EQU     $2E    {addr/1}   ;color mask for lo-res gr.
                   <span id="SymLENGTH">LENGTH</span>          EQU     $2F    {addr/1}   ;temp for opcode decode
                   <span id="SymCOLOR">COLOR</span>           EQU     $30    {addr/1}   ;color for lo-res graphics
                   <span id="SymMODE">MODE</span>            EQU     $31    {addr/1}   ;Monitor mode
                   <span id="SymINVFLG">INVFLG</span>          EQU     $32    {addr/1}   ;normal/inverse(/flash)
                   <span id="SymPROMPT">PROMPT</span>          EQU     $33    {addr/1}   ;prompt characater
                   <span id="SymYSAV">YSAV</span>            EQU     $34    {addr/1}   ;position in Monitor command
                   <span id="SymYSAV1">YSAV1</span>           EQU     $35    {addr/1}   ;temp for Y register
                   <span id="SymCSWL">CSWL</span>            EQU     $36    {addr/1}   ;character output hook
                   <span id="SymCSWH">CSWH</span>            EQU     $37    {addr/1}
                   <span id="SymKSWL">KSWL</span>            EQU     $38    {addr/1}   ;character output hook
                   <span id="SymKSWH">KSWH</span>            EQU     $39    {addr/1}
                   <span id="SymPCL">PCL</span>             EQU     $3A    {addr/1}   ;temp for program counter
                   <span id="SymPCH">PCH</span>             EQU     $3B    {addr/1}
                   <span id="SymA1L">A1L</span>             EQU     $3C    {addr/1}   ;Monitor Temp
                   <span id="SymBOOTTMP">BOOTTMP</span>         EQU     $3C               ;Disk II boot rom equate
                   <span id="Symxqt">xqt</span>             EQU     $3C
                   <span id="SymA1H">A1H</span>             EQU     $3D    {addr/1}   ;Monitor Temp
                   <span id="SymA2L">A2L</span>             EQU     $3E    {addr/1}   ;Monitor Temp
                   <span id="SymA2H">A2H</span>             EQU     $3F    {addr/1}   ;Monitor Temp
                   <span id="SymA3L">A3L</span>             EQU     $40    {addr/1}   ;Monitor Temp
                   <span id="SymA3H">A3H</span>             EQU     $41    {addr/1}   ;Monitor Temp
                   <span id="SymA4L">A4L</span>             EQU     $42    {addr/1}   ;Monitor Temp
                   <span id="Symcmmand">cmmand</span>          EQU     $42               ;command to be executed
                   <span id="SymA4H">A4H</span>             EQU     $43    {addr/1}   ;Monitor Temp
                   <span id="Symunit">unit</span>            EQU     $43               ;D&lt;6-4&gt; = slot
                   <span id="SymA5L">A5L</span>             EQU     $44    {addr/1}   ;Monitor Temp
                   <span id="SymMACSTAT">MACSTAT</span>         EQU     $44    {addr/1}   ;Machine state after BRK
                   <span id="Sympunit">punit</span>           EQU     $44               ;unit number
                   <span id="SymA5H">A5H</span>             EQU     $45    {addr/1}   ;Monitor Temp
                   <span id="SymACC">ACC</span>             EQU     $45    {addr/1}   ;Acc after BRK
                   <span id="SymXREG">XREG</span>            EQU     $46    {addr/1}   ;X reg after break
                   <span id="SymYREG">YREG</span>            EQU     $47    {addr/1}   ;Y reg after break
                   <span id="SymSTATUS">STATUS</span>          EQU     $48    {addr/1}   ;P reg after break
                   <span id="Symiobpl">iobpl</span>           EQU     $48               ;pointer to IOB
                   <span id="SymSPNT">SPNT</span>            EQU     $49    {addr/1}   ;SP After Break
                   <span id="Symiobph">iobph</span>           EQU     $49
                   <span id="Symtempptr">tempptr</span>         EQU     $4A               ;pointer to params must be last 2 zp byte
                   <span id="SymRNDL">RNDL</span>            EQU     $4E    {addr/1}   ;random counter low
                   <span id="SymRNDH">RNDH</span>            EQU     $4F    {addr/1}   ;random counter high
                   <span id="SymBOOTDEV">BOOTDEV</span>         EQU     $4F               ;Disk II boot rom equate
                   <span id="Symdoserr">doserr</span>          EQU     $80               ;DOS I/O error
                   <span id="Symrevnum">revnum</span>          EQU     $0101             ;revision 1.0.1
                   <span id="SymIN">IN</span>              EQU     $0200  {addr/2}   ;input buffer for GETLN
                   <span id="Syminbuf">inbuf</span>           EQU     $0200             ;Input buffer
                   <span id="SymNBUF1">NBUF1</span>           EQU     $0300             ;Disk II boot rom equate
                   <span id="SymDNIBL">DNIBL</span>           EQU     $0356             ;Disk II boot rom equate
                   <span id="Symsermode">sermode</span>         EQU     $03B8             ;D7=1 if in command D6=1 if terminal
                   <span id="SymBRKV">BRKV</span>            EQU     $03F0  {addr/2}   ;vectors here after break
                   <span id="SymSOFTEV">SOFTEV</span>          EQU     $03F2  {addr/2}   ;vector for warm start
                   <span id="SymPWREDUP">PWREDUP</span>         EQU     $03F4  {addr/2}   ;THIS MUST = EOR #$A5 OF SOFTEV+1
                   <span id="SymUSRADR">USRADR</span>          EQU     $03F8  {addr/2}   ;APPLESOFT USR function vector
                   <span id="SymNMI">NMI</span>             EQU     $03FB  {addr/2}   ;NMI vector
                   <span id="SymLINE1">LINE1</span>           EQU     $0400  {addr/2}   ;first line of text screen
                   <span id="SymROMSTATE">ROMSTATE</span>        EQU     $0478  {addr/2}   ;temp store of ROM state
                   <span id="SymOLDCH">OLDCH</span>           EQU     $047B  {addr/2}   ;($478+3) last value of CH
                   <span id="Symmouxl">mouxl</span>           EQU     $047F             ;X position low byte
                   <span id="Sympwdth">pwdth</span>           EQU     $04B8             ;Printer width 579 &amp; 57A
                   <span id="SymTEMP1">TEMP1</span>           EQU     $04F8  {addr/2}   ;used by CTLCHAR
                   <span id="Symerror">error</span>           EQU     $04F8             ;error flag
                   <span id="SymVMODE">VMODE</span>           EQU     $04FB  {addr/2}   ;($4F8+3) Operating Mode
                   <span id="Symaciabuf">aciabuf</span>         EQU     $04FC             ;Owner of serial buffer
                   <span id="SymTEMPA">TEMPA</span>           EQU     $0578  {addr/2}   ;used by scroll
                   <span id="Symxval">xval</span>            EQU     $0578             ;value to be returned in X
                   <span id="SymOURCH">OURCH</span>           EQU     $057B  {addr/2}   ;($578+3) 80-COL Ch
                   <span id="Symmouxh">mouxh</span>           EQU     $057F             ;X position high byte
                   <span id="SymTEMPY">TEMPY</span>           EQU     $05F8  {addr/2}   ;used by scroll
                   <span id="Symyval">yval</span>            EQU     $05F8             ;value to be returned in Y
                   <span id="Symextint2">extint2</span>         EQU     $05F9
                   <span id="Symtyphed">typhed</span>          EQU     $05FA
                   <span id="SymOURCV">OURCV</span>           EQU     $05FB  {addr/2}   ;($5F8+3) CURSOR VERTICAL
                   <span id="Symtwkey">twkey</span>           EQU     $05FC             ;Storage pointer for type ahead buffer
                   <span id="Symeschar">eschar</span>          EQU     $0638             ;Current escape character 6F9 &amp; 6FA
                   <span id="Symsl_lcstate">sl_lcstate</span>      EQU     $0678             ;language card state
                   <span id="SymVFACTV">VFACTV</span>          EQU     $067B  {addr/2}   ;($678+3) Bit7=video firmware inactive
                   <span id="SymXCOORD">XCOORD</span>          EQU     $06FB  {addr/2}   ;($6F8+3) X-COORD (GOTOXY)
                   <span id="Symtrkey">trkey</span>           EQU     $06FF             ;Retrieve buffer for type ahead buffer
                   <span id="Symcol">col</span>             EQU     $0738             ;Current printer column 7F9 &amp; 7FA
                   <span id="SymNXTCUR">NXTCUR</span>          EQU     $077B  {addr/2}   ;($778+3) next cursor to display
                   <span id="SymMSLOT">MSLOT</span>           EQU     $07F8  {addr/2}   ;owner of $C8 space
                   <span id="SymCURSOR">CURSOR</span>          EQU     $07FB  {addr/2}   ;($7F8+3) the current cursor char
                   <span id="Symmoumode">moumode</span>         EQU     $07FF             ;Mouse mode
                   <span id="Symbootbuf">bootbuf</span>         EQU     $0800             ;into $800
                   <span id="Symthbuf">thbuf</span>           EQU     $0800             ;Buffer in alt ram space
                   <span id="Symrwts">rwts</span>            EQU     $BD00             ;RWTS entry point
                   <span id="Symscomd">scomd</span>           EQU     $BFFA             ;ACIA command register
                   <span id="Symscntl">scntl</span>           EQU     $BFFB             ;ACIA control register
                   <span id="SymCLR80COL">CLR80COL</span>        EQU     $C000  {addr/2}   ;disable 80 column store
                   <span id="SymIOADR">IOADR</span>           EQU     $C000  {addr/2}   ;for IN#, PR# vector
                   <span id="SymKBD">KBD</span>             EQU     $C000  {addr/2}   ;&gt;127 if keystroke
                   <span id="SymSET80COL">SET80COL</span>        EQU     $C001  {addr/2}   ;enable 80 column store
                   <span id="SymRDMAINRAM">RDMAINRAM</span>       EQU     $C002  {addr/2}   ;read from main 48K RAM
                   <span id="SymRDCARDRAM">RDCARDRAM</span>       EQU     $C003  {addr/2}   ;read from alt. 48K RAM
                   <span id="SymWRMAINRAM">WRMAINRAM</span>       EQU     $C004  {addr/2}   ;write to main 48K RAM
                   <span id="SymWRCARDRAM">WRCARDRAM</span>       EQU     $C005  {addr/2}   ;write to alt. 48K RAM
                   <span id="SymSETSTDZP">SETSTDZP</span>        EQU     $C008  {addr/2}   ;use main zero page/stack
                   <span id="SymSETALTZP">SETALTZP</span>        EQU     $C009  {addr/2}   ;use alt. zero page/stack
                   <span id="SymCLR80VID">CLR80VID</span>        EQU     $C00C  {addr/2}   ;disable 80 column hardware
                   <span id="SymSET80VID">SET80VID</span>        EQU     $C00D  {addr/2}   ;enable 80 column hardware
                   <span id="SymCLRALTCHAR">CLRALTCHAR</span>      EQU     $C00E  {addr/2}   ;normal LC, flashing UC
                   <span id="SymSETALTCHAR">SETALTCHAR</span>      EQU     $C00F  {addr/2}   ;normal inverse, LC; no flash
                   <span id="SymKBDSTRB">KBDSTRB</span>         EQU     $C010  {addr/2}   ;turn off key pressed flag
                   <span id="SymRDLCBNK2">RDLCBNK2</span>        EQU     $C011  {addr/2}   ;&gt;127 if LC bnak 2 is in
                   <span id="SymRDLCRAM">RDLCRAM</span>         EQU     $C012  {addr/2}   ;&gt;127 if LC RAM read enabled
                   <span id="SymRDRAMRD">RDRAMRD</span>         EQU     $C013  {addr/2}   ;&gt;127 if reading main 48k
                   <span id="SymRDRAMWRT">RDRAMWRT</span>        EQU     $C014  {addr/2}   ;&gt;127 if writing main 48k
                   <span id="SymRDALTZP">RDALTZP</span>         EQU     $C016  {addr/2}   ;&gt;127 if Alt ZP and LC switched in
                   <span id="SymRD80COL">RD80COL</span>         EQU     $C018  {addr/2}   ;&gt;127 if 80 column store
                   <span id="SymRDTEXT">RDTEXT</span>          EQU     $C01A  {addr/2}   ;&gt;127 if text (not graphics)
                   <span id="SymRDPAGE2">RDPAGE2</span>         EQU     $C01C  {addr/2}   ;&gt;127 if TXTPAGE2 switched in
                   <span id="SymALTCHARSET">ALTCHARSET</span>      EQU     $C01E  {addr/2}   ;&gt;127 if alternate char set in use
                   <span id="SymRD80VID">RD80VID</span>         EQU     $C01F  {addr/2}   ;&gt;127 if 80 column hardware in
                   <span id="SymROMBANK">ROMBANK</span>         EQU     $C028  {addr/2}   ;Switches rombanks
                   <span id="SymSPKR">SPKR</span>            EQU     $C030  {addr/2}   ;clicks the speaker
                   <span id="SymTXTCLR">TXTCLR</span>          EQU     $C050  {addr/2}   ;switch in graphics (not text)
                   <span id="SymTXTSET">TXTSET</span>          EQU     $C051  {addr/2}   ;switch in text (not graphics)
                   <span id="SymMIXSET">MIXSET</span>          EQU     $C053  {addr/2}   ;set mixed-mode (4 lines text)
                   <span id="SymTXTPAGE1">TXTPAGE1</span>        EQU     $C054  {addr/2}   ;switch in text page 1
                   <span id="SymTXTPAGE2">TXTPAGE2</span>        EQU     $C055  {addr/2}   ;switch in text page 2
                   <span id="SymLORES">LORES</span>           EQU     $C056  {addr/2}   ;low-resolution graphics
                   <span id="SymSETAN3">SETAN3</span>          EQU     $C05F  {addr/2}
                   <span id="SymBUTN0">BUTN0</span>           EQU     $C061  {addr/2}   ;open apple key
                   <span id="SymBUTN1">BUTN1</span>           EQU     $C062  {addr/2}   ;closed apple key
                   <span id="SymPADDL0">PADDL0</span>          EQU     $C064  {addr/2}   ;read paddle 0
                   <span id="SymMOUXL">MOUXL</span>           EQU     $C066             ;D7 = X1
                   <span id="SymMOUYL">MOUYL</span>           EQU     $C067             ;D7 = Y1
                   <span id="Symvblclr">vblclr</span>          EQU     $C070             ;Clear VBL interrupt
                   <span id="SymROMIN">ROMIN</span>           EQU     $C081  {addr/2}   ;switch in $D000-FFFF ROM
                   <span id="SymLCBANK2">LCBANK2</span>         EQU     $C083  {addr/2}   ;switch in LC bank 2
                   <span id="SymLCBANK1">LCBANK1</span>         EQU     $C08B  {addr/2}   ;switch in LC bank 1
                   <span id="Symmouseint">mouseint</span>        EQU     $C100             ;bank2
                   <span id="Symserout3">serout3</span>         EQU     $C24F             ;bank2
                   <span id="Symgetstat">getstat</span>         EQU     $C2AC             ;jump2
                   <span id="Symxrdser">xrdser</span>          EQU     $C2C3             ;bank2
                   <span id="Symgetbuf">getbuf</span>          EQU     $C2F7             ;bank2
                   <span id="Symxfer">xfer</span>            EQU     $C397             ;bank2
                   <span id="Symatalk">atalk</span>           EQU     $C580             ;bank2
                   <span id="Symswsl_bt">swsl_bt</span>         EQU     $C6B4             ;bank2?
                   <span id="Symsw_mstint">sw_mstint</span>       EQU     $C6CD             ;bank2?
                   <span id="Symsw_mread">sw_mread</span>        EQU     $C6D8             ;bank2?
                   <span id="Symsw_mclear">sw_mclear</span>       EQU     $C6E3             ;bank2?
                   <span id="Symsw_mclamp">sw_mclamp</span>       EQU     $C6EE             ;bank2?
                   <span id="Symsw_mhome">sw_mhome</span>        EQU     $C6F9             ;bank2?
                   <span id="Symsw_initmouse">sw_initmouse</span>    EQU     $C704             ;bank2?
                   <span id="Symmoveaux">moveaux</span>         EQU     $C7AF             ;bank2
                   <span id="Symswcmd3">swcmd3</span>          EQU     $C806             ;bank2?
                   <span id="Symfixlc">fixlc</span>           EQU     $C80E             ;bank2
                   <span id="SymCTLNUM">CTLNUM</span>          EQU     $CD14             ;;$CD2A-CTLTAB-1
                   <span id="Symdiags">diags</span>           EQU     $D48E             ;bank2
                   <span id="Symzznm">zznm</span>            EQU     $D4C5
                   <span id="Symexecute">execute</span>         EQU     $D800             ;bank2
                   <span id="SymBASIC">BASIC</span>           EQU     $E000  {addr/2}   ;BASIC Entry Point
                   <span id="SymBASIC2">BASIC2</span>          EQU     $E003  {addr/2}   ;BASIC warm entry point
                   <span id="SymIRQVECT">IRQVECT</span>         EQU     $FFFE

                   ********************************************************************************
                   *                                                                              *
                   *  Apple //c                                                                   *
                   *  Video Firmware and                                                          *
                   *  Monitor ROM Source                                                          *
                   *                                                                              *
                   *  COPYRIGHT 1977-1983 BY                                                      *
                   *  APPLE COMPUTER, INC.                                                        *
                   *                                                                              *
                   *  ALL RIGHTS RESERVED                                                         *
                   *                                                                              *
                   *  S. WOZNIAK           1977                                                   *
                   *  A. BAUM              1977                                                   *
                   *  JOHN A           NOV 1978                                                   *
                   *  R. AURICCHIO     SEP 1982                                                   *
                   *  E. BEERNINK          1983                                                   *
                   *                                                                              *
                   * ****                                                                         *
                   *                                                                              *
                   *  Note: In Apple II, //e, both interrupts and BRK destroyed                   *
                   *  location $45.  Now only BRK destroys $45 (ACC) and it                       *
                   *  also destroys $44 (MACSTAT).                                                *
                   *                                                                              *
                   * ****                                                                         *
                   *                                                                              *
                   *  Characters read by GETLN are placed in                                      *
                   *  IN, terminated by a carriage return.                                        *
                   *                                                                              *
                   * ****                                                                         *
                   *  VMODE EQU $4F8+3                                                            *
                   *                                                                              *
                   *  BASIC VMODE Bits                                                            *
                   *                                                                              *
                   *  1....... - BASIC active                                                     *
                   *  0....... - Pascal active                                                    *
                   *  .0......                                                                    *
                   *  .1......                                                                    *
                   *  ..0..... - Print control characters                                         *
                   *  ..1..... - Don't print ctrl chars                                           *
                   *  ...0.... -                                                                  *
                   *  ...1.... -                                                                  *
                   *  ....0... - Print control characters                                         *
                   *  ....1... - Don't print ctrl chars.                                          *
                   *  .....0.. -                                                                  *
                   *  .....1.. -                                                                  *
                   *  ......0. -                                                                  *
                   *  ......1. -                                                                  *
                   *  .......0 - Print mouse characters                                           *
                   *  .......1 - Don't print mouse characters                                     *
                   *                                                                              *
                   * ****                                                                         *
                   *                                                                              *
                   *  Pascal Mode Bits                                                            *
                   *                                                                              *
                   *  1....... - BASIC active                                                     *
                   *  0....... - Pascal active                                                    *
                   *  .0......                                                                    *
                   *  .1......                                                                    *
                   *  ..0..... -                                                                  *
                   *  ..1..... -                                                                  *
                   *  ...0.... - Cursor always on                                                 *
                   *  ...1.... - Cursor always off                                                *
                   *  ....0... - GOTOXY n/a                                                       *
                   *  ....1... - GOTOXY in progress                                               *
                   *  .....0.. - Normal Video                                                     *
                   *  .....1.. - Inverse Video                                                    *
                   *  ......0. -                                                                  *
                   *  ......1. -                                                                  *
                   *  .......0 - Print mouse chars                                                *
                   *  .......1 - Don't print mouse chars                                          *
                   *                                                                              *
                   * ****                                                                         *
                   * Entry points for other modules                                               *
                   * pcnv       equ $C880                                                         *
                   * bootfail   equ $C5F5   ;Boot fails message                                   *
                   * pcnvrst    equ $C5F8   ;Protocol converter reset                             *
                   * atalk      equ $C580   ;Apple talk                                           *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C000
C000: 50 65 74 65+                 ASC     ‘Peter Quinn, Rick Rice, Joe En’
                                    +      ‘nis, J MacDougall, Ken Victor,’
                                    +      ‘ E Beernink, JR Huston, RC Wil’
                                    +      ‘liams, S DesJardin, Randy Bles’
                                    +      ‘ke, Rob Gemmell, Stan Robbins,’
                                    +      ‘ Donna Keyes, Doug Farrar, Ric’
                                    +      ‘h Jordan, Jerry Devlin, John M’
                                    +      ‘edica, B Etheredge, Dave Downe’
                                    +      ‘y, Conrad Rogers’

                   ********************************************************************************
                   *                                                                              *
                   *  Apple Lolly communications driver                                           *
                   *                                                                              *
                   *  By                                                                          *
                   *  Rich Williams                                                               *
                   *  August 1983                                                                 *
                   *  November 5 - j.r.huston                                                     *
                   *                                                                              *
                   *  ****                                                                        *
                   *                                                                              *
                   *  Command codes                                                               *
                   *                                                                              *
                   *  Default command char is ctrl-A (^A)                                         *
                   *                                                                              *
                   *       ^AnnB: Set baud rate to nn                                             *
                   *       ^AnnD: Set data format bits to nn                                      *
                   *       ^AI:   Enable video echo                                               *
                   *       ^AK:   Disable CRLF                                                    *
                   *       ^AL:   Enable CRLF                                                     *
                   *       ^AnnN: Disable video echo &amp; set printer width                          *
                   *       ^AnnP: Set parity bits to nn                                           *
                   *       ^AQ    Quit terminal mode                                              *
                   *       ^AR    Reset the ACIA, IN#0, PR#0                                      *
                   *       ^AS    Send a 233 ms break character                                   *
                   *       ^AT    Enter terminal mode                                             *
                   *       ^AZ:   Zap control commands                                            *
                   *       ^Ax:   Set command char to ^x                                          *
                   *       ^AnnCR:Set printer width (CR = carriage return)                        *
                   *                                                                              *
                   *  New commands added in rev 1 E = enable D = disable                          *
                   *                                                                              *
                   *       ^AC E/D Column overflow                                                *
                   *       ^AL E/D Linefeed same as L &amp; K                                         *
                   *       ^AN E/D Mask incoming linefeeds                                        *
                   *       ^AX E/D Xon Xoff handshaking                                           *
                   *       ^AF E/D Find keyboard                                                  *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C100
C100: 2C 89 C1     <span id="Symserslot">serslot</span>         bit     <a href="#Symserrts">serrts</a>            ;Set V to indicate initial entry
C103: 70 0C                        bvs     <a href="#Symentr1">entr1</a>             ;Always taken
C105: 38                           sec                       ; Input entry point
C106: 90 18                        bcc     $C120
C108: B8                           clv                       ;V = 0 since not inital entry
C109: 50 06                        bvc     <a href="#Symentr1">entr1</a>             ;Always taken

C10B: 01                           DFB     $01               ;pascal signature byte
C10C: 31                           DFB     $31               ;device signature
C10D: 9E                           DFB     &lt;<a href="#Symplinit">plinit</a>
C10E: A8                           DFB     &lt;<a href="#Symplread">plread</a>
C10F: B4                           DFB     &lt;<a href="#Symplwrite">plwrite</a>
C110: BB                           DFB     &lt;<a href="#Symplstatus">plstatus</a>

C111: DA           <span id="Symentr1">entr1</span>           phx                       ;Save the reg
C112: A2 C1                        ldx     #&gt;<a href="#Symserslot">serslot</a>         ;X = Cn
C114: 4C 1C C2                     jmp     <a href="#Symsetup">setup</a>             ;Set mslot, etc

C117: 90 03        <span id="Symserport">serport</span>         bcc     <a href="#Symserisout">serisout</a>          ;Only output allowed
C119: 4C E5 C7                     jmp     <a href="#Symswzznm">swzznm</a>            ;Reset the hooks

C11C: 0A           <span id="Symserisout">serisout</span>        asl     A                 ;A = flags
C11D: 7A                           ply                       ; Get Char
C11E: 5A                           phy
C11F: BD B8 04                     lda     <a href="#Sympwdth">pwdth</a>,X           ;Formatting enabled?
C122: F0 42                        beq     <a href="#Symprnow">prnow</a>
C124: A5 24                        lda     <a href="#SymCH">CH</a>
C126: B0 1C                        bcs     <a href="#Symservid">servid</a>            ;Branch if video echo
C128: DD B8 04                     cmp     <a href="#Sympwdth">pwdth</a>,X           ;If CH &gt;= PWIDTH, then CH = COL
C12B: 90 03                        bcc     <a href="#Symchok">chok</a>
C12D: BD 38 07                     lda     <a href="#Symcol">col</a>,X
C130: DD 38 07     <span id="Symchok">chok</span>            cmp     <a href="#Symcol">col</a>,X             ;Must be &gt; col for valid tab
C133: B0 0B                        bcs     <a href="#Symfixch">fixch</a>             ;Branch if ok
C135: C9 11                        cmp     #$11              ;8 or 16?
C137: B0 11                        bcs     <a href="#Symprnt">prnt</a>              ;If &gt; forget it
C139: 09 F0                        ora     #$F0              ;Find next comma cheaply
C13B: 3D 38 07                     and     <a href="#Symcol">col</a>,X             ;Don't blame me it's Dick's trick
C13E: 65 24                        adc     <a href="#SymCH">CH</a>
C140: 85 24        <span id="Symfixch">fixch</span>           sta     <a href="#SymCH">CH</a>                ;Save the new position
C142: 80 06                        bra     <a href="#Symprnt">prnt</a>

C144: C5 21        <span id="Symservid">servid</span>          cmp     <a href="#SymWNDWDTH">WNDWDTH</a>           ;If ch &gt;= wndwdth go back to start of line
C146: 90 02                        bcc     <a href="#Symprnt">prnt</a>
C148: 64 24                        stz     <a href="#SymCH">CH</a>                ;Go back to left edge
                   ; 
                   ;  We have a char to print
C14A: 7A           <span id="Symprnt">prnt</span>            ply
C14B: 5A                           phy
C14C: BD 38 07                     lda     <a href="#Symcol">col</a>,X             ;Have we exceeded width?
C14F: DD B8 04                     cmp     <a href="#Sympwdth">pwdth</a>,X
C152: B0 08                        bcs     <a href="#Symtoofar">toofar</a>
C154: C5 24                        cmp     <a href="#SymCH">CH</a>                ;Are we tabbing?
C156: B0 0E                        bcs     <a href="#Symprnow">prnow</a>
C158: A9 40                        lda     #$40              ;Space * 2
C15A: 80 02                        bra     <a href="#Symtab">tab</a>

C15C: A9 1A        <span id="Symtoofar">toofar</span>          lda     #$1A              ;CR * 2
C15E: C0 80        <span id="Symtab">tab</span>             cpy     #$80              ;C = High bit
C160: 6A                           ror     A                 ;Shift it into char
C161: 20 9B C1                     jsr     <a href="#Symgoser3">goser3</a>            ;Out it goes
C164: 80 E4                        bra     <a href="#Symprnt">prnt</a>

C166: 98           <span id="Symprnow">prnow</span>           tya
C167: 20 8A C1                     jsr     <a href="#Symserout">serout</a>            ;Print the actual char
C16A: BD B8 04                     lda     <a href="#Sympwdth">pwdth</a>,X           ;Formatting enabled
C16D: F0 17                        beq     <a href="#Symdone">done</a>
C16F: 3C B8 06                     bit     <a href="#Symflags">flags</a>,X           ;In video echo?
C172: 30 12                        bmi     <a href="#Symdone">done</a>
C174: BD 38 07                     lda     <a href="#Symcol">col</a>,X             ;Check if within 8 chars of right edge
C177: FD B8 04                     sbc     <a href="#Sympwdth">pwdth</a>,X           ;So BASIC can format output
C17A: C9 F8                        cmp     #$F8
C17C: 90 04                        bcc     <a href="#Symsetch">setch</a>             ;If not within 8, we're done
C17E: 18                           clc
C17F: 65 21                        adc     <a href="#SymWNDWDTH">WNDWDTH</a>
C181: AC                           DFB     $AC               ;Dummy LDY to skip next two bytes
C182: A9 00        <span id="Symsetch">setch</span>           lda     #0                ;Keep cursor at 0 if video off
C184: 85 24                        sta     <a href="#SymCH">CH</a>
C186: 68           <span id="Symdone">done</span>            pla                       ; Restore regs
C187: 7A                           ply
C188: FA                           plx
C189: 60           <span id="Symserrts">serrts</span>          rts

                   ; Serial output
C18A: 20 A9 C7     <span id="Symserout">serout</span>          jsr     <a href="#Symswcmd">swcmd</a>             ;Check if command
C18D: 90 FA                        bcc     <a href="#Symserrts">serrts</a>            ;All done if it is
C18F: 3C B8 06     <span id="Symserout2">serout2</span>         bit     <a href="#Symflags">flags</a>,X           ;N=1 iff video on
C192: 10 07                        bpl     <a href="#Symgoser3">goser3</a>
C194: C9 91                        cmp     #<a href="#Symxon">xon</a>              ;Don't echo ^Q
C196: F0 03                        beq     <a href="#Symgoser3">goser3</a>
C198: 20 F0 FD                     jsr     <a href="#Symcout1">cout1</a>             ;Echo it
C19B: 4C CD C7     <span id="Symgoser3">goser3</span>          jmp     <a href="#Symswser3">swser3</a>            ;Go to serout3

                   ; Pascal support stuff
C19E: 5A           <span id="Symplinit">plinit</span>          phy
C19F: 48                           pha
C1A0: 20 B6 C2                     jsr     <a href="#Symdefault">default</a>           ;set defaults, enable acia
C1A3: 9E B8 06                     stz     <a href="#Symflags">flags</a>,X
C1A6: 80 07                        bra     <a href="#Symplread2">plread2</a>           ;all done...

C1A8: 5A           <span id="Symplread">plread</span>          phy
C1A9: 20 D9 C7                     jsr     <a href="#Symswread">swread</a>            ;read data from serial port (or buffer)
C1AC: 90 FA                        bcc     <a href="#Symplread">plread</a>            ;Branch if data not ready
C1AE: 90                           DFB     $90               ;BCC to skip pla
C1AF: 68           <span id="Symplread2">plread2</span>         pla
C1B0: 7A                           ply
C1B1: A2 00                        ldx     #0
C1B3: 60                           rts

C1B4: 5A           <span id="Symplwrite">plwrite</span>         phy
C1B5: 48                           pha
C1B6: 20 8A C1                     jsr     <a href="#Symserout">serout</a>            ;go output character
C1B9: 80 F4                        bra     <a href="#Symplread2">plread2</a>

C1BB: 5A           <span id="Symplstatus">plstatus</span>        phy
C1BC: 48                           pha
C1BD: 4A                           lsr     A                 ;C = 0 output, 1 input
C1BE: D0 15                        bne     <a href="#Symplerr">plerr</a>             ;Branch if bad call
C1C0: 08                           php
C1C1: 20 D3 C7                     jsr     <a href="#Symswgetst">swgetst</a>           ;Get status in A
C1C4: 28                           plp
C1C5: 90 05                        bcc     <a href="#Symplstwr">plstwr</a>
C1C7: 29 28                        and     #$28              ;Test DCD = 0 &amp; rcvr full
C1C9: 0A                           asl     A                 ;$08 -&gt; $10
C1CA: 80 02                        bra     <a href="#Symplstrd">plstrd</a>

C1CC: 29 30        <span id="Symplstwr">plstwr</span>          and     #$30              ;Test DCD = 0 &amp; xmit empty
C1CE: C9 10        <span id="Symplstrd">plstrd</span>          cmp     #$10              ;Is it what we want?
C1D0: F0 DD                        beq     <a href="#Symplread2">plread2</a>           ;C = 1 if equal
C1D2: 18                           clc
C1D3: 80 DA                        bra     <a href="#Symplread2">plread2</a>

C1D5: A2 40        <span id="Symplerr">plerr</span>           ldx     #$40              ;Bad call
C1D7: 68                           pla
C1D8: 7A                           ply
C1D9: 18                           clc
C1DA: 60                           rts

C1DB: D5 CE C1 C2+ <span id="Symutsmsg">utsmsg</span>          ASC     “UNABLE TO START FROM MEMORY CA”
                                    +      “RD”
C1FB: 00 00 00 00+                 DS      5,$00
                                   ADREND  ↑ ~$C100

                   ; Communications port at $C200
                                   ORG     $C200
C200: 2C 89 C1     <span id="Symcomslot">comslot</span>         bit     <a href="#Symserrts">serrts</a>            ;Set V to indicate initial entry
C203: 70 14                        bvs     <a href="#Symentr">entr</a>
C205: 38           <span id="Symsin">sin</span>             sec                       ;Input entry point
C206: 90                           DFB     $90               ;BCC opcode to skip next byte
C207: 18           <span id="Symsout">sout</span>            clc                       ;Output entry point
C208: B8                           clv                       ;Mark not initial entry
C209: 50 0E                        bvc     <a href="#Symentr">entr</a>              ;Branch around pascal entry stuff

C20B: 01                           DFB     $01               ;pascal siganture byte
C20C: 31                           DFB     $31               ;device signature
C20D: 11                           DFB     &lt;<a href="#Symp2init">p2init</a>
C20E: 13                           DFB     &lt;<a href="#Symp2read">p2read</a>
C20F: 15                           DFB     &lt;<a href="#Symp2write">p2write</a>
C210: 17                           DFB     &lt;<a href="#Symp2status">p2status</a>

                   ; Pascal support stuff
C211: 80 8B        <span id="Symp2init">p2init</span>          bra     <a href="#Symplinit">plinit</a>

C213: 80 93        <span id="Symp2read">p2read</span>          bra     <a href="#Symplread">plread</a>

C215: 80 9D        <span id="Symp2write">p2write</span>         bra     <a href="#Symplwrite">plwrite</a>

C217: 80 A2        <span id="Symp2status">p2status</span>        bra     <a href="#Symplstatus">plstatus</a>

C219: DA           <span id="Symentr">entr</span>            phx
C21A: A2 C2                        ldx     #&gt;<a href="#Symcomslot">comslot</a>         ;X = &lt;CN00
C21C: 5A           <span id="Symsetup">setup</span>           phy
C21D: 48                           pha
C21E: 8E F8 07                     stx     <a href="#SymMSLOT">MSLOT</a>
C221: 50 22                        bvc     <a href="#Symsudone">sudone</a>            ;First call?
C223: A5 36                        lda     <a href="#SymCSWL">CSWL</a>              ;If both hooks CN00 setup defaults
C225: 45 38                        eor     <a href="#SymKSWL">KSWL</a>              ;since it has already been done
C227: F0 06                        beq     <a href="#Symsudodef">sudodef</a>
C229: A5 37        <span id="SymLC229">LC229</span>           lda     <a href="#SymCSWH">CSWH</a>              ;If both hooks CN then don't do def
C22B: C5 39        <span id="Symdevno">devno</span>           cmp     <a href="#SymKSWH">KSWH</a>              ;since it has already been done
C22D: F0 03                        beq     <a href="#Symsunodef">sunodef</a>
C22F: 20 B6 C2     <span id="Symsudodef">sudodef</span>         jsr     <a href="#Symdefault">default</a>           ;Set up defaults
C232: 8A           <span id="Symsunodef">sunodef</span>         txa
C233: 45 39                        eor     <a href="#SymKSWH">KSWH</a>              ;Input call?
C235: 05 38                        ora     <a href="#SymKSWL">KSWL</a>
C237: D0 07                        bne     <a href="#Symsuout">suout</a>             ;Must be Cn00
C239: A9 05                        lda     #&lt;<a href="#Symsin">sin</a>             ;Fix the input hook
C23B: 85 38                        sta     <a href="#SymKSWL">KSWL</a>
C23D: 38                           sec                       ;C = 1 for input call
C23E: 80 05                        bra     <a href="#Symsudone">sudone</a>

C240: A9 07        <span id="Symsuout">suout</span>           lda     #&lt;<a href="#Symsout">sout</a>            ;Fix output hook
C242: 85 36                        sta     <a href="#SymCSWL">CSWL</a>              ;Note c might not be 0
C244: 18                           clc                       ;C=0 for output
C245: BD B8 06     <span id="Symsudone">sudone</span>          lda     <a href="#Symflags">flags</a>,X           ;Check if serial or comm port
C248: 89 01                        bit     #1                ;leave flga in A for serport
C24A: D0 03                        bne     <a href="#Symcommport">commport</a>
C24C: 4C 17 C1     <span id="Symcomout">comout</span>          jmp     <a href="#Symserport">serport</a>

C24F: 90 FB        <span id="Symcommport">commport</span>        bcc     <a href="#Symcomout">comout</a>            ;Output?
C251: 68                           pla                       ; Get the char
C252: 80 28                        bra     <a href="#Symterml">terml</a>             ;Input

C254: 3C B8 03     <span id="Symnoesc">noesc</span>           bit     <a href="#Symsermode">sermode</a>,X         ;In temrinal mode?
C257: 50 1C                        bvc     <a href="#Symexitl">exitl</a>             ;If not, return key
C259: 20 8F C1                     jsr     <a href="#Symserout2">serout2</a>           ;Out it goes
C25C: 80 1E                        bra     <a href="#Symterml">terml</a>

C25E: 68           <span id="Symtestkbd">testkbd</span>         pla                       ;Get current char
C25F: 20 70 CC                     jsr     <a href="#Symupdate">update</a>            ;Update cursor &amp; check keyboard
C262: 10 1B                        bpl     <a href="#Symserin">serin</a>             ;N=0 if no new key
C264: 20 A9 C7                     jsr     <a href="#Symswcmd">swcmd</a>             ;Testfor command
C267: B0 EB                        bcs     <a href="#Symnoesc">noesc</a>             ;Branch if not
C269: 29 5F                        and     #$5F              ;upshift for following tests
C26B: C9 51                        cmp     #‘Q’              ;Quit?
C26D: F0 04                        beq     <a href="#SymexitX">exitX</a>
C26F: C9 52                        cmp     #‘R’              ;Reset?
C271: D0 09                        bne     <a href="#Symterml">terml</a>             ;Go check serial
C273: A9 98        <span id="SymexitX">exitX</span>           lda     #$98              ;return a CTRL-X
C275: 7A           <span id="Symexitl">exitl</span>           ply
C276: FA                           plx
C277: 60                           rts

C278: 18           <span id="Symgoremote">goremote</span>        clc                       ;Into remote mode
C279: 20 A3 C7     <span id="Symgoterm">goterm</span>          jsr     <a href="#Symswsttm">swsttm</a>            ;Into terminal mode
C27C: 20 4C CC     <span id="Symterml">terml</span>           jsr     <a href="#Symshowcur">showcur</a>           ;Get current char on screen
C27F: 48           <span id="Symserin">serin</span>           pha
C280: 20 D9 C7     <span id="Symsinokbd">sinokbd</span>         jsr     <a href="#Symswread">swread</a>            ;Is it ready?
C283: B0 09                        bcs     <a href="#Symsidata">sidata</a>            ;Branch if we got data
C285: BD B8 06                     lda     <a href="#Symflags">flags</a>,X           ;Is keyboard enabled?
C288: 29 10                        and     #$10
C28A: F0 D2                        beq     <a href="#Symtestkbd">testkbd</a>           ;Branch if enabled
C28C: 80 F2                        bra     <a href="#Symsinokbd">sinokbd</a>           ;Go test acia again

C28E: A8           <span id="Symsidata">sidata</span>          tay                       ; Save new input in y for now
C28F: 68                           pla
C290: 5A                           phy                       ;Save new char on stack
C291: 20 B8 C3                     jsr     <a href="#Symstorch">storch</a>            ;Fix the screen
C294: 68                           pla                       ; Get the new data
C295: BC 38 06                     ldy     <a href="#Symeschar">eschar</a>,X          ;If 0, don't modify char
C298: F0 12                        beq     <a href="#Symsinomod">sinomod</a>
C29A: 09 80                        ora     #$80              ;Apple loves the high bit
C29C: C9 91                        cmp     #<a href="#Symxon">xon</a>
C29E: F0 DC                        beq     <a href="#Symterml">terml</a>             ;Ignore ^Q
C2A0: C9 FF                        cmp     #$FF              ;Ignore FFs
C2A2: F0 D8                        beq     <a href="#Symterml">terml</a>
C2A4: C9 92                        cmp     #$92              ;^R for remote?
C2A6: F0 D0                        beq     <a href="#Symgoremote">goremote</a>
C2A8: C9 94                        cmp     #$94              ;^T for terminal mode?
C2AA: F0 CD                        beq     <a href="#Symgoterm">goterm</a>
C2AC: 3C B8 03     <span id="Symsinomod">sinomod</span>         bit     <a href="#Symsermode">sermode</a>,X         ;In terminal mode?
C2AF: 50 C4                        bvc     <a href="#Symexitl">exitl</a>             ;Return to user if not A = char
C2B1: 20 ED FD                     jsr     <a href="#Symcout">cout</a>              ;Onto the screen with it
C2B4: 80 C6                        bra     <a href="#Symterml">terml</a>

                   ; Set up the defaults
C2B6: 20 A0 CF     <span id="Symdefault">default</span>         jsr     <a href="#Symmoveirq">moveirq</a>           ;make sure irq vectors ok
C2B9: BC 29 C2                     ldy     <a href="#SymLC229">LC229</a>,X           ;(defidx-$C1) ;Index into alt screen. Table in command
C2BC: 20 7C C3     <span id="Symdefloop">defloop</span>         jsr     <a href="#Symgetalt">getalt</a>            ;Get default from alt screen
C2BF: 48                           pha
C2C0: 88                           dey
C2C1: 30 04                        bmi     <a href="#Symdefff">defff</a>             ;Done if minus
C2C3: C0 03                        cpy     #3
C2C5: D0 F5                        bne     <a href="#Symdefloop">defloop</a>           ;Or if 2
C2C7: 20 A0 CF     <span id="Symdefff">defff</span>           jsr     <a href="#Symmoveirq">moveirq</a>           ;Jam irq vector into LC
C2CA: 68                           pla                       ; Command, control &amp; flags on stack
C2CB: BC 2B C2                     ldy     <a href="#Symdevno">devno</a>,X
C2CE: 99 FB BF                     sta     <a href="#Symscntl">scntl</a>,Y           ;Set command reg
C2D1: 68                           pla
C2D2: 99 FA BF                     sta     <a href="#Symscomd">scomd</a>,Y
C2D5: 68                           pla
C2D6: 9D B8 06                     sta     <a href="#Symflags">flags</a>,X           ;And the flags.
C2D9: 29 01                        and     #1                ;A = $01 (^A) if comm mode
C2DB: D0 02                        bne     <a href="#Symdefcom">defcom</a>
C2DD: A9 09                        lda     #9                ;^I for serial port
C2DF: 9D 38 06     <span id="Symdefcom">defcom</span>          sta     <a href="#Symeschar">eschar</a>,X
C2E2: 68                           pla                       ;Get printer width
C2E3: 9D B8 04                     sta     <a href="#Sympwdth">pwdth</a>,X
C2E6: 9E B8 03                     stz     <a href="#Symsermode">sermode</a>,X
C2E9: 60                           rts

C2EA: 03 07        <span id="Symdefidx">defidx</span>          HEX     $03,$07
                   ; C2EC: sltdmy equ  &lt;serslot  ; Make table for hardware access
                   ; C2EC: devno  equ  *-sltdmy
C2EC: A0 B0                        HEX     $A0,$B0
C2EE: 00 00 00 00+                 HEX     $00,$00,$00,$00,$00,$00,$00,$00
                                    +      $00,$00,$00,$00,$00,$00,$00,$00
                                    +      $00,$00
                                   ADREND  ↑ ~$C200

                   ********************************************************************************
                   *                                                                              *
                   *  THIS IS THE $C3XX ROM SPACE:                                                *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C300
C300: 48           <span id="SymC3ENTRY">C3ENTRY</span>         pha                       ;save regs
C301: DA                           phx
C302: 5A                           phy
C303: 80 12                        bra     <a href="#SymBASICINIT">BASICINIT</a>         ;and init video firmware

C305: 38           <span id="SymC3KEYIN">C3KEYIN</span>         sec                       ;Pascal 1.1 ID byte
C306: 90                           DFB     $90               ;BCC OPCODE (NEVER TAKEN)
C307: 18           <span id="SymC3COUT1">C3COUT1</span>         clc                       ;Pascal 1.1 ID byte
C308: 80 1A                        bra     <a href="#SymBASICENT">BASICENT</a>          ;=&gt;go print/read char

C30A: EA                           nop
                   ; 
                   ; PASCAL 1.1 FIRMWARE PROTOCOL TABLE
                   ; 
C30B: 01                           DFB     $01               ;GENERIC SIGNATURE BYTE
C30C: 88                           DFB     $88               ;DEVICE SIGNATURE BYTE
C30D: 2C                           DFB     &lt;<a href="#SymJPINIT">JPINIT</a>           ;PASCAL INIT
C30E: 2F                           DFB     &lt;<a href="#SymJPREAD">JPREAD</a>           ;PASCAL READ
C30F: 32                           DFB     &lt;<a href="#SymJPWRITE">JPWRITE</a>          ;PASCAL WRITE
C310: 35                           DFB     &lt;<a href="#SymJPSTAT">JPSTAT</a>           ;PASCAL STATUS
                   ********************************************************************************
                   *                                                                              *
                   *  128K SUPPORT ROUTINE ENTRIES:                                               *
                   *                                                                              *
                   ********************************************************************************
C311: 4C AF C7                     jmp     <a href="#SymSWAUX">SWAUX</a>             ;MEMORY MOVE ACROSS BANKS

C314: 4C B5 C7                     jmp     <a href="#SymSWXFER">SWXFER</a>            ;TRANSFER ACROSS BANKS

                   ; 
                   ;  BASIC I/O ENTRY POINT
                   ; 
C317: 20 20 CE     <span id="SymBASICINIT">BASICINIT</span>       jsr     <a href="#SymHOOKUP">HOOKUP</a>            ;COPYROM if needed, sethooks
C31A: 20 BE CD                     jsr     <a href="#SymSET80">SET80</a>             ;setup 80 columns
C31D: 20 58 FC                     jsr     <a href="#SymHOME">HOME</a>              ;clear screen
C320: 7A                           ply
C321: FA                           plx                       ;restore x
C322: 68                           pla                       ;restore char
C323: 18                           clc                       ;output a char
                   ; 
C324: B0 03        <span id="SymBASICENT">BASICENT</span>        bcs     <a href="#SymBINPUT">BINPUT</a>            ;=&gt;carry me to input
C326: 4C F6 FD     <span id="SymBPRINT">BPRINT</span>          jmp     <a href="#SymCOUTZ">COUTZ</a>             ;print a character

C329: 4C 1B FD     <span id="SymBINPUT">BINPUT</span>          jmp     <a href="#SymKEYIN">KEYIN</a>             ;get a keystroke

C32C: 4C 41 CF     <span id="SymJPINIT">JPINIT</span>          jmp     <a href="#SymPINIT">PINIT</a>             ;pscal init

C32F: 4C 35 CF     <span id="SymJPREAD">JPREAD</span>          jmp     <a href="#SymPASREAD">PASREAD</a>           ;pascal read

C332: 4C C2 CE     <span id="SymJPWRITE">JPWRITE</span>         jmp     <a href="#SymPWRITE">PWRITE</a>            ;pascal write

C335: 4C B1 CE     <span id="SymJPSTAT">JPSTAT</span>          jmp     <a href="#SymPSTATUS">PSTATUS</a>           ;pascal status call

                   ********************************************************************************
                   *                                                                              *
                   *  COPYROM is called when the video firmware is                                *
                   *  initialized.  If the language card is switched                              *
                   *  in for reading, it copies the F8 ROM to the                                 *
                   *  language card and restores the state of the                                 *
                   *  language card.                                                              *
                   *                                                                              *
                   ********************************************************************************
C338: A9 06        <span id="SymCOPYROM">COPYROM</span>         lda     #<a href="#SymGOODF8">GOODF8</a>           ;get the ID byte
                   ; 
                   ;  Compare ID bytes to whatever is readable.  If it
                   ;  Matches, all is ok.  If not, need to copy.
                   ; 
C33A: CD B3 FB                     cmp     <a href="#SymF8VERSION">F8VERSION</a>         ;does it match?
C33D: F0 3C                        beq     <a href="#SymROMOK">ROMOK</a>
C33F: 20 60 C3                     jsr     <a href="#SymSETROM">SETROM</a>            ;read ROM, write RAM, save state
C342: A9 F8                        lda     #$F8              ;from F800-FFFF
C344: 85 37                        sta     <a href="#SymCSWH">CSWH</a>
C346: 64 36                        stz     <a href="#SymCSWL">CSWL</a>
C348: B2 36        <span id="SymCOPYROM2">COPYROM2</span>        lda     (<a href="#SymCSWL">CSWL</a>)            ;get a byte
C34A: 92 36                        sta     (<a href="#SymCSWL">CSWL</a>)            ;and save a byte
C34C: E6 36                        inc     <a href="#SymCSWL">CSWL</a>
C34E: D0 F8                        bne     <a href="#SymCOPYROM2">COPYROM2</a>
C350: E6 37                        inc     <a href="#SymCSWH">CSWH</a>
C352: D0 F4                        bne     <a href="#SymCOPYROM2">COPYROM2</a>
                   ; 
                   ;  RESETLC resets the langauge card to the state
                   ;  determined by SETROM.  It always leaves the card
                   ;  write enabled.
                   ; 
C354: DA           <span id="SymRESETLC">RESETLC</span>         phx                       ;save X
C355: AE 78 04                     ldx     <a href="#SymROMSTATE">ROMSTATE</a>          ;get the state
C358: 3C 81 C0                     bit     <a href="#SymROMIN">ROMIN</a>,X           ;set bank &amp; ROM/RAM read
C35B: 3C 81 C0                     bit     <a href="#SymROMIN">ROMIN</a>,X           ;set write enable
C35E: FA                           plx                       ;restore X
C35F: 60                           rts

                   ; 
                   ;  SETROM switches in the ROM for reading, the RAM
                   ;  for writing, and it saves the state of the 
                   ;  language card.  It does not save the write
                   ;  protect status of the card.
                   ; 
C360: DA           <span id="SymSETROM">SETROM</span>          phx                       ;save x
C361: A2 00                        ldx     #0                ;assume write enable,bank2,ROMRD
C363: 2C 11 C0                     bit     <a href="#SymRDLCBNK2">RDLCBNK2</a>          ;is bank2 switched in?
C366: 30 02                        bmi     <a href="#SymNOT1">NOT1</a>              ;=&gt;yes
C368: A2 08                        ldx     #8                ;indicate bank 1
C36A: 2C 12 C0     <span id="SymNOT1">NOT1</span>            bit     <a href="#SymRDLCRAM">RDLCRAM</a>           ;is LC RAM readable?
C36D: 10 02                        bpl     <a href="#SymNOREAD">NOREAD</a>            ;=&gt;no
C36F: E8                           inx                       ;indicate RAM read
C370: E8                           inx
C371: 2C 81 C0     <span id="SymNOREAD">NOREAD</span>          bit     $C081             ;ROM read
C374: 2C 81 C0                     bit     $C081             ;RAM write
C377: 8E 78 04                     stx     <a href="#SymROMSTATE">ROMSTATE</a>          ;save state
C37A: FA                           plx                       ;restore X
C37B: 60           <span id="SymROMOK">ROMOK</span>           rts

                   ; 
                   ;  GETALT reads a byte from aux memory screenholes.
                   ;  Y is the index to the byte (0-7) indexed off of
                   ;  address $478.
                   ; 
C37C: AD 13 C0     <span id="Symgetalt">getalt</span>          lda     <a href="#SymRDRAMRD">RDRAMRD</a>           ;save state of aux memory
C37F: 0A                           asl     A
C380: AD 18 C0                     lda     <a href="#SymRD80COL">RD80COL</a>           ;and of the 80STORE switch
C383: 08                           php
C384: 8D 00 C0                     sta     <a href="#SymCLR80COL">CLR80COL</a>          ;no 80STORE to get page 1
C387: 8D 03 C0                     sta     <a href="#SymRDCARDRAM">RDCARDRAM</a>         ;pop in the other half of RAM
C38A: B9 78 04                     lda     $0478,Y           ;read the desired byte
C38D: 28                           plp
C38E: B0 03                        bcs     <a href="#SymGETALT1">GETALT1</a>
C390: 8D 02 C0                     sta     <a href="#SymRDMAINRAM">RDMAINRAM</a>
C393: 10 03        <span id="SymGETALT1">GETALT1</span>         bpl     <a href="#SymGETALT2">GETALT2</a>
C395: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>
C398: 60           <span id="SymGETALT2">GETALT2</span>         rts

C399: 09 80        <span id="SymUPSHIFT0">UPSHIFT0</span>        ora     #$80              ;set high bit for execs
C39B: C9 FB        <span id="SymUPSHIFT">UPSHIFT</span>         cmp     #$FB
C39D: B0 06                        bcs     <a href="#SymX_UPSHIFT">X_UPSHIFT</a>
C39F: C9 E1                        cmp     #$E1
C3A1: 90 02                        bcc     <a href="#SymX_UPSHIFT">X_UPSHIFT</a>
C3A3: 29 DF                        and     #$DF
C3A5: 60           <span id="SymX_UPSHIFT">X_UPSHIFT</span>       rts

                   ; 
                   ;  GETOUT performs COUT for GETLN.  It disables the
                   ;  echoing of control characters by clearing the
                   ;  M.CTL mode bit, prints the char, the restores
                   ;  M.CLT.  NOESC is used by the RDKEY routine to
                   ;  disable escape sequences.
                   ; 
C3A6: 48           <span id="SymGETCOUT">GETCOUT</span>         pha                       ;save char to print
C3A7: A9 08                        lda     #<a href="#SymM_CTL">M_CTL</a>            ;disable control chars
C3A9: 1C FB 04                     trb     <a href="#SymVMODE">VMODE</a>             ;by clearing M_CTL
C3AC: 68                           pla                       ;restore character
C3AD: 20 ED FD                     jsr     <a href="#Symcout">cout</a>              ;and print it
C3B0: 4C 44 FD                     jmp     <a href="#SymNOESCAPE">NOESCAPE</a>          ;enable control characters

                   ; 
                   ;  STORCH determines loads the current cursor position,
                   ;         inverts the character, and displays it
                   ;  STORCHAR inverts the character and displays it at the
                   ;         position stored in Y.
                   ;  STORY  determines the current cursor position, and
                   ;         displays the character without inverting it
                   ;  STORE  displays the car at the position in Y
                   ; 
                   ;  If mouse characters are enabled (VMODE bit 0 = 0)
                   ;  then mouse characters ($40-$5F) are displayed when
                   ;  the alternate character set is switched in.  Normally
                   ;  values $40-$5F are shifted to $0-$1F before display.
                   ; 
                   ;  Calls to GETCUR trash Y
                   ; 
C3B3: 20 9D CC     <span id="SymSTORY">STORY</span>           jsr     <a href="#SymGETCUR">GETCUR</a>            ;get newest cursor into Y
C3B6: 80 09                        bra     <a href="#SymSTORE">STORE</a>

C3B8: 20 9D CC     <span id="Symstorch">storch</span>          jsr     <a href="#SymGETCUR">GETCUR</a>            ;first, get cursor position
C3BB: 24 32                        bit     <a href="#SymINVFLG">INVFLG</a>            ;normal or inverse?
C3BD: 30 02                        bmi     <a href="#SymSTORE">STORE</a>             ;=&gt;normal, store it
C3BF: 29 7F                        and     #$7F              ;inverse it
C3C1: 5A           <span id="SymSTORE">STORE</span>           phy                       ;save real Y
C3C2: 09 00                        ora     #0                ;does char have high bit set?
C3C4: 30 15                        bmi     <a href="#SymSTORE1">STORE1</a>            ;=&gt;yes, don't do mouse check
C3C6: 48                           pha                       ;save char
C3C7: AD FB 04                     lda     <a href="#SymVMODE">VMODE</a>             ;is mouse bit set?
C3CA: 6A                           ror     A
C3CB: 68                           pla                       ;restore char
C3CC: 90 0D                        bcc     <a href="#SymSTORE1">STORE1</a>            ;=&gt;no, don't do mouse shift
C3CE: 2C 1E C0                     bit     <a href="#SymALTCHARSET">ALTCHARSET</a>        ;no shift if ][ char set
C3D1: 10 08                        bpl     <a href="#SymSTORE1">STORE1</a>            ;=&gt; it is!
C3D3: 49 40                        eor     #$40              ;$40-$5F=&gt;0-$1f
C3D5: 89 60                        bit     #$60
C3D7: F0 02                        beq     <a href="#SymSTORE1">STORE1</a>
C3D9: 49 40                        eor     #$40
C3DB: 2C 1F C0     <span id="SymSTORE1">STORE1</span>          bit     <a href="#SymRD80VID">RD80VID</a>           ;80 columns?
C3DE: 10 19                        bpl     <a href="#SymSTORE5">STORE5</a>            ;=&gt;no, store char
C3E0: 48                           pha                       ;save (shifted) char
C3E1: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>          ;hit 80 store
C3E4: 98                           tya                       ;get proper Y
C3E5: 45 20                        eor     <a href="#SymWNDLFT">WNDLFT</a>            ;C=1 if char in main ram
C3E7: 4A                           lsr     A
C3E8: B0 04                        bcs     <a href="#SymSTORE2">STORE2</a>            ;=&gt;yes, main RAM
C3EA: AD 55 C0                     lda     <a href="#SymTXTPAGE2">TXTPAGE2</a>          ;else flip in aux RAM
C3ED: C8                           iny                       ;do this for odd left, aux bytes
C3EE: 98           <span id="SymSTORE2">STORE2</span>          tya                       ;divide pos'n by 2
C3EF: 4A                           lsr     A
C3F0: A8                           tay
C3F1: 68                           pla                       ;get (shifted) char
C3F2: 91 28                        sta     (<a href="#SymBASL">BASL</a>),Y          ;stuff it
C3F4: 2C 54 C0                     bit     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;else restore page1
C3F7: 7A                           ply                       ;restore real Y
C3F8: 60                           rts                       ;und exit

C3F9: 91 28        <span id="SymSTORE5">STORE5</span>          sta     (<a href="#SymBASL">BASL</a>),Y          ;do 40 column store
C3FB: 7A                           ply                       ;restore y
C3FC: 60                           rts                       ;and exit

C3FD: 00 00 00                     HEX     $00,$00,$00
                                   ADREND  ↑ ~$C300

                   ********************************************************************************
                   * Slinky Boot Code                                                             *
                   ********************************************************************************
                                   ORG     $C400
C400: C9 20        <span id="Symslinky_boot_code">slinky_boot_code</span> cmp    #$20              ;Boot entry point
C402: C9 00                        cmp     #$00              ;Signature byte stuff
C404: C9 03                        cmp     #$03
C406: C9 00                        cmp     #0
C408: B0 04                        bcs     <a href="#Symboot4">boot4</a>             ;Always taken
C40A: A0 05                        ldy     #5                ;Diagnostics entry point
C40C: D0 54                        bne     <a href="#Symdos24">dos24</a>

                   ; Here is the boot code
                   ; Reads in block 0 into $800 and executes at $801
C40E: 78           <span id="Symboot4">boot4</span>           sei                       ;No interrupts if booting
C40F: A5 39                        lda     <a href="#SymKSWH">KSWH</a>              ;Save IN#
                   ********************************************************************************
                   * the following two bytes must be $90 and $4B in locations $C411 and           *
                   * and $C412 respectively.  the bcc ($90) is never taken by the                 *
                   * slinky code and the $4B is used to duplicate the mouse entry                 *
                   * point as found in slot 7.  this 'fix' enables some programs                  *
                   * to still work correctly.  (tim, you owe me a beer for this one!)             *
                   ********************************************************************************
C411: 90 4B                        HEX     $90,$4B           ;bcc is never taken
C413: 48                           pha
C414: 20 89 FE                     jsr     <a href="#SymSETKBD">SETKBD</a>            ;Reset the hooks
C417: 20 93 FE                     jsr     <a href="#SymSETVID">SETVID</a>
C41A: 68                           pla
C41B: 20 4C C7                     jsr     <a href="#Symslboot">slboot</a>            ;Go get boot block
C41E: AE 01 08                     ldx     <a href="#Symbootbuf">bootbuf</a>+1
C421: F0 05                        beq     <a href="#Symbtok4">btok4</a>             ;boot not okay
                   ; ldx #4*$10
C423: A2 40                        ldx     #$40
C425: 4C 01 08                     jmp     <a href="#Symbootbuf">bootbuf</a>+1

                   ; discontinue boot sequence if not power on reset or forced cold start
C428: A5 00        <span id="Symbtok4">btok4</span>           lda     <a href="#SymLOC0">LOC0</a>
C42A: D0 0D                        bne     <a href="#Symbtok4_1">btok4_1</a>
C42C: A5 01                        lda     <a href="#SymLOC1">LOC1</a>
                   ; cmp #4+$C0
C42E: C9 C4                        cmp     #$C4
C430: D0 07                        bne     <a href="#Symbtok4_1">btok4_1</a>
C432: A9 C6                        lda     #$C6              ;should be $C6 now
C434: 85 01                        sta     <a href="#SymLOC1">LOC1</a>
C436: 6C 00 00                     jmp     (<a href="#SymLOC0">LOC0</a>)            ;try slot 6 instead

C439: A9 17        <span id="Symbtok4_1">btok4_1</span>         lda     #23               ;go to bottom of screen
C43B: 85 25                        sta     <a href="#SymCV">CV</a>
                   ; 
C43D: BD DB C1     <span id="Symbtok4_2">btok4_2</span>         lda     <a href="#Symutsmsg">utsmsg</a>,X          ;'unable to start from memory card.'
C440: F0 06                        beq     <a href="#Symbtok4_3">btok4_3</a>           ;skip if done
C442: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
C445: E8                           inx
C446: D0 F5                        bne     <a href="#Symbtok4_2">btok4_2</a>
C448: 4C 00 E0     <span id="Symbtok4_3">btok4_3</span>         jmp     <a href="#SymBASIC">BASIC</a>             ;drop into basic

C44B: 4C 1C C7                     jmp     <a href="#Symxsetmou">xsetmou</a>           ;should be at $C44B

                   ********************************************************************************
                   *                                                                              *
                   * Entry point for prodos driver                                                *
                   *                                                                              *
                   ********************************************************************************
C44E: 4C 54 C4     <span id="Symentry4">entry4</span>          jmp     <a href="#Syment4">ent4</a>              ;Jump to ProDOS

                   <span style="background-color: #89acb7">NOTE: Entry point for prodos has a jump to the protocol converter (pconv4)</span>
C451: 4C 94 C4                     jmp     <a href="#Sympconv4">pconv4</a>            ;Jump to PC

C454: A9 28        <span id="Syment4">ent4</span>            lda     #<a href="#Symnderr">nderr</a>            ;Assume wrong drive
C456: A6 43                        ldx     <a href="#Symunit">unit</a>
C458: 30 2A                        bmi     <a href="#Symrats4">rats4</a>             ;Error!!!
C45A: A9 01                        lda     #<a href="#Symbadcmd">badcmd</a>           ;Assume bad command
C45C: A4 42                        ldy     <a href="#Symcmmand">cmmand</a>            ;Get command
                   ; the 'cpy #4' below use to be a 'cmp #4'.  because of this
                   ; change, revnum will be 1.0.1
C45E: C0 04                        cpy     #4
C460: B0 22                        bcs     <a href="#Symrats4">rats4</a>             ;Branch if bad command
C462: A2 0A        <span id="Symdos24">dos24</span>           ldx     #<a href="#Symzused">zused</a>            ;Save zp DOS jumps in here
C464: B5 41        <span id="Symzsave4">zsave4</span>          lda     <a href="#Symcmmand">cmmand</a>-1,X
C466: 48                           pha
C467: CA                           dex
C468: D0 FA                        bne     <a href="#Symzsave4">zsave4</a>
C46A: 98                           tya                       ;Add 20 to command for table look up
C46B: 18                           clc
C46C: 69 14                        adc     #20
                   ********************************************************************************
                   * This code is common to PC and ProDOS and DOS entry points                    *
                   ********************************************************************************
C46E: 20 52 C7     <span id="Symdoit4">doit4</span>           jsr     <a href="#Symslxeq">slxeq</a>             ;Go do command
C471: A2 00        <span id="Symdone4">done4</span>           ldx     #0                ;Restore up
C473: 68           <span id="Symrsloop4">rsloop4</span>         pla
C474: 95 42                        sta     <a href="#Symcmmand">cmmand</a>,X
C476: E8                           inx
C477: E0 0A                        cpx     #<a href="#Symzused">zused</a>
C479: 90 F8                        bcc     <a href="#Symrsloop4">rsloop4</a>
C47B: AE 78 05                     ldx     <a href="#Symxval">xval</a>              ;Set X and Y to whatever
C47E: AC F8 05                     ldy     <a href="#Symyval">yval</a>
C481: AD F8 04                     lda     <a href="#Symerror">error</a>             ;Was there an error?
C484: C9 01        <span id="Symrats4">rats4</span>           cmp     #1                ;C = 1 if not 0
C486: 09 00                        ora     #0                ;Set n,z flags
C488: 60                           rts

C489: A9 01        <span id="Sympccmd4">pccmd4</span>          lda     #<a href="#Symbadcmd">badcmd</a>           ;Bad command
C48B: D0 02                        bne     <a href="#Sympcerr4">pcerr4</a>

C48D: A9 11        <span id="Sympcbad4">pcbad4</span>          lda     #<a href="#Symbadunit">badunit</a>          ;Bad protocol unit
C48F: 8D F8 04     <span id="Sympcerr4">pcerr4</span>          sta     <a href="#Symerror">error</a>             ;Save the error code
C492: D0 DD                        bne     <a href="#Symdone4">done4</a>

                   ********************************************************************************
                   * Protocol converter entry point                                               *
                   ********************************************************************************
C494: 68           <span id="Sympconv4">pconv4</span>          pla                       ;Pull the return address
C495: A8                           tay
C496: C9 FD                        cmp     #$FD              ;C = 1 if carry in +3
C498: 68                           pla                       ;High byte of return address
C499: AA                           tax
C49A: 69 00                        adc     #0
C49C: 48                           pha
C49D: 98                           tya
C49E: 69 03                        adc     #3                ;C = 0 from previous add
C4A0: 48                           pha                       ;Return address + 3 now pushed
C4A1: A5 4B                        lda     <a href="#Symtempptr">tempptr</a>+1         ;Save zero page
C4A3: 48                           pha
C4A4: 86 4B                        stx     <a href="#Symtempptr">tempptr</a>+1
C4A6: A2 09                        ldx     #<a href="#Symzused">zused</a>-1
C4A8: B5 41        <span id="Sympcsvzp4">pcsvzp4</span>         lda     <a href="#Symcmmand">cmmand</a>-1,X        ;Save rest of zp
C4AA: 48                           pha
C4AB: CA                           dex
C4AC: D0 FA                        bne     <a href="#Sympcsvzp4">pcsvzp4</a>
C4AE: 84 4A                        sty     <a href="#Symtempptr">tempptr</a>
C4B0: A0 03                        ldy     #3                ;Get (tempptr) +3, +2, +1
C4B2: 99 41 00     <span id="Sympcgtp4">pcgtp4</span>          sta     <a href="#Symcmmand">cmmand</a>-1,Y        ;First store don't care
C4B5: B1 4A        <span id="Sympcskp4">pcskp4</span>          lda     (<a href="#Symtempptr">tempptr</a>),Y
C4B7: 88                           dey
C4B8: D0 F8                        bne     <a href="#Sympcgtp4">pcgtp4</a>
C4BA: AA                           tax                       ;x = user command
                   ; Command = ptr to parm list. y = 0
C4BB: A0 08                        ldy     #8                ;Max # of param bytes
C4BD: B1 42        <span id="Sympcparms4">pcparms4</span>        lda     (<a href="#Symcmmand">cmmand</a>),Y        ;Get the parms
C4BF: 99 43 00                     sta     <a href="#Symcmmand">cmmand</a>+1,Y        ;Note last store is on top of pointer
C4C2: 88                           dey
C4C3: 10 F8                        bpl     <a href="#Sympcparms4">pcparms4</a>
C4C5: 46 44                        lsr     <a href="#Sympunit">punit</a>             ;Unit 0 or 1?
C4C7: D0 C4                        bne     <a href="#Sympcbad4">pcbad4</a>
C4C9: 8A                           txa                       ;A = Command
C4CA: 2A                           rol     A                 ;Get unit into low bit
C4CB: C9 14                        cmp     #20               ;C = 1 if invalid command
C4CD: B0 BA                        bcs     <a href="#Sympccmd4">pccmd4</a>            ;Branch if bad command
C4CF: 90 9D                        bcc     <a href="#Symdoit4">doit4</a>             ;Always taken

                   ********************************************************************************
                   * Dos entry point stuff                                                        *
                   ********************************************************************************
C4D1: 84 48        <span id="Symdosent4">dosent4</span>         sty     <a href="#Symiobpl">iobpl</a>             ;Store pointer in IOB
C4D3: 85 49                        sta     <a href="#Symiobph">iobph</a>
C4D5: A0 01                        ldy     #<a href="#Symibslot">ibslot</a>           ;Get slot
C4D7: B1 48                        lda     (<a href="#Symiobpl">iobpl</a>),Y
                   ; cmp #4*$10
C4D9: C9 40                        cmp     #$40              ;Is it us?
C4DB: F0 03                        beq     <a href="#Symdosslt4">dosslt4</a>
C4DD: 4C 04 BD                     jmp     <a href="#Symrwts">rwts</a>+4            ;Back to rwts

C4E0: A0 04        <span id="Symdosslt4">dosslt4</span>         ldy     #4                ;Command for DOS
C4E2: 20 62 C4                     jsr     <a href="#Symdos24">dos24</a>             ;Go do it and come back
C4E5: F0 02                        beq     <a href="#Symdosok4">dosok4</a>            ;A = Error code
C4E7: A9 80                        lda     #<a href="#Symdoserr">doserr</a>           ;DOS io error code
C4E9: A0 0D        <span id="Symdosok4">dosok4</span>          ldy     #<a href="#Symibstat">ibstat</a>
C4EB: 91 48                        sta     (<a href="#Symiobpl">iobpl</a>),Y         ;Put error code in status
C4ED: 60                           rts

C4EE: 00 00 00 00+                 DS      12,$00            ;pad with 0's
C4FA: 11                           DFB     <a href="#Sympcrevnum">pcrevnum</a>          ;Smartport revision number
C4FB: 01                           DFB     $01               ;Mark ram card
C4FC: 00 00                        DW      0                 ;Number of blocks = 0 for status call
C4FE: 4F                           DFB     $4F
C4FF: 4E                           DFB     &lt;<a href="#Symentry4">entry4</a>
                                   ADREND  ↑ ~$C400

                   ; 
                   ; Here beginneth that code which resideth in the boot space
                   ;   at the time the card resteth in sloth the fifth.
                   ; 
C500:              UniDisk_Routines
                                   ORG     *+$0000
C500: A2 20        <span id="SymC500org">C500org</span>         ldx     #$20
C502: A2 00                        ldx     #$00
C504: A2 03                        ldx     #$03
C506: C9 00                        cmp     #0                ;Flag that this is a boot
C508: B0 17                        bcs     <a href="#SymBootC">BootC</a>
C50A: 38           <span id="SymProDOSEntry">ProDOSEntry</span>     sec
C50B: B0 01                        bcs     <a href="#SymLC50E">LC50E</a>

C50D: 18           <span id="SymMLIEntry">MLIEntry</span>        clc
C50E: A2 05        <span id="SymLC50E">LC50E</span>           ldx     #$05
C510: 7E 73 04                     ror     $0473,X
C513: 18                           clc
C514: A2 C5                        ldx     #$C5
C516: 8E F8 07                     stx     <a href="#SymMSLOT">MSLOT</a>
C519: A2 05                        ldx     #$05
C51B: AD FF CF                     lda     <a href="#SymClearIOROMs">ClearIOROMs</a>
C51E: 4C 97 C7                     jmp     <a href="#Symswpcnv">swpcnv</a>

C521: A2 05        <span id="SymBootC">BootC</span>           ldx     #$05
C523: 86 58                        stx     $58
C525: A9 C5                        lda     #$C5
C527: 8D F8 07                     sta     <a href="#SymMSLOT">MSLOT</a>
C52A: 20 76 C5                     jsr     <a href="#SymReset">Reset</a>
C52D: A0 05                        ldy     #$05
C52F: B9 70 C5     <span id="SymLC52F">LC52F</span>           lda     <a href="#Symmbsglen">mbsglen</a>,Y
C532: 99 42 00                     sta     <a href="#SymA4L">A4L</a>,Y
C535: 88                           dey
C536: 10 F7                        bpl     <a href="#SymLC52F">LC52F</a>
C538: 20 0A C5                     jsr     <a href="#SymProDOSEntry">ProDOSEntry</a>
C53B: B0 15                        bcs     <a href="#SymLC552">LC552</a>
C53D: AE 00 08                     ldx     <a href="#Symthbuf">thbuf</a>
C540: CA                           dex
C541: D0 0F                        bne     <a href="#SymLC552">LC552</a>
C543: AE 01 08                     ldx     $0801
C546: F0 0A                        beq     <a href="#SymLC552">LC552</a>
C548: A5 58                        lda     $58
C54A: 0A                           asl     A
C54B: 0A                           asl     A
C54C: 0A                           asl     A
C54D: 0A                           asl     A
C54E: AA                           tax
C54F: 4C 01 08                     jmp     $0801

C552: A2 10        <span id="SymLC552">LC552</span>           ldx     #$10
C554: BD 5F C5     <span id="SymLC554">LC554</span>           lda     <a href="#Symbootmsg">bootmsg</a>,X
C557: 9D DB 07                     sta     $07DB,X
C55A: CA                           dex
C55B: 10 F7                        bpl     <a href="#SymLC554">LC554</a>
C55D: 80 FE        <span id="SymLC55D">LC55D</span>           bra     <a href="#SymLC55D">LC55D</a>

C55F: C3 E8 E5 E3+ <span id="Symbootmsg">bootmsg</span>         ASC     “Check Disk Drive.”
C570: 01 50 00 08+ <span id="Symmbsglen">mbsglen</span>         HEX     $01,$50,$00,$08,$00,$00

                   ; 
                   ; 
                   ; this routine is called from the //c reset code.  it forces a
                   ; reset of the PC Bus.  location 0 and 1 are being used by the
                   ; autostart people.
                   ; 
C576: A2 08        <span id="SymReset">Reset</span>           ldx     #8
                   ; 
C578: BD 83 C5     <span id="Symrst1">rst1</span>            lda     <a href="#Symrcode">rcode</a>,X
C57B: 95 02                        sta     <a href="#SymLOC0">LOC0</a>+2,X
C57D: CA                           dex
C57E: 10 F8                        bpl     <a href="#Symrst1">rst1</a>
C580: 4C 02 00                     jmp     <a href="#SymLOC0">LOC0</a>+2

C583: 20 0D C5     <span id="Symrcode">rcode</span>           jsr     <a href="#SymMLIEntry">MLIEntry</a>
C586: 05                           DFB     <a href="#SymInitCMD">InitCMD</a>
C587: 09 00                        DW      $0009
C589: 60                           rts

C58A: 01 00                        HEX     $01,$00           ;One parm - the unit $00
C58C: 00                           DFB     $00
C58D: 00                           DFB     $00
                                   ADREND  ↑ $C500

                   ********************************************************************************
                   * maketbl - makes a deniblizing table for the disk II boot                     *
                   ********************************************************************************
C58E:              disc_misc
                                   ORG     *+$0000
C58E: A2 03        <span id="SymMAKTBL">MAKTBL</span>          ldx     #$03
C590: A0 00                        ldy     #0
C592: 86 3C        <span id="SymTBLLOOP">TBLLOOP</span>         stx     <a href="#SymBOOTTMP">BOOTTMP</a>
C594: 8A                           txa
C595: 0A                           asl     A
C596: 24 3C                        bit     <a href="#SymBOOTTMP">BOOTTMP</a>
C598: F0 10                        beq     <a href="#SymNOPATRN">NOPATRN</a>
C59A: 05 3C                        ora     <a href="#SymBOOTTMP">BOOTTMP</a>
C59C: 49 FF                        eor     #$FF
C59E: 29 7E                        and     #$7E
C5A0: B0 08        <span id="SymTBLLOOP2">TBLLOOP2</span>        bcs     <a href="#SymNOPATRN">NOPATRN</a>
C5A2: 4A                           lsr     A
C5A3: D0 FB                        bne     <a href="#SymTBLLOOP2">TBLLOOP2</a>
C5A5: 98                           tya
C5A6: 9D 56 03                     sta     <a href="#SymDNIBL">DNIBL</a>,X
C5A9: C8                           iny
C5AA: E8           <span id="SymNOPATRN">NOPATRN</span>         inx
C5AB: 10 E5                        bpl     <a href="#SymTBLLOOP">TBLLOOP</a>
C5AD: A9 08                        lda     #$08
C5AF: 85 27                        sta     $27
C5B1: A0 7F                        ldy     #$7F
C5B3: 60                           rts

                   ********************************************************************************
                   * getup - get char from input buffer, iny and upshift it                       *
                   ********************************************************************************
C5B4: B9 00 02     <span id="SymGETUP">GETUP</span>           lda     <a href="#SymIN">IN</a>,Y
C5B7: C8                           iny
C5B8: 4C 99 C3                     jmp     <a href="#SymUPSHIFT0">UPSHIFT0</a>

                   ********************************************************************************
                   * this is who we is in 9 letters                                               *
                   ********************************************************************************
C5BB: C1 F0 F0 EC+ <span id="SymAPPLE2C">APPLE2C</span>         ASC     “Apple //c”

C5C4: 20 D0 F8     <span id="Symshowinst">showinst</span>        jsr     <a href="#Syminstdsp">instdsp</a>
C5C7: 20 53 F9                     jsr     <a href="#Sympcadj">pcadj</a>
C5CA: 85 3A                        sta     <a href="#SymPCL">PCL</a>
C5CC: 84 3B                        sty     <a href="#SymPCH">PCH</a>
C5CE: 60                           rts

                   ********************************************************************************
                   * xmbasic - basic call to the mouse                                            *
                   ********************************************************************************
C5CF: 5A           <span id="Symxmbasic">xmbasic</span>         phy
C5D0: B0 1C                        bcs     <a href="#Symgobasicin">gobasicin</a>         ;input?
C5D2: A0 C7                        ldy     #&gt;<a href="#Symmbasic">mbasic</a>          ;input from $C400?
C5D4: C4 39                        cpy     <a href="#SymKSWH">KSWH</a>
C5D6: D0 04                        bne     <a href="#Symxmbout">xmbout</a>
C5D8: A4 38                        ldy     <a href="#SymKSWL">KSWL</a>
C5DA: F0 12                        beq     <a href="#Symgobasicin">gobasicin</a>
C5DC: DA           <span id="Symxmbout">xmbout</span>          phx                       ;save X too
C5DD: 48                           pha
C5DE: 29 7F                        and     #$7F              ;we don't care about high bit
C5E0: C9 02                        cmp     #2
C5E2: B0 06                        bcs     <a href="#Symmbbad">mbbad</a>             ;only 0,1 valid
C5E4: 20 1C C7                     jsr     <a href="#Symxsetmou">xsetmou</a>
C5E7: 20 3A C7                     jsr     <a href="#Symxmhome">xmhome</a>
C5EA: 68           <span id="Symmbbad">mbbad</span>           pla
C5EB: FA                           plx
C5EC: 7A                           ply
C5ED: 60                           rts

C5EE: 4C 9D C7     <span id="Symgobasicin">gobasicin</span>       jmp     <a href="#Symswbasicin">swbasicin</a>         ;go to input routine

C5F1: 00 00 00 00                  HEX     $00,$00,$00,$00

C5F5: 4C 52 C5     <span id="Symbootfail">bootfail</span>        jmp     <a href="#SymLC552">LC552</a>

C5F8: 4C 76 C5     <span id="SymPCNVRST">PCNVRST</span>         jmp     <a href="#SymReset">Reset</a>

C5FB: 00                           DFB     $00
C5FC: 00                           DFB     $00
C5FD: 00                           DFB     $00
C5FE: BF                           DFB     $BF
C5FF: 0A                           DFB     $0A
                                   ADREND  ↑ $C58E

                   ********************************************************************************
                   *                                                                              *
                   * Disk II boot stuff                                                           *
                   * jumps to slot 5 if boot fails                                                *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C600
C600: A2 20        <span id="Syms6_disk2_boot">s6_disk2_boot</span>   ldx     #$20
C602: A0 00                        ldy     #$00
C604: 64 03                        stz     $03
C606: 64 3C                        stz     $3C
C608: A9 60                        lda     #$60
C60A: AA                           tax
C60B: 86 2B        <span id="SymDRV2ENT">DRV2ENT</span>         stx     <a href="#SymSLOTZ">SLOTZ</a>
C60D: 85 4F                        sta     <a href="#SymBOOTDEV">BOOTDEV</a>
C60F: 5A                           phy                       ;Y=1 IF DRIVE 2 BOOT, ELSE Y=0
C610: BD 8E C0                     lda     $C08E,X
C613: BD 8C C0                     lda     $C08C,X
C616: 7A                           ply
C617: B9 EA C0                     lda     $C0EA,Y           ;SELECT DRIVE 1 or @
C61A: BD 89 C0                     lda     $C089,X
C61D: A0 50                        ldy     #$50
C61F: BD 80 C0     <span id="SymSEEKZERO">SEEKZERO</span>        lda     $C080,X
C622: 98                           tya
C623: 29 03                        and     #$03
C625: 0A                           asl     A
C626: 05 2B                        ora     <a href="#SymSLOTZ">SLOTZ</a>
C628: AA                           tax
C629: BD 81 C0                     lda     $C081,X
C62C: A9 56                        lda     #$56
C62E: 20 A8 FC                     jsr     <a href="#SymWAIT">WAIT</a>
C631: 88                           dey
C632: 10 EB                        bpl     <a href="#SymSEEKZERO">SEEKZERO</a>
C634: 85 26                        sta     $26
C636: 85 3D                        sta     $3D
C638: 85 41                        sta     $41
C63A: 20 8E C5                     jsr     <a href="#SymMAKTBL">MAKTBL</a>
C63D: 64 03        <span id="SymEXTENT1">EXTENT1</span>         stz     $03
C63F: 18           <span id="SymRDADR">RDADR</span>           clc
C640: 08                           php
C641: 28           <span id="SymRETRY1">RETRY1</span>          plp
C642: A6 2B        <span id="SymRDDHDR">RDDHDR</span>          ldx     <a href="#SymSLOTZ">SLOTZ</a>             ;RESTORE X TO $60
C644: C6 03                        dec     $03               ;UPDATE RETRY COUNT
C646: D0 0E                        bne     <a href="#SymRDHD0">RDHD0</a>             ;BRANCH IF NOT OUT OF RETRIES
C648: BD 88 C0                     lda     $C088,X           ;SHUT OFF DISK AND QUIT!
C64B: A5 01                        lda     <a href="#SymLOC1">LOC1</a>              ;auto boot form slot 6?
C64D: C9 C6                        cmp     #$C6
C64F: D0 A4                        bne     <a href="#Symbootfail">bootfail</a>
C651: 4C 00 C5                     jmp     $C500             ;maybe slot 5 will talk to us

C654: 00 00                        HEX     $00,$00           ;Keep alignment

C656: 08           <span id="SymRDHD0">RDHD0</span>           php
C657: 88           <span id="SymRETRY">RETRY</span>           dey
C658: D0 04                        bne     <a href="#SymRDHD1">RDHD1</a>
C65A: F0 E5                        beq     <a href="#SymRETRY1">RETRY1</a>

C65C: 80 DF                        bra     <a href="#SymEXTENT1">EXTENT1</a>           ;Blows up if this is moved

                   ********************************************************************************
                   * The following code is sacred in it's                                         *
                   * present form.  To change it would                                            *
                   * cause volcanos to errupt, the ground                                         *
                   * to shake, and ProDOS not to boot!                                            *
                   ********************************************************************************
C65E: BD 8C C0     <span id="SymRDHD1">RDHD1</span>           lda     $C08C,X
C661: 10 FB                        bpl     <a href="#SymRDHD1">RDHD1</a>
C663: 49 D5        <span id="SymISMRK1">ISMRK1</span>          eor     #$D5
C665: D0 F0                        bne     <a href="#SymRETRY">RETRY</a>
C667: BD 8C C0     <span id="SymRDHD2">RDHD2</span>           lda     $C08C,X
C66A: 10 FB                        bpl     <a href="#SymRDHD2">RDHD2</a>
C66C: C9 AA                        cmp     #$AA
C66E: D0 F3                        bne     <a href="#SymISMRK1">ISMRK1</a>
C670: EA                           nop
C671: BD 8C C0     <span id="SymRDHD3">RDHD3</span>           lda     $C08C,X
C674: 10 FB                        bpl     <a href="#SymRDHD3">RDHD3</a>
C676: C9 96                        cmp     #$96
C678: F0 09                        beq     <a href="#SymRDSECT">RDSECT</a>
C67A: 28                           plp
C67B: 90 C2                        bcc     <a href="#SymRDADR">RDADR</a>
C67D: 49 AD                        eor     #$AD
C67F: F0 25                        beq     <a href="#SymRDATA">RDATA</a>
C681: D0 BC                        bne     <a href="#SymRDADR">RDADR</a>

C683: A0 03        <span id="SymRDSECT">RDSECT</span>          ldy     #$03
C685: 85 40        <span id="SymRDSEC1">RDSEC1</span>          sta     $40
C687: BD 8C C0     <span id="SymRDSEC2">RDSEC2</span>          lda     $C08C,X
C68A: 10 FB                        bpl     <a href="#SymRDSEC2">RDSEC2</a>
C68C: 2A                           rol     A
C68D: 85 3C                        sta     <a href="#SymBOOTTMP">BOOTTMP</a>
C68F: BD 8C C0     <span id="SymRDSEC3">RDSEC3</span>          lda     $C08C,X
C692: 10 FB                        bpl     <a href="#SymRDSEC3">RDSEC3</a>
C694: 25 3C                        and     <a href="#SymBOOTTMP">BOOTTMP</a>
C696: 88                           dey
C697: D0 EC                        bne     <a href="#SymRDSEC1">RDSEC1</a>
C699: 28                           plp
C69A: C5 3D                        cmp     $3D
C69C: D0 A1                        bne     <a href="#SymRDADR">RDADR</a>
C69E: A5 40                        lda     $40
C6A0: C5 41                        cmp     $41
C6A2: D0 9B        <span id="SymBADRD1">BADRD1</span>          bne     <a href="#SymRDADR">RDADR</a>
C6A4: B0 9C                        bcs     <a href="#SymRDDHDR">RDDHDR</a>
C6A6: A0 56        <span id="SymRDATA">RDATA</span>           ldy     #$56
C6A8: 84 3C        <span id="SymRDAT0">RDAT0</span>           sty     <a href="#SymBOOTTMP">BOOTTMP</a>
C6AA: BC 8C C0     <span id="SymRDAT1">RDAT1</span>           ldy     $C08C,X
C6AD: 10 FB                        bpl     <a href="#SymRDAT1">RDAT1</a>
C6AF: 59 D6 02                     eor     <a href="#SymDNIBL">DNIBL</a>-128,Y
C6B2: A4 3C                        ldy     <a href="#SymBOOTTMP">BOOTTMP</a>
C6B4: 88                           dey
C6B5: 99 00 03                     sta     <a href="#SymNBUF1">NBUF1</a>,Y
C6B8: D0 EE                        bne     <a href="#SymRDAT0">RDAT0</a>
C6BA: 84 3C        <span id="SymRDAT2">RDAT2</span>           sty     <a href="#SymBOOTTMP">BOOTTMP</a>
C6BC: BC 8C C0     <span id="SymRDAT3">RDAT3</span>           ldy     $C08C,X
C6BF: 10 FB                        bpl     <a href="#SymRDAT3">RDAT3</a>
                   <span style="background-color: #cbcb00">NOTE: Watch this line when decoding bank vector code</span>
C6C1: 59 D6 02                     eor     <a href="#SymDNIBL">DNIBL</a>-128,Y
C6C4: A4 3C                        ldy     <a href="#SymBOOTTMP">BOOTTMP</a>
C6C6: 91 26                        sta     ($26),Y
C6C8: C8                           iny
C6C9: D0 EF                        bne     <a href="#SymRDAT2">RDAT2</a>
C6CB: BC 8C C0     <span id="SymRDAT4">RDAT4</span>           ldy     $C08C,X
C6CE: 10 FB                        bpl     <a href="#SymRDAT4">RDAT4</a>
C6D0: 59 D6 02                     eor     <a href="#SymDNIBL">DNIBL</a>-128,Y
C6D3: D0 CD        <span id="SymBADREAD">BADREAD</span>         bne     <a href="#SymBADRD1">BADRD1</a>
C6D5: A0 00                        ldy     #$00
C6D7: A2 56        <span id="SymDENIBL">DENIBL</span>          ldx     #$56
C6D9: CA           <span id="SymDENIB1">DENIB1</span>          dex
C6DA: 30 FB                        bmi     <a href="#SymDENIBL">DENIBL</a>
C6DC: B1 26                        lda     ($26),Y
C6DE: 5E 00 03                     lsr     <a href="#SymNBUF1">NBUF1</a>,X
C6E1: 2A                           rol     A
C6E2: 5E 00 03                     lsr     <a href="#SymNBUF1">NBUF1</a>,X
C6E5: 2A                           rol     A
C6E6: 91 26                        sta     ($26),Y
C6E8: C8                           iny
C6E9: D0 EE                        bne     <a href="#SymDENIB1">DENIB1</a>
                   ; Code beyond this point is not 
                   ; sacred... It may be perverted
                   ; in any manner by any pervert.
C6EB: E6 27                        inc     $27
C6ED: E6 3D                        inc     $3D
C6EF: A5 3D                        lda     $3D
C6F1: CD 00 08                     cmp     $0800
C6F4: A6 4F                        ldx     <a href="#SymBOOTDEV">BOOTDEV</a>
C6F6: 90 DB                        bcc     <a href="#SymBADREAD">BADREAD</a>
                   <span style="background-color: #cbcb00">NOTE: Watch this line when decoding bank vector code</span>
C6F8: 4C 01 08                     jmp     $0801

C6FB: 00 00 00 00+                 HEX     $00,$00,$00,$00,$00 ;Last byte must be 0
                                   ADREND  ↑ ~$C600

                   ********************************************************************************
                   *                                                                              *
                   * Mouse firmware for the Chels                                                 *
                   *                                                                              *
                   *  by Rich Williams                                                            *
                   *  July, 1983                                                                  *
                   *                                                                              *
                   * ***                                                                          *
                   *                                                                              *
                   * Moustat provides the following                                               *
                   *   D7= Button pressed                                                         *
                   *   D6= Status of button on last read                                          *
                   *   D5= Moved since last read                                                  *
                   *   D4= Reserved                                                               *
                   *   D3= Interrupt from VBL                                                     *
                   *   D2= Interrupt from button                                                  *
                   *   D1= Interrupt from movement                                                *
                   *   D0= Reserved                                                               *
                   *                                                                              *
                   * moumode (Mouse Mode)                                                         *
                   *   D7= 1 if user wanted control of mouse interrupts                           *
                   *   D6-4= Unused                                                               *
                   *   D3= VBL active                                                             *
                   *   D2= VBL interrupt on button                                                *
                   *   D1= VBL interrupt on movement                                              *
                   *   D0= Mouse active                                                           *
                   *                                                                              *
                   * ***                                                                          *
                   *                                                                              *
                   * Entry points for mouse firmware                                              *
                   *                                                                              *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C700
C700: 80           <span id="Symmbasic">mbasic</span>          DFB     $80
C701: 05                           DFB     $05

C702: A2 03        <span id="Sympunull">punull</span>          ldx     #3
C704: 60                           rts                       ;Null for pascal entry

C705: 38           <span id="Syminent">inent</span>           DFB     $38               ;Signature bytes
C706: 90                           DFB     $90
C707: 18           <span id="Symoutent">outent</span>          DFB     $18
C708: 4C                           DFB     $4C               ;Go do basic entry
C709: CF                           DFB     $CF
C70A: C5                           DFB     $C5
C70B: 01                           DFB     $01               ;more siganture stuff
C70C: 20                           DFB     $20
C70D: 02                           DFB     <a href="#Sympnull">pnull</a>
C70E: 02                           DFB     <a href="#Sympnull">pnull</a>
C70F: 02                           DFB     <a href="#Sympnull">pnull</a>
C710: 02                           DFB     <a href="#Sympnull">pnull</a>
C711: 00                           DFB     $00
C712: 1C                           DFB     &lt;<a href="#Symxsetmou">xsetmou</a>          ;SETMOUSE
C713: 22                           DFB     &lt;<a href="#Symxmtstint">xmtstint</a>         ;SERVEMOUSE
C714: 28                           DFB     &lt;<a href="#Symxmread">xmread</a>           ;READMOUSE
C715: 2E                           DFB     &lt;<a href="#Symxmclear">xmclear</a>          ;CLEARMOUSE
C716: 1A                           DFB     &lt;<a href="#Symnoerror">noerror</a>          ;POSMOUSE
C717: 34                           DFB     &lt;<a href="#Symxmclamp">xmclamp</a>          ;CLAMPMOUSE
C718: 3A                           DFB     &lt;<a href="#Symxmhome">xmhome</a>           ;HOMEMOUSE
C719: 40                           DFB     &lt;<a href="#Syminitmouse">initmouse</a>        ;INITMOUSE

                   <span style="background-color: #89acb7">NOTE: C71A ;dfb &gt;pnull</span>
                   <span style="background-color: #89acb7">C71A ;dfb &gt;goxmint</span>
C71A: 18           <span id="Symnoerror">noerror</span>         clc
C71B: 60                           rts

                   <span style="background-color: #cb9099">NOTE: need to add these addresses, since I think they are in bank 2</span>
                   <span style="background-color: #cb9099">pdf page 443</span>
C71C: 8D 28 C0     <span id="Symxsetmou">xsetmou</span>         ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C71F: 4C C2 C6                     ADR     $C6C24C           ;do the real thing
C722: 8D 28 C0     <span id="Symxmtstint">xmtstint</span>        ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C725: 4C CD C6                     ADR     <a href="#Symsw_mstint">sw_mstint</a>+$C6067F ;do the real thing
C728: 8D 28 C0     <span id="Symxmread">xmread</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C72B: 4C D8 C6                     ADR     <a href="#Symsw_mread">sw_mread</a>+$C61174  ;do the real thing
C72E: 8D 28 C0     <span id="Symxmclear">xmclear</span>         ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C731: 4C E3 C6                     ADR     <a href="#Symsw_mclear">sw_mclear</a>+$C61C69 ;do the real thing
C734: 8D 28 C0     <span id="Symxmclamp">xmclamp</span>         ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C737: 4C EE C6                     ADR     <a href="#Symsw_mclamp">sw_mclamp</a>+$C6275E ;do the real thing
C73A: 8D 28 C0     <span id="Symxmhome">xmhome</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C73D: 4C F9 C6                     ADR     <a href="#Symsw_mhome">sw_mhome</a>+$C63253  ;do the real thing
C740: 8D 28 C0     <span id="Syminitmouse">initmouse</span>       ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C743: 4C 04 C7                     ADR     <a href="#Symsw_initmouse">sw_initmouse</a>+$C63D48 ;do the real thing
C746: 8D 28 C0                     ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C749: 4C 9A CF                     ADR     <a href="#Symm_oveirq">m_oveirq</a>+$CECAB2  ;from other wside
C74C: 8D 28 C0     <span id="Symslboot">slboot</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C74F: 4C B4 C6                     ADR     <a href="#Symswsl_bt">swsl_bt</a>+$C5ED98   ;other side
C752: 8D 28 C0     <span id="Symslxeq">slxeq</span>           ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C755: DA                           DFB     $DA
C756: 20 16 C8                     ADR     $C81620
C759: 5A                           DFB     $5A
C75A: 8C 78 06                     ADR     <a href="#Symsl_lcstate">sl_lcstate</a>+$67214
C75D: 20 00 D8                     ADR     <a href="#Symexecute">execute</a>+$D72820
C760: 4C 0E C8                     ADR     <a href="#Symfixlc">fixlc</a>+$C7463E
C763: 00 00 00 00+                 DS      29,$00
                   ; 
                   ; Code for swtiching between banks
                   ; This code appears in both banks of the rom
C780: 8D 28 C0     <span id="Symswrti">swrti</span>           ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;RTI to the other bank
C783: 40                           DFB     $40
C784: 8D 28 C0     <span id="Symswrts">swrts</span>           ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;RTS to the other bank
C787: 60           <span id="Symswrtsop">swrtsop</span>         DFB     $60
C788: 8D 28 C0     <span id="Symswreset">swreset</span>         ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Reset routine
C78B: 4C                           DFB     $4C
C78C: 62                           DFB     $62
C78D: FA                           DFB     $FA
C78E: 8D 28 C0                     ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Interrupt routine
C791: 2C                           DFB     $2C               ;Set V = 1 for other bank
C792: 87                           DFB     $87
C793: C7                           DFB     $C7
C794: 4C                           DFB     $4C
C795: 04                           DFB     $04
C796: C8                           DFB     $C8
C797: 8D 28 C0     <span id="Symswpcnv">swpcnv</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Protocol converter
C79A: 4C                           DFB     $4C               ;Jump to sethooks from other side
C79B: F1                           DFB     $F1
C79C: C7                           DFB     $C7
C79D: 8D 28 C0     <span id="Symswbasicin">swbasicin</span>       ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Mouse BASIC routines
C7A0: 4C                           DFB     $4C               ;Jump to zzquit from other side
C7A1: F6                           DFB     $F6
C7A2: C7                           DFB     $C7
C7A3: 8D 28 C0     <span id="Symswsttm">swsttm</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Set terminal mode
C7A6: 4C                           DFB     $4C
C7A7: F1                           DFB     $F1
C7A8: C7                           DFB     $C7
C7A9: 8D 28 C0     <span id="Symswcmd">swcmd</span>           ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Serial port command processor
C7AC: 4C 06 C8                     ADR     <a href="#Symswcmd3">swcmd3</a>+$C73E46
C7AF: 8D 28 C0     <span id="SymSWAUX">SWAUX</span>           ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Moveaux
C7B2: 4C 4E C3                     ADR     <a href="#Symmoveaux">moveaux</a>+$C2869D
C7B5: 8D 28 C0     <span id="SymSWXFER">SWXFER</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C7B8: 4C 97 C3                     ADR     <a href="#Symxfer">xfer</a>+$C2D3B5
C7BB: 8D 28 C0     <span id="Symswmint">swmint</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Mouse interrupt handler
C7BE: 4C 00 C1                     ADR     <a href="#Symmouseint">mouseint</a>+$C03F4C
C7C1: 8D 28 C0     <span id="Symbanger">banger</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C7C4: 4C 8E D4                     ADR     <a href="#Symdiags">diags</a>+$D3B9BE
C7C7: 8D 28 C0     <span id="Symswatalk_">swatalk_?</span>       ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to appletalk
C7CA: 4C 80 C5                     ADR     <a href="#Symatalk">atalk</a>+$C4BACC
C7CD: 8D 28 C0     <span id="Symswser3">swser3</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to serout3
C7D0: 4C 4F C2                     ADR     <a href="#Symserout3">serout3</a>+$C18CFD
C7D3: 8D 28 C0     <span id="Symswgetst">swgetst</span>         ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to getstat
C7D6: 4C AC C2                     ADR     <a href="#Symgetstat">getstat</a>+$C1E9A0
C7D9: 8D 28 C0     <span id="Symswread">swread</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to xrdser
C7DC: 4C C3 C2                     ADR     <a href="#Symxrdser">xrdser</a>+$C20089
C7DF: 8D 28 C0     <span id="Symswgetb">swgetb</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to getbuf
C7E2: 4C F7 C2                     ADR     <a href="#Symgetbuf">getbuf</a>+$C23455
C7E5: 8D 28 C0     <span id="Symswzznm">swzznm</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865
C7E8: 4C C5 D4                     ADR     <a href="#Symzznm">zznm</a>+$D3F087
C7EB: 8D 28 C0     <span id="Symswxfgo">swxfgo</span>          ADR     <a href="#SymROMBANK">ROMBANK</a>+$BF6865   ;Jump to users xfer dest
C7EE: 6C                           DFB     $6C
C7EF: ED                           DFB     $ED
C7F0: 03                           DFB     $03
C7F1: 20 23 CE     <span id="Symswsthk3">swsthk3</span>         ADR     <a href="#Symsethooks">sethooks</a>+$CD54FD
C7F4: 80                           DFB     $80
C7F5: 8E                           DFB     $8E
C7F6: 20           <span id="Symswzzqt3">swzzqt3</span>         DFB     $20
C7F7: 4D                           DFB     $4D
C7F8: CE                           DFB     $CE
C7F9: 80                           DFB     $80
C7FA: 89                           DFB     $89
C7FB: D6                           DFB     $D6               ;should be at $C7FB
C7FC: 00 00 00                     HEX     $00,$00,$00
C7FF: 00                           DFB     $00               ;Appletalk version number
                                   ADREND  ↑ ~$C700

                   ********************************************************************************
                   *                                                                              *
                   * NEWIRQ - The main (only) IRQ handling routines                               *
                   * IRQENT - Entry point from alternate rom bank                                 *
                   *                                                                              *
                   *                                                                              *
                   * This routine saves the memory state of the machine,                          *
                   * checks for an internal interrupt, and then calls the user's                  *
                   * interrupt handler at $3FE.                                                   *
                   * The memory state is encoded as follows;                                      *
                   *  D7 = 1 if Alternate zero page / stack                                       *
                   *  D6 = 1 if 80 store and page 2                                               *
                   *  D5 = 1 if Read aux                                                          *
                   *  D4 = 1 if Write Aux                                                         *
                   *  D3 = 1 if L.C. enabled                                                      *
                   *  D2 = 1 if L.C. and $D000 bank 1                                             *
                   *  D1 = 1 if L.C. and $D000 bank 2                                             *
                   *  D0 = 1 if Alternate rom bank                                                *
                   *                                                                              *
                   *  New Changes in the interrupt handler are marked with a +                    *
                   *                                                                              *
                   ********************************************************************************
                                   ORG     $C800
C800: 4C 9E C1                     jmp     <a href="#Symplinit">plinit</a>            ;Pascal 1.0 Initialization

C803: B8           <span id="SymNEWIRQ">NEWIRQ</span>          clv                       ;+
                   ; + V=0 for main bank
C804: 48           <span id="Symirqent">irqent</span>          pha                       ;+ Entry pt from other bank assumes V=1
C805: DA                           phx                       ;+ X too
C806: BA                           tsx                       ;+ Save stack pointer
C807: 68                           pla                       ;+ Skip past X
C808: 68                           pla                       ;+ And A
C809: 68                           pla                       ;+ Here is the status Oh boy!
C80A: 9A                           txs                       ;+ Fix the stack pointer
C80B: 5A                           phy                       ;Save Y too
                   <span style="background-color: #cb9099">NOTE: these loads are supposed to be two byte?</span>
C80C: AE 66 C0                     ldx     <a href="#SymMOUXL">MOUXL</a>             ;Get mouse info
C80F: AC 67 C0                     ldy     <a href="#SymMOUYL">MOUYL</a>             ;As soon as we can
C812: D8                           cld                       ;+ No decimal mode please
C813: 29 10                        and     #$10              ;+ Test break bit
C815: C9 10                        cmp     #$10              ;+ C=1 if break. V unchanged
C817: AD 18 C0                     lda     <a href="#SymRD80COL">RD80COL</a>           ;TEST FOR 80-STORE WITH
C81A: 2D 1C C0                     and     <a href="#SymRDPAGE2">RDPAGE2</a>           ; PAGE 2 TEXT.
C81D: 29 80                        and     #$80              ; MAKE IT ZERO or $80
C81F: F0 05                        beq     <a href="#SymIRQ2">IRQ2</a>
C821: 8D 54 C0                     sta     <a href="#SymTXTPAGE1">TXTPAGE1</a>
C824: A9 40                        lda     #$40              ;SET PAGE 2 RESET BIT
C826: 50 02        <span id="SymIRQ2">IRQ2</span>            bvc     <a href="#SymIRQ21">IRQ21</a>             ; + Which Rombank?

C828: 09 01                        ora     #$01              ;+ Mark other bank
C82A: 2C 13 C0     <span id="SymIRQ21">IRQ21</span>           bit     <a href="#SymRDRAMRD">RDRAMRD</a>
C82D: 10 05                        bpl     <a href="#SymIRQ3">IRQ3</a>              ;BRANCH IF MAIN RAM READ
C82F: 8D 02 C0                     sta     <a href="#SymRDMAINRAM">RDMAINRAM</a>         ;ELSE, SWITCH IT IN
C832: 09 20                        ora     #$20              ; AND RECORD THE EVENT!
C834: 2C 14 C0     <span id="SymIRQ3">IRQ3</span>            bit     <a href="#SymRDRAMWRT">RDRAMWRT</a>          ;DO THE SAME FOR RAM WRITE.
C837: 10 05                        bpl     <a href="#SymIRQ4">IRQ4</a>
C839: 8D 04 C0                     sta     <a href="#SymWRMAINRAM">WRMAINRAM</a>
C83C: 09 10                        ora     #$10
C83E: B0 08        <span id="SymIRQ4">IRQ4</span>            bcs     <a href="#SymIRQ5">IRQ5</a>              ;Branch if break
C840: 48                           pha                       ;Save machine states so far...
C841: 20 BB C7                     jsr     <a href="#Symswmint">swmint</a>            ;+ Go Test Mouse &amp; ACIA
C844: 90 3C                        bcc     <a href="#SymIRQLCOK">IRQLCOK</a>           ;+ Branch if it was.  LC unchanged!
C846: 68                           pla                       ;Restore states recorded so far
C847: 18                           clc                       ;Reset break/interrupt handler
C848: 2C 12 C0     <span id="SymIRQ5">IRQ5</span>            bit     <a href="#SymRDLCRAM">RDLCRAM</a>           ;DETERMINE IF LANGUAGE CARD ACTIVE
C84B: 80 03                        bra     <a href="#Sympasskip1">passkip1</a>          ;Skip around pascal 1.0 stuff

C84D: 4C A8 C1                     jmp     <a href="#Symplread">plread</a>

C850: 10 0C        <span id="Sympasskip1">passkip1</span>        bpl     <a href="#SymIRQ7">IRQ7</a>
C852: 09 0C                        ora     #$0C              ;SET TWO BITS SO RESTORED
C854: 2C 11 C0                     bit     <a href="#SymRDLCBNK2">RDLCBNK2</a>          ; LANGUAGE CARD IS WRITE ENABLED
C857: 10 02                        bpl     <a href="#SymIRQ6">IRQ6</a>              ;BRANCH IF NOT PAGE 2 OF $D000
C859: 49 06                        eor     #6                ;ENABLE READ FOR PAGE 2 ON EXIT
C85B: 8D 81 C0     <span id="SymIRQ6">IRQ6</span>            sta     <a href="#SymROMIN">ROMIN</a>
C85E: 2C 16 C0     <span id="SymIRQ7">IRQ7</span>            bit     <a href="#SymRDALTZP">RDALTZP</a>           ;LAST...AND VERY IMPORTANT!
C861: 10 0D                        bpl     <a href="#SymIRQ8">IRQ8</a>              ; UNLESS IT IS NOT ENABLED
C863: BA                           tsx                       ;SAVE CURRENT STACK POINTER
C864: 8E 01 01                     stx     <a href="#Symrevnum">revnum</a>            ;AT BOTTOM OF STACK
C867: AE 00 01                     ldx     <a href="#Symrevnum">revnum</a>-1          ;GET MAIN STACK POINTER
C86A: 9A                           txs
C86B: 8D 08 C0                     sta     <a href="#SymSETSTDZP">SETSTDZP</a>
C86E: 09 80                        ora     #$80
C870: B0 35        <span id="SymIRQ8">IRQ8</span>            bcs     <a href="#SymGOBREAK">GOBREAK</a>
C872: 48                           pha
C873: A9 C8                        lda     #&gt;<a href="#SymIRQDONE">IRQDONE</a>
C875: 48                           pha
C876: A9 7F                        lda     #&lt;<a href="#SymIRQDONE">IRQDONE</a>         ;SAVE RETURN IRQ ADDR
C878: 48                           pha
C879: A9 04                        lda     #4                ; SO WHEN INTERRUPT DOES RTI
C87B: 48                           pha                       ; IT RETURNS TO IRQDONE.
C87C: 6C FE 03                     jmp     ($03FE)           ;PROCESS EXTERNAL INTERRUPT

                   ; The user's RTI returns here
                   ; BEWARE
                   ;  The rom must be reenabled with a LDA romin
                   ;  This way if the LC was write protected, it still is
                   ;    if it was write eanbled, it still is
                   ;    if it was being write enabled (2 ldas), it still will be
                   ;  The restore loop uses an INC because some of the switches are read
                   ;  and some are write.  It must ben an INC abs,x since both the 6502 and
                   ;  the 65C02 do two reads before the write (for different reasons).
C87F: AD 81 C0     <span id="SymIRQDONE">IRQDONE</span>         lda     <a href="#SymROMIN">ROMIN</a>             ;+ Did some clown bank out the rom?
C882: 68           <span id="SymIRQLCOK">IRQLCOK</span>         pla                       ;Recover machine state
C883: 10 07                        bpl     <a href="#SymIRQDN1">IRQDN1</a>            ;Branch if main zp was active
C885: 8D 09 C0                     sta     <a href="#SymSETALTZP">SETALTZP</a>
C888: AE 01 01                     ldx     $0101             ;Restore alternate stack pointer
C88B: 9A                           txs
C88C: A0 06        <span id="SymIRQDN1">IRQDN1</span>          ldy     #$06              ;+ Y = index into table of switches
C88E: 10 06        <span id="SymIRQDN2">IRQDN2</span>          bpl     <a href="#SymIRQDN3">IRQDN3</a>            ;+ Branch if no change
C890: BE 86 CF                     ldx     <a href="#SymIRQTBLE">IRQTBLE</a>,Y         ;+ Get soft switch address
C893: FE 00 C0                     inc     $C000,X           ;+ Hit the switch. No page cross!!!
C896: 88           <span id="SymIRQDN3">IRQDN3</span>          dey
C897: 30 03                        bmi     <a href="#SymIRQDN4">IRQDN4</a>            ;+ Branch if all done
C899: 0A                           asl     A                 ;Get next bit to check
C89A: D0 F2                        bne     <a href="#SymIRQDN2">IRQDN2</a>            ;+ Fall through if all done
C89C: 0A           <span id="SymIRQDN4">IRQDN4</span>          asl     A                 ;+ C = 1 if other rom bank
C89D: 0A                           asl     A                 ;+
C89E: 7A                           ply
C89F: FA                           plx                       ;RESTORE ALL REGISTERS
C8A0: 68                           pla
C8A1: B0 01                        bcs     <a href="#SymIRQDN5">IRQDN5</a>            ;+ Which rom bank?
C8A3: 40                           rti                       ;DO THE REAL RTI!

C8A4: 4C 80 C7     <span id="SymIRQDN5">IRQDN5</span>          jmp     <a href="#Symswrti">swrti</a>             ;+ Go back to the other bank

                   ; GOBREAK- If a braek instruction has occured, we check
                   ; if the BRK happened in the alternate rom bank.  If it has,
                   ; some fool may have hit the rom switch by accident and the PC
                   ; decremented by two, the main rom is switched in and we resume
                   ; where we think he wanted to go
C8A7: 30 20        <span id="SymGOBREAK">GOBREAK</span>         bmi     <a href="#SymGBBRK">GBBRK</a>             ;Give up if alt zp
C8A9: 89 09                        bit     #9                ;From alt rom and no lang card?
C8AB: F0 1C                        beq     <a href="#SymGBBRK">GBBRK</a>             ;If not then break
C8AD: 29 FE                        and     #$FE              ;Force main rom
C8AF: 48                           pha                       ;Save state
C8B0: BA                           tsx                       ;Save stack pointer
C8B1: 68                           pla                       ;Skip State
C8B2: 68                           pla                       ;Skip Y
C8B3: 68                           pla                       ;Skip X
C8B4: 68                           pla                       ;Skip A
C8B5: 68                           pla                       ;Skip p
                   <span style="background-color: #89acb7">NOTE: These &gt; and &lt; are as commented in OG code. But I have a feeling they are</span>
                   <span style="background-color: #89acb7">backward (like all other high/low references.)</span>
C8B6: 68                           pla                       ;&gt; address
C8B7: 7A                           ply                       ;&lt; address
C8B8: C0 C1                        cpy     #$C1              ;In the ROM?
C8BA: 90 0B                        bcc     <a href="#SymGBNOTROM">GBNOTROM</a>          ;Branch if not
C8BC: E9 02                        sbc     #2                ;PC = PC -2
C8BE: B0 01                        bcs     <a href="#SymGBNOC">GBNOC</a>
C8C0: 88                           dey                       ;Borrow from high byte
C8C1: 5A           <span id="SymGBNOC">GBNOC</span>           phy                       ;Push new address
C8C2: 48                           pha
C8C3: 9A                           txs                       ;Fix stack pointer
C8C4: 4C 7F C8                     jmp     <a href="#SymIRQDONE">IRQDONE</a>

C8C7: 9A           <span id="SymGBNOTROM">GBNOTROM</span>        txs                       ;Fix stack pointer
C8C8: 68                           pla                       ;Get state back
C8C9: 4C 47 FA     <span id="SymGBBRK">GBBRK</span>           jmp     <a href="#SymNEWBRK">NEWBRK</a>            ;Go do the break

                   ;   The following routine is for reading key-
                   ; board from buffers or directly.
                   ;   Type-ahead buffering only occurs for non-auto
                   ; repeat keypresses.  When a key is pressed for
                   ; auto-repreat the buffer is first emptied, then the
                   ; repeated characters are returned.
                   ;   The minus flag is used to indicate if a keystroke
                   ; is being returned.
C8CC: AD 00 C0     <span id="SymXRKBD1">XRKBD1</span>          lda     <a href="#SymKBD">KBD</a>               ;test keyboard directly
C8CF: 10 04                        bpl     <a href="#SymXRDKBD">XRDKBD</a>            ;loop if buffered since test
C8D1: 8D 10 C0                     sta     <a href="#SymKBDSTRB">KBDSTRB</a>           ;Clear keyboard strobe.
C8D4: 60           <span id="SymXNOKEY">XNOKEY</span>          rts                       ;Minus flag indicates valid character

C8D5: 20 E6 C8     <span id="SymXRDKBD">XRDKBD</span>          jsr     <a href="#SymXBITKBD">XBITKBD</a>           ;is keyboard input ready?
C8D8: 10 FA                        bpl     <a href="#SymXNOKEY">XNOKEY</a>            ;Branch if not.
C8DA: 90 F0                        bcc     <a href="#SymXRKBD1">XRKBD1</a>            ;Branch if direct KBD input.
C8DC: 5A                           phy                       ;Save Y
C8DD: A0 80                        ldy     #$80              ;Y=$80 for keyboard buffer
C8DF: 20 DF C7                     jsr     <a href="#Symswgetb">swgetb</a>            ;Get data from buffer
C8E2: 7A                           ply
C8E3: 09 00                        ora     #0                ;Set minus flag
C8E5: 60                           rts

                   ; This routine replaces "BIT KBD" instructions so as to function with type-ahead
C8E6: 2C FA 05     <span id="SymXBITKBD">XBITKBD</span>         bit     <a href="#Symtyphed">typhed</a>
C8E9: 10 10                        bpl     <a href="#SymXBKB2">XBKB2</a>
C8EB: 38                           sec                       ;anticipate data in buffer is ready
C8EC: 08                           php                       ;save carry and minus flags
C8ED: 48                           pha                       ;preserve accumulator
C8EE: AD FF 06                     lda     <a href="#Symtrkey">trkey</a>
C8F1: CD FC 05                     cmp     <a href="#Symtwkey">twkey</a>             ;is there data to read?
C8F4: F0 03                        beq     <a href="#SymXBKB1">XBKB1</a>             ;branch if type-ahead buffer empty
C8F6: 68                           pla
C8F7: 28                           plp
C8F8: 60                           rts                       ;Carry and minus flag already set.

C8F9: 68           <span id="SymXBKB1">XBKB1</span>           pla
C8FA: 28                           plp                       ;Retore ACC and Status
C8FB: 2C 00 C0     <span id="SymXBKB2">XBKB2</span>           bit     <a href="#SymKBD">KBD</a>               ;test KBD Directly
C8FE: 18                           clc                       ;indicate direct test
C8FF: 60                           rts
                                   ADREND  ↑ ~$C800

                   ; 
                   ; PADDLE patch
                   ; This routine returns the mouse position instead of
                   ; the paddle if the mouse is on
                   ; 
                                   ORG     $C900
C900: AD FF 07     <span id="SymMPADDLE">MPADDLE</span>         lda     <a href="#Symmoumode">moumode</a>           ;Is the mouse active?
C903: C9 01                        cmp     #1                ;Only transparent mode
C905: F0 06                        beq     <a href="#Sympdon">pdon</a>
C907: AD 70 C0                     lda     <a href="#Symvblclr">vblclr</a>            ;Fire the strobe
C90A: 4C 21 FB                     jmp     $FB21

C90D: E0 01        <span id="Sympdon">pdon</span>            cpx     #1                ;C=1 if X=1
C90F: 6A                           ror     A                 ;A=80 or 0
C910: A8                           tay
C911: B9 7F 05                     lda     <a href="#Symmouxh">mouxh</a>,Y           ;Get high byte
C914: F0 02                        beq     <a href="#Sympdok">pdok</a>
C916: A9 FF                        lda     #$FF
C918: 19 7F 04     <span id="Sympdok">pdok</span>            ora     <a href="#Symmouxl">mouxl</a>,Y
C91B: A8                           tay
C91C: 60                           rts
                                   ADREND  ↑ ~$C900

                   ; 
                   ; Apple //c Mini Assembler
                   ; 
                   ; Got mnemonic, check address mode
                   ; 
C91D:              Mini_Assembler
                                   ORG     *+$0000
C91D: 20 3B CA     <span id="SymAMOD1">AMOD1</span>           jsr     <a href="#SymNNBL">NNBL</a>              ;get next non-blank
C920: 84 34                        sty     <a href="#SymYSAV">YSAV</a>              ;save Y
C922: DD BA F9                     cmp     <a href="#SymCHAR1">CHAR1</a>,X
C925: D0 13                        bne     <a href="#SymAMOD2">AMOD2</a>
C927: 20 3B CA                     jsr     <a href="#SymNNBL">NNBL</a>              ;get next non-blank
C92A: DD B4 F9                     cmp     <a href="#SymCHAR2">CHAR2</a>,X
C92D: F0 0D                        beq     <a href="#SymAMOD3">AMOD3</a>
C92F: BD B4 F9                     lda     <a href="#SymCHAR2">CHAR2</a>,X           ;done yet?
C932: F0 07                        beq     <a href="#SymAMOD4">AMOD4</a>
C934: C9 A4                        cmp     #$A4              ;if "$" then done
C936: F0 03                        beq     <a href="#SymAMOD4">AMOD4</a>
C938: A4 34                        ldy     <a href="#SymYSAV">YSAV</a>              ;restore Y
C93A: 18           <span id="SymAMOD2">AMOD2</span>           clc
C93B: 88           <span id="SymAMOD4">AMOD4</span>           dey
C93C: 26 44        <span id="SymAMOD3">AMOD3</span>           rol     <a href="#SymA5L">A5L</a>               ;shift bit into format
C93E: E0 03                        cpx     #$03
C940: D0 0D                        bne     <a href="#SymAMOD6">AMOD6</a>
C942: 20 A7 FF                     jsr     <a href="#SymGETNUM">GETNUM</a>
C945: A5 3F                        lda     <a href="#SymA2H">A2H</a>               ;get high byte of address
C947: F0 01                        beq     <a href="#SymAMOD5">AMOD5</a>             ;=&gt;
C949: E8                           inx
C94A: 86 35        <span id="SymAMOD5">AMOD5</span>           stx     <a href="#SymYSAV1">YSAV1</a>
C94C: A2 03                        ldx     #$03
C94E: 88                           dey
C94F: 86 3D        <span id="SymAMOD6">AMOD6</span>           stx     <a href="#SymA1H">A1H</a>
C951: CA                           dex
C952: 10 C9                        bpl     <a href="#SymAMOD1">AMOD1</a>
C954: 60                           rts

                   ; 
                   ; 
                   ; calculate offset byte for relative addresses
                   ; 
C955: E9 81        <span id="SymREL">REL</span>             sbc     #$81              ;calc relative address
C957: 4A                           lsr     A
C958: D0 14                        bne     <a href="#SymGOERR">GOERR</a>             ;bad branch
C95A: A4 3F                        ldy     <a href="#SymA2H">A2H</a>
C95C: A6 3E                        ldx     <a href="#SymA2L">A2L</a>
C95E: D0 01                        bne     <a href="#SymREL1">REL1</a>
C960: 88                           dey                       ;point to offset
C961: CA           <span id="SymREL1">REL1</span>            dex                       ;displacement -1
C962: 8A                           txa
C963: 18                           clc
C964: E5 3A                        sbc     <a href="#SymPCL">PCL</a>               ;subtract current PCL
C966: 85 3E                        sta     <a href="#SymA2L">A2L</a>               ;and save as displacement
C968: 10 01                        bpl     <a href="#SymREL2">REL2</a>              ;check page
C96A: C8                           iny
C96B: 98           <span id="SymREL2">REL2</span>            tya                       ;get page
C96C: E5 3B                        sbc     <a href="#SymPCH">PCH</a>               ;check page
C96E: D0 57        <span id="SymGOERR">GOERR</span>           bne     <a href="#SymMINIERR">MINIERR</a>           ;display error
                   ; 
                   ; Move instruction to memory
                   ; 
C970: A4 2F        <span id="SymMOVINST">MOVINST</span>         ldy     <a href="#SymLENGTH">LENGTH</a>            ;get instruction length
C972: B9 3D 00     <span id="SymMOV1">MOV1</span>            lda     <a href="#SymA1H">A1H</a>,Y             ;get a byte
C975: 91 3A                        sta     (<a href="#SymPCL">PCL</a>),Y
C977: 88                           dey
C978: 10 F8                        bpl     <a href="#SymMOV1">MOV1</a>
                   ; 
                   ; Display information
                   ; 
C97A: 20 48 F9                     jsr     <a href="#SymPRBLNK">PRBLNK</a>            ;print blanks to make ProDOS work
C97D: 20 1A FC                     jsr     <a href="#SymUP">UP</a>                ;move up 2 lines
C980: 20 1A FC                     jsr     <a href="#SymUP">UP</a>
C983: 20 C4 C5     <span id="SymDISLIN">DISLIN</span>          jsr     <a href="#Symshowinst">showinst</a>          ;Display line &amp; get next instruction
                   ; Get the next instruction
C986: A9 A1        <span id="SymGETINST1">GETINST1</span>        lda     #$A1              ;! for prompt
C988: 85 33                        sta     <a href="#SymPROMPT">PROMPT</a>
C98A: 20 67 FD                     jsr     <a href="#SymGETLNZ">GETLNZ</a>            ;Get a line
C98D: 80 49                        bra     <a href="#SymDOINST">DOINST</a>            ;Go do the instruction

                   ; 
                   ; Compare disassembly of all known opcodes
                   ; with the one types in until a match is found
                   ; 
C98F: A5 3D        <span id="SymGETOP">GETOP</span>           lda     <a href="#SymA1H">A1H</a>               ;get opcode
C991: 20 8E F8                     jsr     <a href="#SymINDS2">INDS2</a>             ;determine mnemonic index
C994: AA                           tax                       ;X = index
C995: BD 00 FA                     lda     <a href="#SymMNEMR">MNEMR</a>,X           ;get right half of index
C998: C5 42                        cmp     <a href="#SymA4L">A4L</a>               ;does it match entry?
C99A: D0 21                        bne     <a href="#SymNXTOP">NXTOP</a>             ;=&gt;try next opcode
C99C: BD C0 F9                     lda     <a href="#SymMNEML">MNEML</a>,X           ;get left half of index
C99F: 80 0C                        bra     <a href="#Symplskip">plskip</a>            ;Skip past pascal stuff

C9A1: 00 00 00 00+                 DS      9,$00             ;Hello I'm the pascal 1.0 entry point

C9AA: 4C B4 C1                     jmp     <a href="#Symplwrite">plwrite</a>           ;Just getting in the way

C9AD: C5 43        <span id="Symplskip">plskip</span>          cmp     <a href="#SymA4H">A4H</a>               ;does it match entry?
C9AF: D0 0C                        bne     <a href="#SymNXTOP">NXTOP</a>             ;=&gt;no, try next opcode
C9B1: A5 44                        lda     <a href="#SymA5L">A5L</a>               ;found opcode, check address mode
C9B3: A4 2E                        ldy     <a href="#SymFORMAT">FORMAT</a>            ;get addr. mode format for that opcode
C9B5: C0 9D                        cpy     #$9D              ;is it relative?
C9B7: F0 9C                        beq     <a href="#SymREL">REL</a>               ;=&gt;yes, calc relative address
C9B9: C5 2E                        cmp     <a href="#SymFORMAT">FORMAT</a>            ;does mode match?
C9BB: F0 B3                        beq     <a href="#SymMOVINST">MOVINST</a>           ;=&gt;yes, move instruction to memory
C9BD: C6 3D        <span id="SymNXTOP">NXTOP</span>           dec     <a href="#SymA1H">A1H</a>               ;else try next opcode
C9BF: D0 CE                        bne     <a href="#SymGETOP">GETOP</a>             ;=&gt;go try it
C9C1: E6 44                        inc     <a href="#SymA5L">A5L</a>               ;else try next format
C9C3: C6 35                        dec     <a href="#SymYSAV1">YSAV1</a>
C9C5: F0 C8                        beq     <a href="#SymGETOP">GETOP</a>             ;=&gt;go try next foramt
                   ; 
                   ; Point to the error with a caret, beep, and fall
                   ; into the mini-assembler.
                   ; 
C9C7: A4 34        <span id="SymMINIERR">MINIERR</span>         ldy     <a href="#SymYSAV">YSAV</a>              ;get position
C9C9: 98           <span id="SymERR2">ERR2</span>            tya
C9CA: AA                           tax
C9CB: 20 4A F9     <span id="SymERR3">ERR3</span>            jsr     <a href="#SymPRBL2">PRBL2</a>
C9CE: A9 DE                        lda     #$DE              ;^ to point to error
C9D0: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
C9D3: 20 3A FF                     jsr     <a href="#SymBELL">BELL</a>              ;Beep cause we're mad
C9D6: 80 AE                        bra     <a href="#SymGETINST1">GETINST1</a>          ;try again

                   ; 
                   ; Read a line of input.  If prefaced with " ", decode
                   ; mnemonic. If "$" do monitor command.  Otherwise parse
                   ; hex address before decoding mnemonic.
                   ; 
C9D8: 20 C7 FF     <span id="SymDOINST">DOINST</span>          jsr     <a href="#SymZMODE">ZMODE</a>             ;clear mode
C9DB: AD 00 02                     lda     $0200             ;get first char in line
C9DE: C9 A0                        cmp     #$A0              ;if blank,
C9E0: F0 12                        beq     <a href="#SymDOLIN">DOLIN</a>             ;=&gt;go attempt disassembly
C9E2: C9 8D                        cmp     #$8D              ;is it return?
C9E4: D0 01                        bne     <a href="#SymGETI1">GETI1</a>             ;=&gt;no, continue
C9E6: 60                           rts                       ;else return to Monitor

C9E7: 20 A7 FF     <span id="SymGETI1">GETI1</span>           jsr     <a href="#SymGETNUM">GETNUM</a>            ;prase hexadecimal input
C9EA: C9 93                        cmp     #$93              ;look for "ADDR:"
C9EC: D0 DB        <span id="SymGOERR2">GOERR2</span>          bne     <a href="#SymERR2">ERR2</a>              ;no ":", display error
C9EE: 8A                           txa                       ;X non zero if address entered
C9EF: F0 D8                        beq     <a href="#SymERR2">ERR2</a>              ;no "ADDR", display error
                   ; 
C9F1: 20 78 FE                     jsr     <a href="#SymA1PCLP">A1PCLP</a>            ;move address to PC
C9F4: A9 03        <span id="SymDOLIN">DOLIN</span>           lda     #$03              ;get starting opcode
C9F6: 85 3D                        sta     <a href="#SymA1H">A1H</a>               ;and save
C9F8: 20 3B CA     <span id="SymNXTCH">NXTCH</span>           jsr     <a href="#SymNNBL">NNBL</a>              ;get next non-blank
C9FB: 0A                           asl     A
C9FC: E9 BE                        sbc     #$BE
C9FE: C9 C2                        cmp     #$C2
CA00: 90 C7                        bcc     <a href="#SymERR2">ERR2</a>              ;=&gt;flag bad mnemonic
                   ; 
                   ; Form mnemonic for later comparison
                   ; 
CA02: 0A                           asl     A
CA03: 0A                           asl     A
CA04: A2 04                        ldx     #$04
CA06: 0A           <span id="SymNXTMN">NXTMN</span>           asl     A
CA07: 26 42                        rol     <a href="#SymA4L">A4L</a>
CA09: 26 43                        rol     <a href="#SymA4H">A4H</a>
CA0B: CA                           dex
CA0C: 10 F8                        bpl     <a href="#SymNXTMN">NXTMN</a>
CA0E: C6 3D                        dec     <a href="#SymA1H">A1H</a>               ;decrement mnemonic count
CA10: F0 F4                        beq     <a href="#SymNXTMN">NXTMN</a>
CA12: 10 E4                        bpl     <a href="#SymNXTCH">NXTCH</a>
CA14: A2 05                        ldx     #5                ;index into address mode tables
CA16: 20 1D C9                     jsr     <a href="#SymAMOD1">AMOD1</a>             ;do this elsewhere
CA19: A5 44                        lda     <a href="#SymA5L">A5L</a>               ;get format
CA1B: 0A                           asl     A
CA1C: 0A                           asl     A
CA1D: 05 35                        ora     <a href="#SymYSAV1">YSAV1</a>
CA1F: C9 20                        cmp     #$20
CA21: B0 06                        bcs     <a href="#SymAMOD7">AMOD7</a>
CA23: A6 35                        ldx     <a href="#SymYSAV1">YSAV1</a>             ;get our format
CA25: F0 02                        beq     <a href="#SymAMOD7">AMOD7</a>
CA27: 09 80                        ora     #$80
CA29: 85 44        <span id="SymAMOD7">AMOD7</span>           sta     <a href="#SymA5L">A5L</a>               ;update format
CA2B: 84 34                        sty     <a href="#SymYSAV">YSAV</a>              ;update position
CA2D: B9 00 02                     lda     $0200,Y           ;get next character
CA30: C9 BB                        cmp     #$BB              ;is it a ";"?
CA32: F0 04                        beq     <a href="#SymAMOD8">AMOD8</a>             ;=&gt;yes, skip comment
CA34: C9 8D                        cmp     #$8D              ;is it a carriage return
CA36: D0 B4                        bne     <a href="#SymGOERR2">GOERR2</a>
CA38: 4C 8F C9     <span id="SymAMOD8">AMOD8</span>           jmp     <a href="#SymGETOP">GETOP</a>             ;get next opcode

                   ********************************************************************************
                   *                                                                              *
                   * NNBL - Gets a non blank character for the mini assembler                     *
                   *                                                                              *
                   ********************************************************************************
CA3B: 20 B4 C5     <span id="SymNNBL">NNBL</span>            jsr     <a href="#SymGETUP">GETUP</a>             ;Get next upshifted character
CA3E: C9 A0                        cmp     #$A0              ;Blank?
CA40: F0 F9                        beq     <a href="#SymNNBL">NNBL</a>
CA42: 60                           rts

                   ; 
                   ; Step and trace routines
                   ; 
CA43: 2C 61 C0     <span id="Symstep">step</span>            bit     <a href="#SymBUTN0">BUTN0</a>             ;Open apple = slow step
CA46: 10 08                        bpl     <a href="#Symxqnobt0">xqnobt0</a>
CA48: A2 07                        ldx     #7                ;wait about a second
CA4A: 20 A8 FC     <span id="Symxqwait">xqwait</span>          jsr     <a href="#SymWAIT">WAIT</a>
CA4D: CA                           dex
CA4E: D0 FA                        bne     <a href="#Symxqwait">xqwait</a>
CA50: 2C 62 C0     <span id="Symxqnobt0">xqnobt0</span>         bit     <a href="#SymBUTN1">BUTN1</a>
CA53: 30 51                        bmi     <a href="#Symxbrk">xbrk</a>              ;Closed apple = break
CA55: 20 75 FE                     jsr     <a href="#Syma1pc">a1pc</a>              ;If user specified an address, move it
CA58: 18                           clc
CA59: 20 0D CB                     jsr     <a href="#Symgodsp">godsp</a>             ;Disassemble one instruction
CA5C: 68                           pla                       ;At (PCL,H)
CA5D: 85 2C                        sta     <a href="#SymRTNL">RTNL</a>              ;Adjust to user stack
CA5F: 68                           pla
CA60: 85 2D                        sta     <a href="#Symrtnh">rtnh</a>              ;Save return address
CA62: A2 08                        ldx     #$08
CA64: BD 04 CB     <span id="Symxqinit">xqinit</span>          lda     <a href="#Syminitbl">initbl</a>-1,X
CA67: 95 3C                        sta     <a href="#Symxqt">xqt</a>,X
CA69: CA                           dex
CA6A: D0 F8                        bne     <a href="#Symxqinit">xqinit</a>
CA6C: A1 3A                        lda     (<a href="#SymPCL">PCL</a>,X)
CA6E: F0 36                        beq     <a href="#Symxbrk">xbrk</a>              ;Special if break
CA70: A4 2F                        ldy     <a href="#SymLENGTH">LENGTH</a>
CA72: C9 20                        cmp     #$20
CA74: F0 4A                        beq     <a href="#Symxjsr">xjsr</a>              ;Do JSR, RTS, JMP, JMP (), JMP (,X), RTI
CA76: C9 60                        cmp     #$60
CA78: F0 36                        beq     <a href="#Symxtrs">xtrs</a>
CA7A: C9 4C                        cmp     #$4C
CA7C: F0 4A                        beq     <a href="#Symxjmp">xjmp</a>
CA7E: C9 6C                        cmp     #$6C
CA80: F0 47                        beq     <a href="#Symxjmpat">xjmpat</a>
CA82: C9 7C                        cmp     #$7C
CA84: F0 5D                        beq     <a href="#Symxjmpatx">xjmpatx</a>
CA86: C9 40                        cmp     #$40
CA88: F0 22                        beq     <a href="#Symxrti">xrti</a>
CA8A: C9 80                        cmp     #$80              ;Make bra turn into blp
CA8C: D0 02                        bne     <a href="#Symxqntbra">xqntbra</a>
CA8E: A9 10                        lda     #$10
CA90: 29 1F        <span id="Symxqntbra">xqntbra</span>         and     #$1F
CA92: 49 14                        eor     #$14
CA94: C9 04                        cmp     #$04
CA96: F0 02                        beq     <a href="#Symxq2">xq2</a>               ;Copy user inst to xeq area
CA98: B1 3A        <span id="Symxq1">xq1</span>             lda     (<a href="#SymPCL">PCL</a>),Y           ;Change rel branch
CA9A: 99 3C 00     <span id="Symxq2">xq2</span>             sta     <a href="#Symxqt">xqt</a>,Y             ;displacement to 4 for jmp to branch
CA9D: 88                           dey                       ;or jump to nbranch
CA9E: 10 F8                        bpl     <a href="#Symxq1">xq1</a>
CAA0: 20 3F FF                     jsr     <a href="#SymRESTORE">RESTORE</a>           ;Restore user reg contents
CAA3: 4C 3C 00                     jmp     <a href="#Symxqt">xqt</a>               ;Xeq user op from ram

CAA6: A9 64        <span id="Symxbrk">xbrk</span>            lda     #&lt;<a href="#SymMON">MON</a>-1           ;Print registers and go to monitor
CAA8: A2 FF                        ldx     #&gt;<a href="#SymMON">MON</a>
CAAA: 80 2D                        bra     <a href="#Symrtnjmp2">rtnjmp2</a>           ;Display regs &amp; go to monitor

CAAC: 18           <span id="Symxrti">xrti</span>            clc
CAAD: 68                           pla                       ;Simulate rti by getting status
CAAE: 85 48                        sta     <a href="#SymSTATUS">STATUS</a>            ;from stack then doing rts
CAB0: 68           <span id="Symxtrs">xtrs</span>            pla                       ;Pop PC (not pc-1)!
CAB1: 85 3A                        sta     <a href="#SymPCL">PCL</a>
CAB3: 68                           pla
CAB4: 85 3B        <span id="Sympcinc2">pcinc2</span>          sta     <a href="#SymPCH">PCH</a>               ;Update Pc by 1 (Len = 0)
CAB6: A5 2F        <span id="Sympcinc3">pcinc3</span>          lda     <a href="#SymLENGTH">LENGTH</a>            ;Update pc by length
CAB8: 20 56 F9                     jsr     <a href="#Sympcadj3">pcadj3</a>
CABB: 84 3B                        sty     <a href="#SymPCH">PCH</a>
CABD: 18                           clc
CABE: 90 11                        bcc     <a href="#SymNEWPCL">NEWPCL</a>

CAC0: 18           <span id="Symxjsr">xjsr</span>            clc
CAC1: 20 54 F9                     jsr     <a href="#Sympcadj2">pcadj2</a>
CAC4: 5A                           phy                       ;Push pc onto stack for jsr
CAC5: 48                           pha
CAC6: A0 02                        ldy     #$02
CAC8: 18           <span id="Symxjmp">xjmp</span>            clc
CAC9: B1 3A        <span id="Symxjmpat">xjmpat</span>          lda     (<a href="#SymPCL">PCL</a>),Y
CACB: AA                           tax                       ;Load pc for jmp, (jmp) simulate
CACC: 88                           dey
CACD: B1 3A                        lda     (<a href="#SymPCL">PCL</a>),Y
CACF: 86 3B                        stx     <a href="#SymPCH">PCH</a>
CAD1: 85 3A        <span id="SymNEWPCL">NEWPCL</span>          sta     <a href="#SymPCL">PCL</a>
CAD3: B0 F3                        bcs     <a href="#Symxjmp">xjmp</a>
CAD5: A6 2D        <span id="Symrtnjmp">rtnjmp</span>          ldx     <a href="#Symrtnh">rtnh</a>
CAD7: A5 2C                        lda     <a href="#SymRTNL">RTNL</a>
CAD9: DA           <span id="Symrtnjmp2">rtnjmp2</span>         phx
CADA: 48                           pha
CADB: A9 27                        lda     #39               ;Move over
CADD: 85 24                        sta     <a href="#SymCH">CH</a>
CADF: 38                           sec
CAE0: 4C 0D CB                     jmp     <a href="#Symgodsp">godsp</a>

CAE3: 18           <span id="Symxjmpatx">xjmpatx</span>         clc                       ;JMP (,X)
CAE4: A5 3A                        lda     <a href="#SymPCL">PCL</a>               ;Add x to address
CAE6: 65 46                        adc     <a href="#SymXREG">XREG</a>
CAE8: 85 3A                        sta     <a href="#SymPCL">PCL</a>
CAEA: 90 02                        bcc     <a href="#Symxjxnoc">xjxnoc</a>
CAEC: E6 3B                        inc     <a href="#SymPCH">PCH</a>
CAEE: 38           <span id="Symxjxnoc">xjxnoc</span>          sec                       ;C = 1 for indirect jump
CAEF: 80 D8                        bra     <a href="#Symxjmpat">xjmpat</a>

CAF1: 18           <span id="Symbranch">branch</span>          clc                       ;Branch taken
CAF2: A0 01                        ldy     #$01              ;Add len+2 to PC
CAF4: B1 3A                        lda     (<a href="#SymPCL">PCL</a>),Y
CAF6: 20 56 F9                     jsr     <a href="#Sympcadj3">pcadj3</a>
CAF9: 85 3A                        sta     <a href="#SymPCL">PCL</a>
CAFB: 98                           tya
CAFC: 38                           sec
CAFD: B0 B5                        bcs     <a href="#Sympcinc2">pcinc2</a>

CAFF: 20 4A FF     <span id="Symnbrnch">nbrnch</span>          jsr     <a href="#SymSAVE">SAVE</a>              ;Normal return for xeq
CB02: 38                           sec
CB03: B0 B1                        bcs     <a href="#Sympcinc3">pcinc3</a>            ;Go update PC

                   ********************************************************************************
                   *                                                                              *
                   * This is the table that is moved into zero page                               *
                   * when stepping and tracing                                                    *
                   *                                                                              *
                   ********************************************************************************
CB05: EA           <span id="Syminitbl">initbl</span>          nop
CB06: EA                           nop
CB07: 4C FF CA                     jmp     <a href="#Symnbrnch">nbrnch</a>

CB0A: 4C F1 CA                     jmp     <a href="#Symbranch">branch</a>

                   ; 
                   ; GODSP - Saves hooks, calls display routine and fixes hooks
                   ; C = 0 instruction display
                   ; C = 1 register display
                   ; ysed by step and trace
                   ; 
CB0D: A5 36        <span id="Symgodsp">godsp</span>           lda     <a href="#SymCSWL">CSWL</a>
CB0F: 48                           pha
CB10: A5 37                        lda     <a href="#SymCSWH">CSWH</a>              ;Save output hook
CB12: 48                           pha
CB13: A9 F0                        lda     #&lt;<a href="#Symcout1">cout1</a>
CB15: 85 36                        sta     <a href="#SymCSWL">CSWL</a>
CB17: A9 FD                        lda     #&lt;<a href="#Symcout1">cout1</a>+13
CB19: 85 37                        sta     <a href="#SymCSWH">CSWH</a>
CB1B: B0 05                        bcs     <a href="#Symgodreg">godreg</a>            ;Which display?
CB1D: 20 D0 F8                     jsr     <a href="#Syminstdsp">instdsp</a>
CB20: 80 03                        bra     <a href="#Symgoddone">goddone</a>

CB22: 20 DA FA     <span id="Symgodreg">godreg</span>          jsr     <a href="#Symrgdsp1">rgdsp1</a>
CB25: 68           <span id="Symgoddone">goddone</span>         pla
CB26: 85 37                        sta     <a href="#SymCSWH">CSWH</a>
CB28: 68                           pla
CB29: 85 36                        sta     <a href="#SymCSWL">CSWL</a>
CB2B: 60                           rts

                   ; More Video Stuff (Scrolling)
CB2C: 00 00 00 00                  HEX     $00,$00,$00,$00   ;align this for fools with illegal entry points

                   ; 
                   ; SCROLLIT scrolls the screen either up or down, depending
                   ; on the value of X.  It scrolls within windows with even
                   ; or odd edges for both 40 and 80 columns.  It can scroll
                   ; windows down to 1 characters wide.
                   ; 
CB30: DA           <span id="SymSCROLLDN">SCROLLDN</span>        phx                       ;save X
CB31: A2 00                        ldx     #0                ;direction = down
CB33: 80 03                        bra     <a href="#SymSCROLLIT">SCROLLIT</a>          ;do scroll

CB35: DA           <span id="SymSCROLLUP">SCROLLUP</span>        phx                       ;save X
CB36: A2 01                        ldx     #1                ;direction = up
CB38: A4 21        <span id="SymSCROLLIT">SCROLLIT</span>        ldy     <a href="#SymWNDWDTH">WNDWDTH</a>           ;get width of screen window
CB3A: 2C 1F C0                     bit     <a href="#SymRD80VID">RD80VID</a>           ;in 40 or 80 columns?
CB3D: 10 18                        bpl     <a href="#SymGETST">GETST</a>             ;=&gt;40, determine starting line
CB3F: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>          ;make sure this is enabled
CB42: 98                           tya                       ;get WNDWDTH for test
CB43: 4A                           lsr     A                 ;divide by 2 for 80 column index
CB44: A8                           tay                       ;and save
CB45: A5 20                        lda     <a href="#SymWNDLFT">WNDLFT</a>            ;test oddity of right edge
CB47: 4A                           lsr     A                 ;by rotating low bit into carry
CB48: B8                           clv                       ;V=0 if left edge even
CB49: 90 03                        bcc     <a href="#SymCHKRT">CHKRT</a>             ;=&gt;check right edge
CB4B: 2C C1 CB                     bit     <a href="#SymSEV1">SEV1</a>              ;V=1 if left edge odd
CB4E: 2A           <span id="SymCHKRT">CHKRT</span>           rol     A                 ;restore WNDLFT
CB4F: 45 21                        eor     <a href="#SymWNDWDTH">WNDWDTH</a>           ;get oddity of right edge
CB51: 4A                           lsr     A                 ;C=1 if right edge even
CB52: 70 03                        bvs     <a href="#SymGETST">GETST</a>             ;if odd left, don't DEY
CB54: B0 01                        bcs     <a href="#SymGETST">GETST</a>             ;if even right, don't DEY
CB56: 88                           dey                       ;if right edge odd, need one less
CB57: 8C F8 05     <span id="SymGETST">GETST</span>           sty     <a href="#SymTEMPY">TEMPY</a>             ;save window width
CB5A: AD 1F C0                     lda     <a href="#SymRD80VID">RD80VID</a>           ;N=1 if 80 columns
CB5D: 08                           php                       ;save N,Z,V
CB5E: A5 22                        lda     <a href="#SymWNDTOP">WNDTOP</a>            ;assume scroll from top
CB60: E0 00                        cpx     #0                ;up or down?
CB62: D0 03                        bne     <a href="#SymSETDBAS">SETDBAS</a>           ;=&gt;up
CB64: A5 23                        lda     <a href="#SymWNDBTM">WNDBTM</a>            ;down, start scrolling at bottom
CB66: 3A                           dec     A                 ;really need one less
                   ; 
CB67: 8D 78 05     <span id="SymSETDBAS">SETDBAS</span>         sta     <a href="#SymTEMPA">TEMPA</a>             ;save current line
CB6A: 20 24 FC                     jsr     <a href="#SymVTABZ">VTABZ</a>             ;calcualte base with window width
                   ; 
CB6D: A5 28        <span id="SymSCRLIN">SCRLIN</span>          lda     <a href="#SymBASL">BASL</a>              ;current line is destination
CB6F: 85 2A                        sta     <a href="#SymBAS2L">BAS2L</a>
CB71: A5 29                        lda     <a href="#SymBASH">BASH</a>
CB73: 85 2B                        sta     <a href="#SymSLOTZ">SLOTZ</a>
                   ; 
CB75: AD 78 05                     lda     <a href="#SymTEMPA">TEMPA</a>             ;get current line
CB78: E0 00                        cpx     #0                ;going up?
CB7A: D0 07                        bne     <a href="#SymSETUP2">SETUP2</a>            ;=&gt;up, inc current line
CB7C: C5 22                        cmp     <a href="#SymWNDTOP">WNDTOP</a>            ;down. Reached top yet?
CB7E: F0 39                        beq     <a href="#SymSCRL3">SCRL3</a>             ;yes! clear top line, exit
CB80: 3A                           dec     A                 ;no, go up a line
CB81: 80 05                        bra     <a href="#SymSETSRC">SETSRC</a>            ;set source for scroll

CB83: 1A           <span id="SymSETUP2">SETUP2</span>          inc     A                 ;up, inc current line
CB84: C5 23                        cmp     <a href="#SymWNDBTM">WNDBTM</a>            ;at bottom yet?
CB86: B0 31                        bcs     <a href="#SymSCRL3">SCRL3</a>             ;yes! clear bottom line, exit
                   ; 
CB88: 8D 78 05     <span id="SymSETSRC">SETSRC</span>          sta     <a href="#SymTEMPA">TEMPA</a>             ;save new current line
CB8B: 20 24 FC                     jsr     <a href="#SymVTABZ">VTABZ</a>             ;get base for new current line
CB8E: AC F8 05                     ldy     <a href="#SymTEMPY">TEMPY</a>             ;get width for scroll
CB91: 28                           plp                       ;get status for scroll
CB92: 08                           php                       ;N=1 if 80 columns
CB93: 10 1F                        bpl     <a href="#SymSKPRT">SKPRT</a>             ;=&gt;only do 40 columns
CB95: AD 55 C0                     lda     <a href="#SymTXTPAGE2">TXTPAGE2</a>          ;scroll aux page first (even bytes)
CB98: 98                           tya                       ;test Y
CB99: F0 07                        beq     <a href="#SymSCRLFT">SCRLFT</a>            ;if Y=0, only scroll one byte
CB9B: B1 28        <span id="SymSCRLEVEN">SCRLEVEN</span>        lda     (<a href="#SymBASL">BASL</a>),Y
CB9D: 91 2A                        sta     (<a href="#SymBAS2L">BAS2L</a>),Y
CB9F: 88                           dey
CBA0: D0 F9                        bne     <a href="#SymSCRLEVEN">SCRLEVEN</a>          ;do all but last even byte
CBA2: 70 04        <span id="SymSCRLFT">SCRLFT</span>          bvs     <a href="#SymSKPLFT">SKPLFT</a>            ;odd left edge, skip this byte
CBA4: B1 28                        lda     (<a href="#SymBASL">BASL</a>),Y
CBA6: 91 2A                        sta     (<a href="#SymBAS2L">BAS2L</a>),Y
CBA8: AD 54 C0     <span id="SymSKPLFT">SKPLFT</span>          lda     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;now do main page (odd bytes)
CBAB: AC F8 05                     ldy     <a href="#SymTEMPY">TEMPY</a>             ;restore width
CBAE: B0 04                        bcs     <a href="#SymSKPRT">SKPRT</a>             ;even right edge, skip this byte
CBB0: B1 28        <span id="SymSCRLODD">SCRLODD</span>         lda     (<a href="#SymBASL">BASL</a>),Y
CBB2: 91 2A                        sta     (<a href="#SymBAS2L">BAS2L</a>),Y
CBB4: 88           <span id="SymSKPRT">SKPRT</span>           dey
CBB5: 10 F9                        bpl     <a href="#SymSCRLODD">SCRLODD</a>
CBB7: 80 B4                        bra     <a href="#SymSCRLIN">SCRLIN</a>            ;scroll next line

                   ; 
CBB9: 20 A0 FC     <span id="SymSCRL3">SCRL3</span>           jsr     <a href="#SymCLRLIN">CLRLIN</a>            ;clear current line
CBBC: 20 22 FC                     jsr     <a href="#SymVTAB">VTAB</a>              ;restore original cursor line
CBBF: 28                           plp                       ;pull status off stack
CBC0: FA                           plx                       ;restore X
CBC1: 60           <span id="SymSEV1">SEV1</span>            rts                       ;done!!!

                   ; 
                   ; DOCLR is called by CLREOL.  It decides whether
                   ; to do a (quick) 40 or 80 column clear to end of line.
                   ; 
CBC2: 2C 1F C0     <span id="SymDOCLR">DOCLR</span>           bit     <a href="#SymRD80VID">RD80VID</a>           ;40 or 80 column clear?
CBC5: 30 13                        bmi     <a href="#SymCLR80">CLR80</a>             ;=&gt;clear 80 columns
CBC7: 91 28        <span id="SymCLR40">CLR40</span>           sta     (<a href="#SymBASL">BASL</a>),Y
CBC9: C8                           iny
CBCA: C4 21                        cpy     <a href="#SymWNDWDTH">WNDWDTH</a>
CBCC: 90 F9                        bcc     <a href="#SymCLR40">CLR40</a>
CBCE: 60                           rts

                   ; 
CBCF: DA           <span id="SymCLRHALF">CLRHALF</span>         phx                       ;clear right half of screen
CBD0: A2 D8                        ldx     #$D8              ;for SCRN48
CBD2: A0 14                        ldy     #20
CBD4: A5 32                        lda     <a href="#SymINVFLG">INVFLG</a>
CBD6: 29 A0                        and     #$A0
CBD8: 80 17                        bra     <a href="#SymCLR2">CLR2</a>              ;=&gt;jump into middle

CBDA: DA           <span id="SymCLR80">CLR80</span>           phx                       ;preserve X
CBDB: 48                           pha                       ;and blank
CBDC: 98                           tya                       ;get count for CH
CBDD: 48                           pha                       ;save for left edge check
CBDE: 38                           sec                       ;count=WNDWDTH-Y-1
CBDF: E5 21                        sbc     <a href="#SymWNDWDTH">WNDWDTH</a>
CBE1: AA                           tax                       ;save CH counter
CBE2: 98                           tya                       ;div CH by 2 for half pages
CBE3: 4A                           lsr     A
CBE4: A8                           tay
CBE5: 68                           pla                       ;restore original CH
CBE6: 45 20                        eor     <a href="#SymWNDLFT">WNDLFT</a>            ;get starting page
CBE8: 6A                           ror     A
CBE9: B0 03                        bcs     <a href="#SymCLR0">CLR0</a>
CBEB: 10 01                        bpl     <a href="#SymCLR0">CLR0</a>
CBED: C8                           iny                       ;iff WNDLFT odd, starting byte odd
CBEE: 68           <span id="SymCLR0">CLR0</span>            pla                       ;get blankity blank
CBEF: B0 0B                        bcs     <a href="#SymCLR1">CLR1</a>              ;starting page 1 (default)
CBF1: 2C 55 C0     <span id="SymCLR2">CLR2</span>            bit     <a href="#SymTXTPAGE2">TXTPAGE2</a>          ;else do page 2
CBF4: 91 28                        sta     (<a href="#SymBASL">BASL</a>),Y
CBF6: 2C 54 C0                     bit     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;now do page 1
CBF9: E8                           inx
CBFA: F0 06                        beq     <a href="#SymCLR3">CLR3</a>              ;all done
CBFC: 91 28        <span id="SymCLR1">CLR1</span>            sta     (<a href="#SymBASL">BASL</a>),Y
CBFE: C8                           iny                       ;forward 2 columns
CBFF: E8                           inx                       ;next CH
CC00: D0 EF                        bne     <a href="#SymCLR2">CLR2</a>              ;not done yet
CC02: FA           <span id="SymCLR3">CLR3</span>            plx                       ;restore X
CC03: 60                           rts                       ;and exit

                   ; 
CC04: 9C FA 05     <span id="SymCLRPORT">CLRPORT</span>         stz     <a href="#Symtyphed">typhed</a>            ;disable typeahead
CC07: 9C F9 05                     stz     <a href="#Symextint2">extint2</a>           ;and external interrupts
CC0A: 60                           rts

                   ; 
                   ; PASINVERT is used by Pascal to display the cursor. Pascal
                   ; normally leaves the cursor on the screen at all times. It
                   ; is fleetingly removed while a character is displayed, then
                   ; promptly redisplayed.  CTL-F and CTL-E, respectively,
                   ; disable and enable display of the cursor when printed using
                   ; the Pascal 1.1 entry point (PWRITE).  Screen I/O is
                   ; significantly fasster when the cursor is disabled.  This
                   ; feature is supported by Pascal 1.2 and later.
                   ; 
CC0B: AD FB 04     <span id="SymPASINVERT">PASINVERT</span>       lda     <a href="#SymVMODE">VMODE</a>             ;Called by pascal to
CC0E: 29 10                        and     #<a href="#SymM_CURSOR">M_CURSOR</a>         ;display cursor
CC10: D0 0A                        bne     <a href="#SymINVX">INVX</a>              ;=&gt;cursor off, don't invert
CC12: 20 1D CC     <span id="SymINVERT">INVERT</span>          jsr     <a href="#SymPICKY">PICKY</a>             ;load y and get char
CC15: 48                           pha
CC16: 49 80                        eor     #$80              ;FLIP INVERSE/NORMAL
CC18: 20 B3 C3                     jsr     <a href="#SymSTORY">STORY</a>             ;stuff onto screen
CC1B: 68                           pla                       ;for RDCHAR
CC1C: 60           <span id="SymINVX">INVX</span>            rts

                   ; 
                   ; PICK lifts a character from the screen in either
                   ; 40 or 80 columns from the current cursor position.
                   ; If the laternate character set is switched in,
                   ; character codes $0-$1F are returned as $40-$5F (which
                   ; is what must have been originally printed to the location).
                   ; 
CC1D: 5A           <span id="SymPICKY">PICKY</span>           phy                       ;save Y
CC1E: 20 9D CC                     jsr     <a href="#SymGETCUR">GETCUR</a>            ;get newest cursor into Y
CC21: AD 1F C0                     lda     <a href="#SymRD80VID">RD80VID</a>           ;80 columns?
CC24: 10 17                        bpl     <a href="#SymPICK1">PICK1</a>             ;=&gt;no
CC26: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>          ;force 80STORE if 80 columns
CC29: 98                           tya
CC2A: 45 20                        eor     <a href="#SymWNDLFT">WNDLFT</a>            ;C=1 if char in main RAM
CC2C: 6A                           ror     A                 ;get low bit into carry
CC2D: B0 04                        bcs     <a href="#SymPICK2">PICK2</a>             ;=&gt;store in main memory
CC2F: AD 55 C0                     lda     <a href="#SymTXTPAGE2">TXTPAGE2</a>          ;else switch in page 2
CC32: C8                           iny                       ;for odd left, aux bytes
CC33: 98           <span id="SymPICK2">PICK2</span>           tya                       ;divide pos'n by 2
CC34: 4A                           lsr     A
CC35: A8                           tay                       ;and use as offset into line
CC36: B1 28                        lda     (<a href="#SymBASL">BASL</a>),Y          ;pick character
CC38: 8D 54 C0                     sta     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;80 columns, switch in
CC3B: 80 02                        bra     <a href="#SymPICK3">PICK3</a>             ;skip 40 column pick

CC3D: B1 28        <span id="SymPICK1">PICK1</span>           lda     (<a href="#SymBASL">BASL</a>),Y          ;pick 40 column char
CC3F: 2C 1E C0     <span id="SymPICK3">PICK3</span>           bit     <a href="#SymALTCHARSET">ALTCHARSET</a>        ;only allow if alt set
CC42: 10 06                        bpl     <a href="#SymPICK4">PICK4</a>
CC44: C9 20                        cmp     #$20
CC46: B0 02                        bcs     <a href="#SymPICK4">PICK4</a>
CC48: 09 40                        ora     #$40
CC4A: 7A           <span id="SymPICK4">PICK4</span>           ply                       ;restore real Y
CC4B: 60                           rts

                   ; 
                   ; SHOWCUR displays either a checkerboard cursor, a solid
                   ; rectange, or the current cursor character, depending
                   ; on the value of the CURSOR location.  0=inverse cursor,
                   ; $FF=checkboard cursor, anything else is displayed
                   ; after being anded with inverse mask.
                   ; 
CC4C: AC FB 07     <span id="Symshowcur">showcur</span>         ldy     <a href="#SymCURSOR">CURSOR</a>            ;get char on screen
CC4F: D0 02                        bne     <a href="#SymNOTINV">NOTINV</a>            ;preserve it
CC51: 80 BF                        bra     <a href="#SymINVERT">INVERT</a>            ;save for update

                   ; 
                   ; Exit with char in accumulator
                   ; 
CC53: 20 1D CC     <span id="SymNOTINV">NOTINV</span>          jsr     <a href="#SymPICKY">PICKY</a>             ;get char on screen
CC56: 48                           pha                       ;preserve it
CC57: 8D 7B 07                     sta     <a href="#SymNXTCUR">NXTCUR</a>            ;save for update
CC5A: 98                           tya                       ;test for checkerboard
CC5B: C8                           iny
CC5C: F0 0D                        beq     <a href="#SymNOTINV2">NOTINV2</a>           ;=&gt;checkerboard, display it
CC5E: 7A                           ply                       ;test char
CC5F: 5A                           phy
CC60: 30 09                        bmi     <a href="#SymNOTINV2">NOTINV2</a>           ;don't need inverse
CC62: AD 1E C0                     lda     <a href="#SymALTCHARSET">ALTCHARSET</a>        ;mask = $7F if alternate
CC65: 09 7F                        ora     #$7F              ; character set,
CC67: 4A                           lsr     A                 ;$3F if normal char set
CC68: 2D FB 07     <span id="SymNOTINV1">NOTINV1</span>         and     <a href="#SymCURSOR">CURSOR</a>            ;form char to display
CC6B: 20 B3 C3     <span id="SymNOTINV2">NOTINV2</span>         jsr     <a href="#SymSTORY">STORY</a>             ;and display it
CC6E: 68                           pla                       ;restore real char
CC6F: 60                           rts

                   ; 
                   ; The UPDATE routine increments the random seed.
                   ; If a certain value is reached and we are in Apple II
                   ; mode, the blinking check cursor is updated.  If a 
                   ; key has been pressed, the old char is replaced on the
                   ; screen, and we returned with BMI.
                   ; 
                   ; NOTE: this routine used by COMM firmware!!
                   ; 
CC70: 48           <span id="Symupdate">update</span>          pha                       ;save char
CC71: E6 4E                        inc     <a href="#SymRNDL">RNDL</a>              ;update seed
CC73: D0 1E                        bne     <a href="#SymUD2">UD2</a>               ;check for key
CC75: A5 4F                        lda     <a href="#SymRNDH">RNDH</a>
CC77: E6 4F                        inc     <a href="#SymRNDH">RNDH</a>
CC79: 45 4F                        eor     <a href="#SymRNDH">RNDH</a>
CC7B: 29 10                        and     #$10              ;need to update cursor?
CC7D: F0 14                        beq     <a href="#SymUD2">UD2</a>               ;=&gt;no, check for key
CC7F: AD FB 07                     lda     <a href="#SymCURSOR">CURSOR</a>            ;what cursor are we using?
CC82: F0 0F                        beq     <a href="#SymUD2">UD2</a>               ;=&gt;//e cursor, leave alone
CC84: 5A                           phy                       ;+ Save Y
CC85: 20 1D CC                     jsr     <a href="#SymPICKY">PICKY</a>             ;get the character into A
CC88: AC 7B 07                     ldy     <a href="#SymNXTCUR">NXTCUR</a>            ;get next character
CC8B: 8D 7B 07                     sta     <a href="#SymNXTCUR">NXTCUR</a>            ;save next next character
CC8E: 98                           tya
CC8F: 20 B3 C3                     jsr     <a href="#SymSTORY">STORY</a>             ;and print it
CC92: 7A                           ply                       ;+
CC93: 68           <span id="SymUD2">UD2</span>             pla                       ;get real char
CC94: 20 E6 C8                     jsr     <a href="#SymXBITKBD">XBITKBD</a>           ;was a key pressed?
CC97: 10 26                        bpl     <a href="#SymGETCURX">GETCURX</a>           ;=&gt;no key pressed
CC99: 4C C3 CF     <span id="SymCLKKBD">CLKKBD</span>          jmp     <a href="#Symclrkbd2">clrkbd2</a>           ;+ restore old key look for key and exit

CC9C: EA                           DFB     $EA               ;+ Keep code alignedkey

                   ; 
                   ; ON CURSORS.  Whenever the horizontal cursor position is
                   ; needed, a call to GETCUR is done. This is the equivalent
                   ; of a LDY CH.  This returns the current cursor for II and 
                   ; //e mode, which may have been poked as either CH or OURCH.
                   ; 
                   ; It also forces CH and OLDCH to 0 if 80 column mode active.
                   ; This prevents LDY CH, STA (BASL),Y from trashing non screen
                   ; memory. It works just like the //e.
                   ; 
                   ; All routines that update the cursor's horizontal position
                   ; are here.  This ensures that the newest value of the cursor
                   ; is always used, and that 80 column CH is always 0.
                   ; 
                   ; GETCUR only affects the Y register.
                   ; 
CC9D: A4 24        <span id="SymGETCUR">GETCUR</span>          ldy     <a href="#SymCH">CH</a>                ;if CH=OLDCH, then
CC9F: CC 7B 04                     cpy     <a href="#SymOLDCH">OLDCH</a>             ;OURCH is valid
CCA2: D0 03                        bne     <a href="#SymGETCUR1">GETCUR1</a>           ;=&gt;else CH must have been changed
CCA4: AC 7B 05                     ldy     <a href="#SymOURCH">OURCH</a>             ;use OURCH
CCA7: C4 21        <span id="SymGETCUR1">GETCUR1</span>         cpy     <a href="#SymWNDWDTH">WNDWDTH</a>           ;is the value too big
CCA9: 90 02                        bcc     <a href="#SymGETCUR2">GETCUR2</a>           ;=&gt;no, fits just fine
CCAB: A0 00                        ldy     #0                ;else force CH to 0
                   ; 
                   ; GETCUR2 is commonly used to set the current cursor
                   ; position when Y can be used.
                   ; 
CCAD: 8C 7B 05     <span id="SymGETCUR2">GETCUR2</span>         sty     <a href="#SymOURCH">OURCH</a>             ;update real cursor
CCB0: 2C 1F C0                     bit     <a href="#SymRD80VID">RD80VID</a>           ;80 columns?
CCB3: 10 02                        bpl     <a href="#SymGETCUR3">GETCUR3</a>           ;=&gt;no, set all cursors
CCB5: A0 00                        ldy     #0                ;yes, peg CH to 0
CCB7: 84 24        <span id="SymGETCUR3">GETCUR3</span>         sty     <a href="#SymCH">CH</a>
CCB9: 8C 7B 04                     sty     <a href="#SymOLDCH">OLDCH</a>
CCBC: AC 7B 05                     ldy     <a href="#SymOURCH">OURCH</a>             ;get cursor
CCBF: 60           <span id="SymGETCURX">GETCURX</span>         rts                       ;and fly...

                   ; 
                   ; START AN ESCAPE SEQUENCE:
                   ;  WE HANDLE THE FOLLOWING ONES:
                   ;    @ - HOME &amp; CLEAR
                   ;    A - Cursor right
                   ;    B - Cursor left
                   ;    C - Cursor down
                   ;    D - Cursor up
                   ;    E - CLR TO EOL
                   ;    F - CLR TO EOS
                   ;    I - Up Arrow - CURSOR UP (stay escape)
                   ;    J - Lft Arrow - CURSOR LEFT (stay escape)
                   ;    K - Rt Arrow - CURSOR RIGHT (stay escape)
                   ;    M - Dn Arrow - CURSOR DOWN (stay escape)
                   ;    4 - GOTO 40 COLUMN MODE
                   ;    8 - GOTO 80 COLUMN MODE
                   ;  CTL-D- Disable the printing of control chars
                   ;  CTL-E- Enable the printing of control chars
                   ;  CTL-Q- QUIT (PR#0/IN#0)
                   ; 
CCC0: B9 0C CD     <span id="SymESC3">ESC3</span>            lda     <a href="#SymESCCHAR">ESCCHAR</a>,Y         ;GET CHAR TO "PRINT"
CCC3: 5A                           phy                       ;save index
CCC4: 20 58 CD                     jsr     <a href="#SymCTLCHAR">CTLCHAR</a>           ;execute character
CCC7: 7A                           ply                       ;restore index
CCC8: C0 08                        cpy     #<a href="#SymYHI">YHI</a>              ;If Y&lt;YHI, stay escape
CCCA: B0 21                        bcs     <a href="#SymESCRDKEY">ESCRDKEY</a>          ;=&gt;exit escape mode
                   ; 
                   ; This is the entry point called by RDKEY iff escapes
                   ; are enabled and an escape is encountered.  The next
                   ; keypress is read and processed.  If it is a key that
                   ; terminates escape mode, a new key is read by ESCRDKEY.
                   ; If escape mode should not be terminated, NEWESC is
                   ; called again.
                   ; 
CCCC: 20 1D CC     <span id="SymNEWESC">NEWESC</span>          jsr     <a href="#SymPICKY">PICKY</a>             ;get current character
CCCF: 48                           pha                       ;and save it
CCD0: 29 80                        and     #$80              ;save invert bit
CCD2: 49 AB                        eor     #$AB              ;make it inverted "+"
CCD4: 20 B3 C3                     jsr     <a href="#SymSTORY">STORY</a>             ;and pop it on the screen
CCD7: 20 E6 C8     <span id="SymESC0">ESC0</span>            jsr     <a href="#SymXBITKBD">XBITKBD</a>           ;check for keystroke
CCDA: 10 FB                        bpl     <a href="#SymESC0">ESC0</a>
CCDC: 68                           pla                       ;get old char
CCDD: 20 99 CC                     jsr     <a href="#SymCLKKBD">CLKKBD</a>            ;restore char, get key
CCE0: 20 9B C3                     jsr     <a href="#SymUPSHIFT">UPSHIFT</a>           ;upshift esc char
CCE3: A0 13        <span id="SymESC1">ESC1</span>            ldy     #<a href="#SymESCNUM">ESCNUM</a>           ;COUNT/INDEx
CCE5: D9 F8 CC     <span id="SymESC2">ESC2</span>            cmp     <a href="#SymESCTAB">ESCTAB</a>,Y          ;IS IT A VALID ESCAPE?
CCE8: F0 D6                        beq     <a href="#SymESC3">ESC3</a>              ;=&gt;yes
CCEA: 88                           dey
CCEB: 10 F8                        bpl     <a href="#SymESC2">ESC2</a>              ;TRY 'EM ALL...
                   ; 
                   ; End of escape sequence, read next character.
                   ; This is initially called by RDCHAR which is usually called
                   ; by GETLN to read characters with escapes enabled.
                   ; 
CCED: A9 08        <span id="SymESCRDKEY">ESCRDKEY</span>        lda     #<a href="#SymM_CTL">M_CTL</a>            ;enable escape sequences
CCEF: 1C FB 04                     trb     <a href="#SymVMODE">VMODE</a>
CCF2: 20 0C FD                     jsr     <a href="#SymRDKEY">RDKEY</a>             ;read char with escapes
CCF5: 4C 44 FD                     jmp     <a href="#SymNOESCAPE">NOESCAPE</a>          ;got the key, disable escapes

                   ; 
                   ; When in escape mode, the characters in ESCTAB (high)
                   ; bits set), are mapped into the characters in ESCHAR.
                   ; These characters are then executed by a call to CTLCHAR.
                   ; 
                   ; CTLCHAR looks up a character in the table starting at
                   ; CTLTAB.  It uses the current index as an ijndex into the
                   ; table of routine addresses, CTLADR.  If the character is 
                   ; not in the table, a call to VIDOUT1 is done in case the 
                   ; character is BS, LF, CR, or BEL.
                   ; 
                   ; NOTE: CTLON and CTLOFF are not accessible except through
                   ; and escape sequence
                   ; 
CCF8: CA           <span id="SymESCTAB">ESCTAB</span>          DFB     “J”               ;left (stay esc)
CCF9: 88                           DFB     $88               ;left arrow (stay esc)
CCFA: CD                           DFB     “M”               ;down (stay esc)
CCFB: 8B                           DFB     $8B               ;up arrow (stay esc)
CCFC: 95                           DFB     $95               ;right arrow (stay esc)
CCFD: 8A                           DFB     $8A               ;down arrow (stay esc)
CCFE: C9                           DFB     “I”               ;up (stay esc)
CCFF: CB                           DFB     “K”               ;right (stay esc)
CD00: C2                           DFB     “B”               ;left
CD01: C3                           DFB     “C”               ;down
CD02: C4                           DFB     “D”               ;up
CD03: C1                           DFB     “A”               ;right
CD04: C0                           DFB     “@”               ;formfeed
CD05: C5                           DFB     “E”               ;clear EOL
CD06: C6                           DFB     “F”               ;clear EOS
CD07: B4                           DFB     “4”               ;40 column mode
CD08: B8                           DFB     “8”               ;80 column mode
CD09: 91                           DFB     $91               ;CTL-Q = QUIT
CD0A: 84                           DFB     $84               ;CTL-D ;ctl char disable
CD0B: 85                           DFB     $85               ;CTL-E ;ctl char enable
CD0C: 88           <span id="SymESCCHAR">ESCCHAR</span>         DFB     $88               ;list of escape chars
CD0D: 88                           DFB     $88               ;J: BS (stay esc)
CD0E: 8A                           DFB     $8A               ;&lt;-:BS (stay esc)
CD0F: 9F                           DFB     $9F               ;M: LF (stay esc)
CD10: 9C                           DFB     $9C               ;UP:US (stay esc)
CD11: 8A                           DFB     $8A               ;DN: LF (stay esc)
CD12: 9F                           DFB     $9F               ;I: LF (stay esc)
CD13: 9C                           DFB     $9C               ;K: RT (stay esc)
CD14: 88                           DFB     $88               ;ESC-B = BS
                   ; list of control characters
CD15: 8A           <span id="SymCTLTAB">CTLTAB</span>          DFB     $8A               ;ESC-C = DN
CD16: 9F                           DFB     $9F               ;ESC-D = UP
CD17: 9C                           DFB     $9C               ;ESC-A = RT
CD18: 8C                           DFB     $8C               ;@: Formfeed
CD19: 9D                           DFB     $9D               ;E: CLREOL
CD1A: 8B                           DFB     $8B               ;F: CLREOP
CD1B: 91                           DFB     $91               ;SET40
CD1C: 92                           DFB     $92               ;SET80
CD1D: 95                           DFB     $95               ;QUIT
CD1E: 04                           DFB     $04               ;Disable controls (escape only)
CD1F: 05                           DFB     $05               ;Enable controls (escape only)
                   ; escape chars end here
CD20: 85                           DFB     $85               ;X.CUR.ON
CD21: 86                           DFB     $86               ;X.CUR.OFF
CD22: 8E                           DFB     $8E               ;Normal
CD23: 8F                           DFB     $8F               ;Inverse
CD24: 96                           DFB     $96               ;Scroll down
CD25: 97                           DFB     $97               ;Scroll up
CD26: 98                           DFB     $98               ;mouse chars off
CD27: 99                           DFB     $99               ;home cursor
CD28: 9A                           DFB     $9A               ;clear line
CD29: 9B                           DFB     $9B               ;mouse chars on
CD2A: 66 FC        <span id="SymCTLADR">CTLADR</span>          DW      <a href="#SymLF">LF</a>                ;move cursor down
CD2C: 1A FC                        DW      <a href="#SymUP">UP</a>                ;move cursor up
CD2E: A0 FB                        DW      <a href="#SymNEWADV">NEWADV</a>            ;forward a space
CD30: 58 FC                        DW      <a href="#SymHOME">HOME</a>              ;home cursor, clear screen
CD32: 9C FC                        DW      <a href="#SymCLREOL">CLREOL</a>            ;clear to end of line
CD34: 42 FC                        DW      <a href="#SymCLREOP">CLREOP</a>            ;clear to end of page
CD36: C0 CD                        DW      <a href="#SymSET40">SET40</a>             ;set 40 column mode
CD38: BE CD                        DW      <a href="#SymSET80">SET80</a>             ;set 80 column mode
CD3A: 45 CE                        DW      <a href="#SymQUIT">QUIT</a>              ;Quit video firmware
CD3C: 91 CD                        DW      <a href="#SymCTLOFF">CTLOFF</a>            ;disable //e control chars
CD3E: 95 CD                        DW      <a href="#SymCTLON">CTLON</a>             ;enable //e control chars
CD40: 89 CD                        DW      <a href="#SymX_CUR_ON">X_CUR_ON</a>          ;turn on cursor (pascal)
CD42: 8D CD                        DW      <a href="#SymX_CUR_OFF">X_CUR_OFF</a>         ;turn off cursor (pascal)
CD44: B0 CD                        DW      <a href="#SymX_SO">X_SO</a>              ;normal video
CD46: B7 CD                        DW      <a href="#SymX_SI">X_SI</a>              ;inverse video
CD48: 30 CB                        DW      <a href="#SymSCROLLDN">SCROLLDN</a>          ;scroll down a line
CD4A: 35 CB                        DW      <a href="#SymSCROLLUP">SCROLLUP</a>          ;scroll up a line
CD4C: 9F CD                        DW      <a href="#SymMOUSOFF">MOUSOFF</a>           ;disable mouse characters
CD4E: A5 CD                        DW      <a href="#SymHOMECUR">HOMECUR</a>           ;move cursor home
CD50: A0 FC                        DW      <a href="#SymCLRLIN">CLRLIN</a>            ;clear current line
CD52: 99 CD                        DW      <a href="#SymMOUSON">MOUSON</a>            ;enable mouse characters

                   ; CTLCHAR executes the control character in the
                   ; accumulator.  If it is called by Pascal, the character
                   ; is always executed.  If it is called by the video
                   ; firmware, the character is executed if M_CTL is set
                   ; and M_CTL2 is clear.
                   ; 
                   ; Note: This routine is only called if the video firmware
                   ; is active. The Monitor ROM calls VIDOUT1 if the video
                   ; firmware is inactive.
                   ; 
CD54: 2C C1 CB     <span id="SymCTLCHAR0">CTLCHAR0</span>        bit     <a href="#SymSEV1">SEV1</a>              ;set V (use M_CTL)
CD57: 50                           DFB     $50               ;BVC opcode (never taken)
CD58: B8           <span id="SymCTLCHAR">CTLCHAR</span>         clv                       ;Always do the control character
CD59: DA                           phx                       ;save X
CD5A: 8D F8 04                     sta     <a href="#SymTEMP1">TEMP1</a>             ;temp save of A
CD5D: 20 04 FC                     jsr     <a href="#SymVIDOUT1">VIDOUT1</a>           ;try to execute CR, LF, BS, or BEL
CD60: CD F8 04                     cmp     <a href="#SymTEMP1">TEMP1</a>             ;if acc has changed
CD63: D0 0A                        bne     <a href="#SymCTLDONE">CTLDONE</a>           ;then function done
CD65: A2 14                        ldx     #&lt;<a href="#SymCTLNUM">CTLNUM</a>          ;number of CTL chars
CD67: DD 15 CD     <span id="SymFNDCTL">FNDCTL</span>          cmp     <a href="#SymCTLTAB">CTLTAB</a>,X          ;is it in table
CD6A: F0 05                        beq     <a href="#SymCTLGO">CTLGO</a>             ;=&gt;yes, should we execute?
CD6C: CA                           dex                       ;else check next
CD6D: 10 F8                        bpl     <a href="#SymFNDCTL">FNDCTL</a>            ;=&gt;try next one
CD6F: FA           <span id="SymCTLDONE">CTLDONE</span>         plx                       ;restore X
CD70: 60                           rts                       ;and return

                   ; 
CD71: 48           <span id="SymCTLGO">CTLGO</span>           pha                       ;save A
CD72: 50 0C                        bvc     <a href="#SymCTLGO1">CTLGO1</a>            ;V clear, always do (pascal,escape)
CD74: AD FB 04                     lda     <a href="#SymVMODE">VMODE</a>             ;controls are enabled iff
                   NOTE: M_CTL+M_CTL2
CD77: 29 28                        and     #$28              ; M_CTL = 1 and
CD79: 49 08                        eor     #<a href="#SymM_CTL">M_CTL</a>            ; M_CTL2 = 0
CD7B: F0 03                        beq     <a href="#SymCTLGO1">CTLGO1</a>            ;=&gt;they're enabled!!
CD7D: 68           <span id="SymCGO">CGO</span>             pla                       ;restore A
CD7E: FA                           plx                       ;restore X
CD7F: 60                           rts                       ;and return

                   ; 
CD80: 8A           <span id="SymCTLGO1">CTLGO1</span>          txa                       ;double X as index
CD81: 0A                           asl     A                 ;into address table
CD82: AA                           tax
CD83: 68                           pla                       ;restore A
CD84: 20 A4 FC                     jsr     <a href="#SymCTLDO">CTLDO</a>             ;execute the char
CD87: FA                           plx                       ;restore X
CD88: 60                           rts                       ;and return

                   ; 
                   ; X_CUR_ON = Allow Pascal cursor display
                   ; X_CUR_OFF = Disable Pascal cursor display
                   ; Cursor is not displayed during call, so it will
                   ; be right when "redisplayed".
                   ; Note: Though these commands are executed from BASIC,
                   ; they ahve no effect on firmware operation.
                   ; 
CD89: A9 10        <span id="SymX_CUR_ON">X_CUR_ON</span>        lda     #$10              ;clear cursor bit
CD8B: 80 0E                        bra     <a href="#SymCLRIT">CLRIT</a>

CD8D: A9 10        <span id="SymX_CUR_OFF">X_CUR_OFF</span>       lda     #$10              ;set cursor bit
CD8F: 80 10                        bra     <a href="#SymSETIT">SETIT</a>

                   ; 
                   ; The control characters other than CR,LF,BEL,BS
                   ; are normally enabled when video firmware is active.
                   ; They can be disabled and enabled using the ESC-D
                   ; and ESC-E escape sequences.
                   ; 
CD91: A9 20        <span id="SymCTLOFF">CTLOFF</span>          lda     #<a href="#SymM_CTL2">M_CTL2</a>           ;disable control characters
CD93: 80 0C                        bra     <a href="#SymSETIT">SETIT</a>             ;by setting M_CTL2

CD95: A9 20        <span id="SymCTLON">CTLON</span>           lda     #<a href="#SymM_CTL2">M_CTL2</a>           ;enable control characters
CD97: 80 02                        bra     <a href="#SymCLRIT">CLRIT</a>             ;by clearning M_CTL2

                   ; 
                   ; Enable mouse text by clearing M_MOUSE
                   ; 
CD99: A9 01        <span id="SymMOUSON">MOUSON</span>          lda     #<a href="#SymM_Mouse">M_Mouse</a>
CD9B: 1C FB 04     <span id="SymCLRIT">CLRIT</span>           trb     <a href="#SymVMODE">VMODE</a>
CD9E: 60                           rts

                   ; 
                   ; Disable mouse text by setting M_MOUSE
                   ; 
CD9F: A9 01        <span id="SymMOUSOFF">MOUSOFF</span>         lda     #<a href="#SymM_Mouse">M_Mouse</a>
CDA1: 0C FB 04     <span id="SymSETIT">SETIT</span>           tsb     <a href="#SymVMODE">VMODE</a>
CDA4: 60                           rts

                   ; 
                   ; EXECUTE HOME:
                   ; 
CDA5: 20 E9 FE     <span id="SymHOMECUR">HOMECUR</span>         jsr     <a href="#SymCLRCH">CLRCH</a>             ;move cursors to far left
CDA8: A8                           tay                       ; (probably not needed)
CDA9: A5 22                        lda     <a href="#SymWNDTOP">WNDTOP</a>            ;and to top of window
CDAB: 85 25                        sta     <a href="#SymCV">CV</a>
CDAD: 4C 88 FC                     jmp     <a href="#SymNEWVTABZ">NEWVTABZ</a>          ;then set base address, OURCV

                   ; 
                   ; EXECUTE "NORMAL VIDEO"
                   ; 
CDB0: 20 84 FE     <span id="SymX_SO">X_SO</span>            jsr     <a href="#SymSETNORM">SETNORM</a>           ;set INVFLG to $FF
CDB3: A9 04                        lda     #<a href="#SymM_VMODE">M_VMODE</a>          ;then clear inverse mode bit
CDB5: 80 E4                        bra     <a href="#SymCLRIT">CLRIT</a>

                   ; 
                   ; EXECUTE "INVERSE VIDEO"
                   ; 
CDB7: 20 80 FE     <span id="SymX_SI">X_SI</span>            jsr     <a href="#SymSETINV">SETINV</a>            ;set INVFLG to $3F
CDBA: A9 04                        lda     #<a href="#SymM_VMODE">M_VMODE</a>          ;then set inverse mode bit
CDBC: 80 E3                        bra     <a href="#SymSETIT">SETIT</a>

                   ; 
                   ; EXECUTE '40COL MODE' or '80COL MODE':
                   ; 
CDBE: 38           <span id="SymSET80">SET80</span>           sec                       ;flag an 80 column window
CDBF: 90                           DFB     $90               ;BCC opcode (never taken)
CDC0: 18           <span id="SymSET40">SET40</span>           clc                       ;flag a 40 column window
CDC1: 2C FB 04                     bit     <a href="#SymVMODE">VMODE</a>             ;but...it is pascal?
CDC4: 10 54                        bpl     <a href="#SymSETX">SETX</a>              ;=&gt;yes, don't execute
CDC6: 08                           php                       ;save window size
CDC7: 20 1B CE                     jsr     <a href="#SymHOOKITUP">HOOKITUP</a>          ;COPYROM if needed, set I/O hooks
CDCA: 28                           plp                       ;and get 40/80
CDCB: 80 08                        bra     <a href="#SymWIN0">WIN0</a>              ;=&gt;set window

                   ; 
                   ; CHK80 is called by PR#0 to convert to 40 if it was
                   ; 80. Otherwise the window is left ajar.
                   ; 
CDCD: 2C 1F C0     <span id="SymCHK80">CHK80</span>           bit     <a href="#SymRD80VID">RD80VID</a>           ;don't set 40 if
CDD0: 10 48                        bpl     <a href="#SymSETX">SETX</a>              ;already 40
CDD2: 18           <span id="SymWIN40">WIN40</span>           clc                       ;flag 40 column window
CDD3: B0                           DFB     $B0               ;BCS opcode (never taken)
CDD4: 38           <span id="SymWIN80">WIN80</span>           sec                       ;flag 80 column window
CDD5: 64 22        <span id="SymWIN0">WIN0</span>            stz     <a href="#SymWNDTOP">WNDTOP</a>            ;set window top now
CDD7: 2C 1A C0                     bit     <a href="#SymRDTEXT">RDTEXT</a>            ;for text or mixed
CDDA: 30 04                        bmi     <a href="#SymWIN1">WIN1</a>              ;=&gt;text
CDDC: A9 14                        lda     #20
CDDE: 85 22                        sta     <a href="#SymWNDTOP">WNDTOP</a>            ;used by 80&lt;-&gt;49 conversion
CDE0: 2C 1F C0     <span id="SymWIN1">WIN1</span>            bit     <a href="#SymRD80VID">RD80VID</a>           ;80 columns now?
CDE3: 08                           php                       ;save 80 or 40
CDE4: B0 07                        bcs     <a href="#SymWIN2">WIN2</a>              ;=&gt;80: convert if 40
CDE6: 10 0A                        bpl     <a href="#SymWIN3">WIN3</a>              ;=&gt;40: no convert
CDE8: 20 53 CE                     jsr     <a href="#SymSCRN84">SCRN84</a>            ;80: convert to 40
CDEB: 80 05                        bra     <a href="#SymWIN3">WIN3</a>              ;done converting

CDED: 30 03        <span id="SymWIN2">WIN2</span>            bmi     <a href="#SymWIN3">WIN3</a>              ;=&gt;80: no convert
CDEF: 20 80 CE                     jsr     <a href="#SymSCRN48">SCRN48</a>            ;40: convert to 80
CDF2: 20 9D CC     <span id="SymWIN3">WIN3</span>            jsr     <a href="#SymGETCUR">GETCUR</a>            ;determine absolute CH
CDF5: 98                           tya                       ;in case the window setting
CDF6: 18                           clc                       ;was different
CDF7: 65 20                        adc     <a href="#SymWNDLFT">WNDLFT</a>
CDF9: 28                           plp                       ;pin to right edge if
CDFA: B0 06                        bcs     <a href="#SymWIN4">WIN4</a>              ;80 to 40 leaves cursor
CDFC: C9 28                        cmp     #40               ;off the screen
CDFE: 90 02                        bcc     <a href="#SymWIN4">WIN4</a>
CE00: A9 27                        lda     #39
CE02: 20 EC FE     <span id="SymWIN4">WIN4</span>            jsr     <a href="#SymSETCUR">SETCUR</a>            ;set new cursor
CE05: A5 25                        lda     <a href="#SymCV">CV</a>                ;set new base address
CE07: 20 C1 FB                     jsr     <a href="#SymBASCALC">BASCALC</a>           ;for left = 0 (always)
                   ; 
CE0A: 64 20        <span id="SymWNDREST">WNDREST</span>         stz     <a href="#SymWNDLFT">WNDLFT</a>            ;Called by INIT and Pascal
CE0C: A9 18                        lda     #$18              ;and bottom
CE0E: 85 23                        sta     <a href="#SymWNDBTM">WNDBTM</a>
CE10: A9 28                        lda     #$28              ;set left,width,bottom
CE12: 2C 1F C0                     bit     <a href="#SymRD80VID">RD80VID</a>           ;set width to 80 if 80 columns
CE15: 10 01                        bpl     <a href="#SymWIN5">WIN5</a>
CE17: 0A                           asl     A
CE18: 85 21        <span id="SymWIN5">WIN5</span>            sta     <a href="#SymWNDWDTH">WNDWDTH</a>           ;set width
CE1A: 60           <span id="SymSETX">SETX</span>            rts                       ;exit used by SET40/80

                   ; 
                   ; Turn on video firmware:
                   ; 
                   ; This routine is used by BASIC init, ESC-4, ESC-8
                   ; It copies the Monitor ROM to the language card
                   ; if necessary; it sets the input and output hooks to
                   ; $C30x; it sets all switches for video firmware operation
                   ; 
CE1B: 2C 7B 06     <span id="SymHOOKITUP">HOOKITUP</span>        bit     <a href="#SymVFACTV">VFACTV</a>
CE1E: 10 11                        bpl     <a href="#SymVIDMODE">VIDMODE</a>
CE20: 20 38 C3     <span id="SymHOOKUP">HOOKUP</span>          jsr     <a href="#SymCOPYROM">COPYROM</a>
CE23: A9 05        <span id="Symsethooks">sethooks</span>        lda     #&lt;<a href="#SymC3KEYIN">C3KEYIN</a>
CE25: 85 38                        sta     <a href="#SymKSWL">KSWL</a>
CE27: A9 07                        lda     #&lt;<a href="#SymC3COUT1">C3COUT1</a>
CE29: 85 36                        sta     <a href="#SymCSWL">CSWL</a>
CE2B: A9 C3                        lda     #&gt;<a href="#SymC3COUT1">C3COUT1</a>
CE2D: 85 39                        sta     <a href="#SymKSWH">KSWH</a>
CE2F: 85 37                        sta     <a href="#SymCSWH">CSWH</a>
                   ; 
                   ; Now set the video firmware active
                   ; 
CE31: 9C FB 07     <span id="SymVIDMODE">VIDMODE</span>         stz     <a href="#SymCURSOR">CURSOR</a>            ;set a solid inverse cursor
CE34: A9 08                        lda     #<a href="#SymM_CTL">M_CTL</a>            ;preserve M_CTL bit
CE36: 2D FB 04                     and     <a href="#SymVMODE">VMODE</a>
                   ; M_PASCAL+M_MOUSE
CE39: 09 81                        ora     #$81              ;no pascal,mouse
                   ; 
                   ; Pascal calls here to set its mode
                   ; 
CE3B: 8D FB 04     <span id="SymPVMODE">PVMODE</span>          sta     <a href="#SymVMODE">VMODE</a>             ;set mode bits
CE3E: 9C 7B 06                     stz     <a href="#SymVFACTV">VFACTV</a>            ;say video firmware active
CE41: 8D 0F C0                     sta     <a href="#SymSETALTCHAR">SETALTCHAR</a>        ;and set alternate char set
CE44: 60           <span id="SymQX">QX</span>              rts

CE45: 2C FB 04     <span id="SymQUIT">QUIT</span>            bit     <a href="#SymVMODE">VMODE</a>             ;no quitting from pascal
CE48: 10 FA                        bpl     <a href="#SymQX">QX</a>
CE4A: 20 D2 CD                     jsr     <a href="#SymWIN40">WIN40</a>             ;first, do an escape 4
CE4D: 20 89 FE     <span id="SymZZQUIT">ZZQUIT</span>          jsr     <a href="#SymSETKBD">SETKBD</a>            ;do a IN#0 (used by COMM)
CE50: 4C 93 FE                     jmp     <a href="#SymSETVID">SETVID</a>            ;and a PR#0

                   ; 
                   ; SCRN84 and SCRN48 convert screens between 40 &amp; 80 cols.
                   ; WNDTOP must be set up to indicate the last line to
                   ; be done.  All registers are trashed.
                   ; 
CE53: A2 17        <span id="SymSCRN84">SCRN84</span>          ldx     #23
CE55: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>
CE58: 8A           <span id="SymSCR1">SCR1</span>            txa
CE59: 20 C1 FB                     jsr     <a href="#SymBASCALC">BASCALC</a>
CE5C: A0 27                        ldy     #39
CE5E: 5A           <span id="SymSCR2">SCR2</span>            phy
CE5F: 98                           tya
CE60: 4A                           lsr     A
CE61: B0 03                        bcs     <a href="#SymSCR3">SCR3</a>
CE63: 2C 55 C0                     bit     <a href="#SymTXTPAGE2">TXTPAGE2</a>
CE66: A8           <span id="SymSCR3">SCR3</span>            tay
CE67: B1 28                        lda     (<a href="#SymBASL">BASL</a>),Y
CE69: 2C 54 C0                     bit     <a href="#SymTXTPAGE1">TXTPAGE1</a>
CE6C: 7A                           ply
CE6D: 91 28                        sta     (<a href="#SymBASL">BASL</a>),Y
CE6F: 88                           dey
CE70: 10 EC                        bpl     <a href="#SymSCR2">SCR2</a>
CE72: CA                           dex
CE73: 30 04                        bmi     <a href="#SymSCR4">SCR4</a>
CE75: E4 22                        cpx     <a href="#SymWNDTOP">WNDTOP</a>
CE77: B0 DF                        bcs     <a href="#SymSCR1">SCR1</a>
CE79: 8D 00 C0     <span id="SymSCR4">SCR4</span>            sta     <a href="#SymCLR80COL">CLR80COL</a>
CE7C: 8D 0C C0                     sta     <a href="#SymCLR80VID">CLR80VID</a>
CE7F: 60                           rts

                   ; 
CE80: A2 17        <span id="SymSCRN48">SCRN48</span>          ldx     #23               ;start at bottom of screen
CE82: 8A           <span id="SymSCR5">SCR5</span>            txa                       ;set base for current line
CE83: 20 C1 FB                     jsr     <a href="#SymBASCALC">BASCALC</a>
CE86: A0 00                        ldy     #0                ;start at left of screen
CE88: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>          ;enable page2 store
CE8B: B1 28        <span id="SymSCR6">SCR6</span>            lda     (<a href="#SymBASL">BASL</a>),Y          ;get 40 column char
CE8D: 5A           <span id="SymSCR8">SCR8</span>            phy                       ;save 40 column index
CE8E: 48                           pha                       ;save char
CE8F: 98                           tya                       ;div 2 for 80 column index
CE90: 4A                           lsr     A
CE91: B0 03                        bcs     <a href="#SymSCR7">SCR7</a>              ;save on page1
CE93: 8D 55 C0                     sta     <a href="#SymTXTPAGE2">TXTPAGE2</a>
CE96: A8           <span id="SymSCR7">SCR7</span>            tay                       ;get 80 column index
CE97: 68                           pla                       ;now save character
CE98: 91 28                        sta     (<a href="#SymBASL">BASL</a>),Y
CE9A: 8D 54 C0                     sta     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;flip page1
CE9D: 7A                           ply                       ;restore 40 column index
CE9E: C8                           iny                       ;move to the right
CE9F: C0 28                        cpy     #40               ;at right yet?
CEA1: 90 E8                        bcc     <a href="#SymSCR6">SCR6</a>              ;=&gt;no, do next column
CEA3: 20 CF CB                     jsr     <a href="#SymCLRHALF">CLRHALF</a>           ;clear half of screen
CEA6: CA                           dex                       ;else do next line of screen
CEA7: 30 04                        bmi     <a href="#SymSCR9">SCR9</a>              ;=&gt;done with top line
CEA9: E4 22                        cpx     <a href="#SymWNDTOP">WNDTOP</a>            ;at top yet?
CEAB: B0 D5                        bcs     <a href="#SymSCR5">SCR5</a>
CEAD: 8D 0D C0     <span id="SymSCR9">SCR9</span>            sta     <a href="#SymSET80VID">SET80VID</a>          ;convert to 80 columns
CEB0: 60                           rts
                                   ADREND  ↑ ~$C91D

                   ; Pascal Support Stuff
                                   ORG     $CEB1
CEB1: AA           <span id="SymPSTATUS">PSTATUS</span>         tax                       ;is request code=0?
CEB2: F0 08                        beq     <a href="#SymPIORDY">PIORDY</a>            ;=&gt;yes, ready for output
CEB4: CA                           dex                       ;check for any input
CEB5: D0 07                        bne     <a href="#SymPSTERR">PSTERR</a>            ;=&gt;bad request, return error
CEB7: 20 E6 C8                     jsr     <a href="#SymXBITKBD">XBITKBD</a>           ;test keyboard
CEBA: 10 04                        bpl     <a href="#SymPNOTRDY">PNOTRDY</a>           ;=&gt;no keystroked
CEBC: 38           <span id="SymPIORDY">PIORDY</span>          sec                       ;good return
CEBD: 60                           rts

CEBE: A2 03        <span id="SymPSTERR">PSTERR</span>          ldx     #3                ;else flag error
CEC0: 18           <span id="SymPNOTRDY">PNOTRDY</span>         clc
CEC1: 60                           rts

                   ; 
                   ; PASCAL OUTPUT:
                   ; 
CEC2: 09 80        <span id="SymPWRITE">PWRITE</span>          ora     #$80              ;turn on high bit
CEC4: AA                           tax                       ;save character
CEC5: 20 54 CF                     jsr     <a href="#SymPSETUP2">PSETUP2</a>           ;SETUP ZP STUFF, don't set ROM
CEC8: A9 08                        lda     #<a href="#SymM_GOXY">M_GOXY</a>           ;ARE WE DOING GOTOXY?
CECA: 2C FB 04                     bit     <a href="#SymVMODE">VMODE</a>
CECD: D0 2B                        bne     <a href="#SymGETX">GETX</a>              ;=&gt;Doing X or Y?
CECF: 8A                           txa                       ;now check for control char
CED0: 89 60                        bit     #$60              ;is it control?
CED2: F0 45                        beq     <a href="#SymPCTL">PCTL</a>              ;=&gt;yes, do control
CED4: AC 7B 05                     ldy     <a href="#SymOURCH">OURCH</a>             ;get horizontal position
CED7: 24 32                        bit     <a href="#SymINVFLG">INVFLG</a>            ;check for inverse
CED9: 30 02                        bmi     <a href="#SymPWR1">PWR1</a>              ;normal, go store it
CEDB: 29 7F                        and     #$7F
CEDD: 20 C1 C3     <span id="SymPWR1">PWR1</span>            jsr     <a href="#SymSTORE">STORE</a>             ;now store it (erasing cursor)
CEE0: C8                           iny                       ;INC CH
CEE1: 8C 7B 05                     sty     <a href="#SymOURCH">OURCH</a>
CEE4: C4 21                        cpy     <a href="#SymWNDWDTH">WNDWDTH</a>
CEE6: 90 0C                        bcc     <a href="#SymPWRET">PWRET</a>
CEE8: 20 60 C3                     jsr     <a href="#SymSETROM">SETROM</a>
CEEB: 20 E9 FE                     jsr     <a href="#SymCLRCH">CLRCH</a>             ;set cursor position to 0
CEEE: 20 66 FC                     jsr     <a href="#SymLF">LF</a>
CEF1: 20 54 C3     <span id="SymPWRITERET">PWRITERET</span>       jsr     <a href="#SymRESETLC">RESETLC</a>
CEF4: 20 0B CC     <span id="SymPWRET">PWRET</span>           jsr     <a href="#SymPASINVERT">PASINVERT</a>         ;display new cursor
CEF7: A2 00        <span id="SymPRET">PRET</span>            ldx     #0                ;return with no error
CEF9: 60                           rts

                   ; 
                   ; HANDLE GOTOXY STUFF
                   ; 
CEFA: 20 0B CC     <span id="SymGETX">GETX</span>            jsr     <a href="#SymPASINVERT">PASINVERT</a>         ;turn off cursor
CEFD: 8A                           txa                       ;get character
CEFE: 38                           sec
CEFF: E9 A0                        sbc     #160              ;MAKE BINARY
CF01: 2C FB 06                     bit     <a href="#SymXCOORD">XCOORD</a>            ;doing X?
CF04: 30 2A                        bmi     <a href="#SymPSETX">PSETX</a>             ;=&gt;yes, set it
                   ; 
                   ; Set Y and do the GOTOXY
                   ; 
CF06: 8D FB 05     <span id="SymGETY">GETY</span>            sta     <a href="#SymOURCV">OURCV</a>
CF09: 20 71 CF                     jsr     <a href="#SymPASCALC">PASCALC</a>           ;calc base addr
CF0C: AC FB 06                     ldy     <a href="#SymXCOORD">XCOORD</a>
CF0F: 20 AD CC                     jsr     <a href="#SymGETCUR2">GETCUR2</a>           ;set proper cursors
CF12: A9 08                        lda     #<a href="#SymM_GOXY">M_GOXY</a>           ;turn off gotoxy
CF14: 1C FB 04                     trb     <a href="#SymVMODE">VMODE</a>
CF17: 80 DB                        bra     <a href="#SymPWRET">PWRET</a>             ;=&gt;DONE (ALWAYS TAKEN)

CF19: 20 0B CC     <span id="SymPCTL">PCTL</span>            jsr     <a href="#SymPASINVERT">PASINVERT</a>         ;turn off cursor
CF1C: 8A                           txa                       ;get char
CF1D: C9 9E                        cmp     #$9E              ;is it gotoXY?
CF1F: F0 08                        beq     <a href="#SymSTARTXY">STARTXY</a>           ;=&gt;yes, start it up
CF21: 20 60 C3                     jsr     <a href="#SymSETROM">SETROM</a>            ;must switch in ROM for controls
CF24: 20 58 CD                     jsr     <a href="#SymCTLCHAR">CTLCHAR</a>           ;EXECUTE IT IF POSSIBLE
CF27: 80 C8                        bra     <a href="#SymPWRITERET">PWRITERET</a>         ;=&gt;display new cursor, exit

                   ; 
                   ; START THE GOTOXY SEQUENCE:
                   ; 
CF29: A9 08        <span id="SymSTARTXY">STARTXY</span>         lda     #<a href="#SymM_GOXY">M_GOXY</a>
CF2B: 0C FB 04                     tsb     <a href="#SymVMODE">VMODE</a>             ;turn on gotoxy
CF2E: A9 FF                        lda     #$FF              ;set XCOORD to -1
CF30: 8D FB 06     <span id="SymPSETX">PSETX</span>           sta     <a href="#SymXCOORD">XCOORD</a>            ;set X
CF33: 80 BF                        bra     <a href="#SymPWRET">PWRET</a>             ;=&gt;display cursor and exit

                   ; 
                   ; PASCAL INPUT:
                   ; 
CF35: 20 54 CF     <span id="SymPASREAD">PASREAD</span>         jsr     <a href="#SymPSETUP2">PSETUP2</a>           ;SETUP ZP STUFF
CF38: 20 D5 C8     <span id="SymGKEY">GKEY</span>            jsr     <a href="#SymXRDKBD">XRDKBD</a>            ;key pressed?
CF3B: 10 FB                        bpl     <a href="#SymGKEY">GKEY</a>              ;=&gt;not yet
CF3D: 29 7F                        and     #$7F              ;DROP HI BIT
CF3F: 80 B6                        bra     <a href="#SymPRET">PRET</a>              ;good exit

                   ; 
                   ; PASCAL INITIALIZATION:
                   ; 
CF41: A9 01        <span id="SymPINIT">PINIT</span>           lda     #<a href="#SymM_Mouse">M_Mouse</a>          ;Set mode to pascal
CF43: 20 3B CE                     jsr     <a href="#SymPVMODE">PVMODE</a>            ;without mouse characters
CF46: 20 51 CF                     jsr     <a href="#SymPSETUP">PSETUP</a>            ;setup zero page for pascal
CF49: 20 D4 CD                     jsr     <a href="#SymWIN80">WIN80</a>             ;do 40-&gt;80 convert
CF4C: 20 58 FC                     jsr     <a href="#SymHOME">HOME</a>              ;home and clear screen
CF4F: 80 A0                        bra     <a href="#SymPWRITERET">PWRITERET</a>         ;display cursor, set OURCH,OURCV...

                   ; 
CF51: 20 60 C3     <span id="SymPSETUP">PSETUP</span>          jsr     <a href="#SymSETROM">SETROM</a>            ;save LC state, set ROM read
CF54: 64 22        <span id="SymPSETUP2">PSETUP2</span>         stz     <a href="#SymWNDTOP">WNDTOP</a>            ;set top to 0
CF56: 20 0A CE                     jsr     <a href="#SymWNDREST">WNDREST</a>           ;init either 40 or 80 window
CF59: A9 FF                        lda     #$FF              ;assume normal text
CF5B: 85 32                        sta     <a href="#SymINVFLG">INVFLG</a>
CF5D: A9 04                        lda     #<a href="#SymM_VMODE">M_VMODE</a>          ;is it
CF5F: 2C FB 04                     bit     <a href="#SymVMODE">VMODE</a>
CF62: F0 02                        beq     <a href="#SymPS1">PS1</a>               ;=&gt;yes
CF64: 46 32                        lsr     <a href="#SymINVFLG">INVFLG</a>            ;no, make flag inverse
CF66: AC 7B 05     <span id="SymPS1">PS1</span>             ldy     <a href="#SymOURCH">OURCH</a>
CF69: 20 AD CC                     jsr     <a href="#SymGETCUR2">GETCUR2</a>           ;set all cursors
CF6C: AD FB 05                     lda     <a href="#SymOURCV">OURCV</a>
CF6F: 85 25                        sta     <a href="#SymCV">CV</a>
                   ; 
                   ; Put BASCAL here so we don't have to swtich
                   ; in the ROMs for each character output.
                   ; 
CF71: 0A           <span id="SymPASCALC">PASCALC</span>         asl     A
CF72: A8                           tay                       ;calc base addr in BASL,H
CF73: 4A                           lsr     A                 ;for given line no.
CF74: 4A                           lsr     A
CF75: 29 03                        and     #$03              ; 0&lt;=line no.&lt;=$17
CF77: 09 04                        ora     #4                ; arg=000ABCDE, generate
CF79: 85 29                        sta     <a href="#SymBASH">BASH</a>              ; BASH=000001CD
CF7B: 98                           tya                       ;and
CF7C: 6A                           ror     A                 ; BASL=EABAB000
CF7D: 29 98                        and     #$98
CF7F: 85 28        <span id="SymPASCLC2">PASCLC2</span>         sta     <a href="#SymBASL">BASL</a>
CF81: 0A                           asl     A
CF82: 0A                           asl     A
CF83: 04 28                        tsb     <a href="#SymBASL">BASL</a>
CF85: 60                           rts
                                   ADREND  ↑ $CEB1

                   ; More random junk (moremisc)
CF86: 83           <span id="SymIRQTBLE">IRQTBLE</span>         DFB     &lt;<a href="#SymLCBANK2">LCBANK2</a>
CF87: 8B                           DFB     &lt;<a href="#SymLCBANK1">LCBANK1</a>
CF88: 8B                           DFB     &lt;<a href="#SymLCBANK1">LCBANK1</a>
CF89: 05                           DFB     &lt;<a href="#SymWRCARDRAM">WRCARDRAM</a>
CF8A: 03                           DFB     &lt;<a href="#SymRDCARDRAM">RDCARDRAM</a>
CF8B: 55                           DFB     &lt;<a href="#SymTXTPAGE2">TXTPAGE2</a>
CF8C: 9E 0B 40 50+ <span id="Symcomtbl">comtbl</span>          HEX     $9E,$0B,$40,$50,$16,$0B,$01,$00
CF94: CD C1 D8 D9+ <span id="Symrtbl">rtbl</span>            ASC     “MAXYPS”

                   ********************************************************************************
                   * MOVEIRQ - This routine transfers the roms interrupt vector into              *
                   *           both language cards                                                *
                   ********************************************************************************
CF9A: 20 A0 CF     <span id="Symm_oveirq">m_oveirq</span>        jsr     <a href="#Symmoveirq">moveirq</a>
CF9D: 4C 84 C7                     jmp     <a href="#Symswrts">swrts</a>

CFA0: 20 60 C3     <span id="Symmoveirq">moveirq</span>         jsr     <a href="#SymSETROM">SETROM</a>            ;Read ROM and Write to RAM
CFA3: AD 16 C0                     lda     <a href="#SymRDALTZP">RDALTZP</a>           ;Which language card?
CFA6: 0A                           asl     A                 ;C=1 if alternate card
CFA7: A0 01                        ldy     #1                ;Move two bytes
CFA9: B9 FE FF     <span id="SymMIRQLP">MIRQLP</span>          lda     <a href="#SymIRQVECT">IRQVECT</a>,Y         ;Get byte from ROM
CFAC: 8D 09 C0                     sta     <a href="#SymSETALTZP">SETALTZP</a>          ;Set alternate card
CFAF: 99 FE FF                     sta     <a href="#SymIRQVECT">IRQVECT</a>,Y         ;Store it in the RAM card
CFB2: 8D 08 C0                     sta     <a href="#SymSETSTDZP">SETSTDZP</a>          ;Set main card
CFB5: 99 FE FF                     sta     <a href="#SymIRQVECT">IRQVECT</a>,Y
CFB8: 88                           dey
CFB9: 10 EE                        bpl     <a href="#SymMIRQLP">MIRQLP</a>            ;Go do the second byte
CFBB: 90 03                        bcc     <a href="#SymMIRQSTD">MIRQSTD</a>           ;Is the card set right?
CFBD: 8D 09 C0                     sta     <a href="#SymSETALTZP">SETALTZP</a>          ;No, it wasn't
CFC0: 4C 54 C3     <span id="SymMIRQSTD">MIRQSTD</span>         jmp     <a href="#SymRESETLC">RESETLC</a>           ;Clean up &amp; go ohme

                   ********************************************************************************
                   * CLKKBD2 - Moved here from scrolling routines                                 *
                   ********************************************************************************
CFC3: 5A           <span id="Symclrkbd2">clrkbd2</span>         phy                       ;Now preserved Y
CFC4: 20 B3 C3                     jsr     <a href="#SymSTORY">STORY</a>
CFC7: 7A                           ply
CFC8: 4C D5 C8                     jmp     <a href="#SymXRDKBD">XRDKBD</a>

                   ********************************************************************************
                   * LOOKASC - addition to monitor input routine, if a quote (')                  *
                   * in input, the ascii of the next is input like a hex number                   *
                   ********************************************************************************
CFCB: B0 11        <span id="SymLOOKASC">LOOKASC</span>         bcs     <a href="#Symladig">ladig</a>             ;Was char a hex digit?
CFCD: C9 A0                        cmp     #$A0              ;Is it a quote
CFCF: D0 13                        bne     <a href="#Symladone">ladone</a>            ;Done if not
CFD1: B9 00 02                     lda     <a href="#Syminbuf">inbuf</a>,Y           ;Get next char
CFD4: A2 07                        ldx     #7                ;for shifting asci into A2L and A2H
CFD6: C9 8D                        cmp     #$8D              ;Was it a cr?
CFD8: F0 07                        beq     <a href="#Symlacr">lacr</a>              ;Go handle cr
CFDA: C8                           iny                       ;Advance index into inbuf
CFDB: 4C 90 FF                     jmp     <a href="#SymNXTBIT">NXTBIT</a>            ;Go shift it in

CFDE: 4C 8A FF     <span id="Symladig">ladig</span>           jmp     <a href="#SymDIG">DIG</a>

CFE1: 4C A7 FF     <span id="Symlacr">lacr</span>            jmp     <a href="#SymGETNUM">GETNUM</a>

CFE4: 60           <span id="Symladone">ladone</span>          rts

CFE5: 00 00 00 00+                 DS      26,$00
CFFF: D0           <span id="SymClearIOROMs">ClearIOROMs</span>     DFB     $D0
                   <span style="background-color: #89acb7">NOTE: Applesoft BASIC *skip*</span>
D000:              Applesoft_Basic
                                   ORG     *+$0000
D000: 6F D8 65 D7+                 DS      34
D022: E1 F3 E8 F6+ <span id="SymINCMD">INCMD</span>           DS      10206
                                   ADREND  ↑ $D000

                   <span style="background-color: #89acb7">NOTE: TODO: F8 ROM</span>
                   ; Apple //c F8 Monitor firmware
F800:              IIc_F8_Monitor
                                   ORG     *+$0000
F800: 4A           <span id="SymPLOT">PLOT</span>            lsr     A                 ;Y-COORD/2
F801: 08                           php                       ;SAVE LSB IN CARRY
F802: 20 47 F8                     jsr     <a href="#SymGBASCALC">GBASCALC</a>          ;CALC BASE FOR ADR IN GBASL,H
F805: 28                           plp                       ;RESTORE LSB FROM CARRY
F806: A9 0F                        lda     #$0F              ;MASK $0F IF EVEN
F808: 90 02                        bcc     <a href="#SymRTMASK">RTMASK</a>
F80A: 69 E0                        adc     #$E0              ;MASK $F0 IF ODD
F80C: 85 2E        <span id="SymRTMASK">RTMASK</span>          sta     <a href="#SymMASK">MASK</a>
F80E: B1 26        <span id="SymPLOT1">PLOT1</span>           lda     (<a href="#SymGBASL">GBASL</a>),Y         ;DATA
F810: 45 30                        eor     <a href="#SymCOLOR">COLOR</a>             ; XOR COLOR
F812: 25 2E                        and     <a href="#SymMASK">MASK</a>              ;  AND MASK
F814: 51 26                        eor     (<a href="#SymGBASL">GBASL</a>),Y         ;   XOR DATA
F816: 91 26                        sta     (<a href="#SymGBASL">GBASL</a>),Y         ;    TO DATA
F818: 60                           rts

F819: 20 00 F8     <span id="SymHLINE">HLINE</span>           jsr     <a href="#SymPLOT">PLOT</a>              ;PLOT SQUARE
F81C: C4 2C        <span id="SymHLINE1">HLINE1</span>          cpy     <a href="#SymH2">H2</a>                ;DONE?
F81E: B0 11                        bcs     <a href="#SymRTS1">RTS1</a>              ; YES, RETURN
F820: C8                           iny                       ; NO, INCR INDEX (X-COORD)
F821: 20 0E F8                     jsr     <a href="#SymPLOT1">PLOT1</a>             ;PLOT NEXT SQUARE
F824: 90 F6                        bcc     <a href="#SymHLINE1">HLINE1</a>            ;ALWAYS TAKEN
F826: 69 01        <span id="SymVLINEZ">VLINEZ</span>          adc     #$01              ;NEXT Y-COORD
F828: 48           <span id="SymVLINE">VLINE</span>           pha                       ; SAVE ON STACK
F829: 20 00 F8                     jsr     <a href="#SymPLOT">PLOT</a>              ; PLOT SQUARE
F82C: 68                           pla
F82D: C5 2D                        cmp     <a href="#SymV2">V2</a>                ;DONE?
F82F: 90 F5                        bcc     <a href="#SymVLINEZ">VLINEZ</a>            ; NO, LOOP.
F831: 60           <span id="SymRTS1">RTS1</span>            rts

                   ; 
F832: A0 2F        <span id="SymCLRSCR">CLRSCR</span>          ldy     #$2F              ;MAX Y, FULL SCRN CLR
F834: D0 02                        bne     <a href="#SymCLRSC2">CLRSC2</a>            ;ALWAYS TAKEN

F836: A0 27        <span id="SymCLRTOP">CLRTOP</span>          ldy     #$27              ;MAX Y, TOP SCRN CLR
F838: 84 2D        <span id="SymCLRSC2">CLRSC2</span>          sty     <a href="#SymV2">V2</a>                ;STORE AS BOTTOM COORD
                   ; FOR VLINE CALLS
F83A: A0 27                        ldy     #$27
F83C: A9 00        <span id="SymCLRSC3">CLRSC3</span>          lda     #$00              ;RIGHTMOST X-COORD (COLUMN)
F83E: 85 30                        sta     <a href="#SymCOLOR">COLOR</a>             ;TOP COORD FOR VLINE CALLS
F840: 20 28 F8                     jsr     <a href="#SymVLINE">VLINE</a>             ;CLEAR COLOR (BLACK)
F843: 88                           dey                       ;DRAW VLINE
F844: 10 F6                        bpl     <a href="#SymCLRSC3">CLRSC3</a>            ;NEXT LEFTMOST X-COORD
F846: 60                           rts                       ;LOOP UNITL DONE.

F847: 48           <span id="SymGBASCALC">GBASCALC</span>        pha                       ;FOR INPUT  00DEFGH
F848: 4A                           lsr     A
F849: 29 03                        and     #$03
F84B: 09 04                        ora     #$04              ;GENERATE GBASH=000001FG
F84D: 85 27                        sta     <a href="#SymGBASH">GBASH</a>
F84F: 68                           pla                       ;AND GBASL=HDEDE000
F850: 29 18                        and     #$18
F852: 90 02                        bcc     <a href="#SymGBCALC">GBCALC</a>
F854: 69 7F                        adc     #$7F
F856: 85 26        <span id="SymGBCALC">GBCALC</span>          sta     <a href="#SymGBASL">GBASL</a>
F858: 0A                           asl     A
F859: 0A                           asl     A
F85A: 05 26                        ora     <a href="#SymGBASL">GBASL</a>
F85C: 85 26                        sta     <a href="#SymGBASL">GBASL</a>
F85E: 60                           rts

                   ; 
F85F: A5 30        <span id="SymNXTCOL">NXTCOL</span>          lda     <a href="#SymCOLOR">COLOR</a>             ;INCREMENT COLOR BY 3
F861: 18                           clc
F862: 69 03                        adc     #$03
F864: 29 0F        <span id="SymSETCOL">SETCOL</span>          and     #$0F              ;SETS COLOR=17*A MOD 16
F866: 85 30                        sta     <a href="#SymCOLOR">COLOR</a>
F868: 0A                           asl     A                 ;BOTH HALF BYTES OF COLOR EQUAL
F869: 0A                           asl     A
F86A: 0A                           asl     A
F86B: 0A                           asl     A
F86C: 05 30                        ora     <a href="#SymCOLOR">COLOR</a>
F86E: 85 30                        sta     <a href="#SymCOLOR">COLOR</a>
F870: 60                           rts

F871: 4A           <span id="SymSCRN">SCRN</span>            lsr     A                 ;READ SCREEN Y-COORD/2
F872: 08                           php                       ;SAVE LSB (CARRY)
F873: 20 47 F8                     jsr     <a href="#SymGBASCALC">GBASCALC</a>          ;CALC BASE ADDRESS
F876: B1 26                        lda     (<a href="#SymGBASL">GBASL</a>),Y         ;GET BYTE
F878: 28                           plp                       ;RESTORE LSB FROM CARRY
F879: 90 04        <span id="SymSCRN2">SCRN2</span>           bcc     <a href="#SymRTMSKZ">RTMSKZ</a>            ;IF EVEN, USE LO H
F87B: 4A                           lsr     A
F87C: 4A                           lsr     A
F87D: 4A                           lsr     A                 ;SHIFT HIGH HALF BYTE DOWN
F87E: 4A                           lsr     A
F87F: 29 0F        <span id="SymRTMSKZ">RTMSKZ</span>          and     #$0F              ;MASK 4-BITS
F881: 60                           rts

F882: A6 3A        <span id="SymINSDS1">INSDS1</span>          ldx     <a href="#SymPCL">PCL</a>               ;PRINT PCL,H
F884: A4 3B                        ldy     <a href="#SymPCH">PCH</a>
F886: 20 96 FD                     jsr     <a href="#SymPRYX2">PRYX2</a>
F889: 20 48 F9                     jsr     <a href="#SymPRBLNK">PRBLNK</a>            ;FOLLOWED BY A BLANK
F88C: A1 3A                        lda     (<a href="#SymPCL">PCL</a>,X)           ;GET OPCODE
F88E: A8           <span id="SymINDS2">INDS2</span>           tay                       ;LABLE moved down 1
F88F: 4A                           lsr     A                 ;EVEN/ODD TEST
F890: 90 05                        bcc     <a href="#SymIEVEN">IEVEN</a>
F892: 6A                           ror     A                 ;BIT 1 TEST
F893: B0 0C                        bcs     <a href="#SymERR">ERR</a>               ;XXXXXX11 INVALID OP
F895: 29 87                        and     #$87              ;MASK BITS
F897: 4A           <span id="SymIEVEN">IEVEN</span>           lsr     A                 ;LASB INTO CARRY FOR L/R TEST
F898: AA                           tax
F899: BD 62 F9                     lda     <a href="#SymFMT1">FMT1</a>,X            ;GET FORMAT INDEX BYTE
F89C: 20 79 F8                     jsr     <a href="#SymSCRN2">SCRN2</a>             ;R/L H-BYTE ON CARRY
F89F: D0 04                        bne     <a href="#SymGETFMT">GETFMT</a>
F8A1: A0 FC        <span id="SymERR">ERR</span>             ldy     #$FC              ;SBSTITUTE $FC FOR INVALID OPS
F8A3: A9 00                        lda     #$00              ;SET PRINT FORMAT INDEX TO 0
F8A5: AA           <span id="SymGETFMT">GETFMT</span>          tax
F8A6: BD A6 F9                     lda     <a href="#SymFMT2">FMT2</a>,X            ;INDEX INTO PRINT FORMAT TABLE
F8A9: 85 2E                        sta     <a href="#SymFORMAT">FORMAT</a>            ;SAVE FOR ADR FIELD FORMATTING
F8AB: 29 03                        and     #$03              ;MASK FOR 2-BIT LENGTH
                   ; (0=1 BYTE, 1=2 BYTE, 2=3 BYTE)
F8AD: 85 2F                        sta     <a href="#SymLENGTH">LENGTH</a>
F8AF: 20 35 FC                     jsr     <a href="#SymNEWOPS">NEWOPS</a>            ;get index for new opcodes
F8B2: F0 18                        beq     <a href="#SymGOTONE">GOTONE</a>            ;found a new op (or no op)
F8B4: 29 8F                        and     #$8F              ;MASK FOR 1XXX1010 TEST
F8B6: AA                           tax                       ; SAVE IT
F8B7: 98                           tya                       ;OPCODE TO A AGAIN
F8B8: A0 03                        ldy     #$03
F8BA: E0 8A                        cpx     #$8A
F8BC: F0 0B                        beq     <a href="#SymMNNDX3">MNNDX3</a>
F8BE: 4A           <span id="SymMNNDX1">MNNDX1</span>          lsr     A
F8BF: 90 08                        bcc     <a href="#SymMNNDX3">MNNDX3</a>            ;FORM INDEX INTO MNEMONIC TABLE
F8C1: 4A                           lsr     A
F8C2: 4A           <span id="SymMNNDX2">MNNDX2</span>          lsr     A                 ;  1) 1XXX1010 =&gt; 00101XXX
F8C3: 09 20                        ora     #$20              ;  2) XXXYYY01 =&gt; 00111XXX
F8C5: 88                           dey                       ;  3) XXXYYY10 =&gt; 00110XXX
F8C6: D0 FA                        bne     <a href="#SymMNNDX2">MNNDX2</a>            ;  4) XXXYY100 =&gt; 00100XXX
F8C8: C8                           iny                       ;  5) XXXXX000 =&gt; 000XXXXX
F8C9: 88           <span id="SymMNNDX3">MNNDX3</span>          dey
F8CA: D0 F2                        bne     <a href="#SymMNNDX1">MNNDX1</a>
F8CC: 60           <span id="SymGOTONE">GOTONE</span>          rts

F8CD: FF FF FF                     HEX     $FF,$FF,$FF

F8D0: 20 82 F8     <span id="Syminstdsp">instdsp</span>         jsr     <a href="#SymINSDS1">INSDS1</a>            ;GEN FMT, LEN BYTES
F8D3: 48                           pha                       ;SAVE MNEMONIC TABLE INDEX
F8D4: B1 3A        <span id="SymPRNTOP">PRNTOP</span>          lda     (<a href="#SymPCL">PCL</a>),Y
F8D6: 20 DA FD                     jsr     <a href="#SymPRBYTE">PRBYTE</a>
F8D9: A2 01                        ldx     #$01              ;PRINT 2 BLANKS
F8DB: 20 4A F9     <span id="SymPRNTBL">PRNTBL</span>          jsr     <a href="#SymPRBL2">PRBL2</a>
F8DE: C4 2F                        cpy     <a href="#SymLENGTH">LENGTH</a>            ;PRINT INST (1-3 BYTES)
F8E0: C8                           iny                       ;IN A 12 CHR FIELD
F8E1: 90 F1                        bcc     <a href="#SymPRNTOP">PRNTOP</a>
F8E3: A2 03                        ldx     #$03              ;CHAR COUNT FOR MNEMONIC INDEX
F8E5: C0 04                        cpy     #$04
F8E7: 90 F2                        bcc     <a href="#SymPRNTBL">PRNTBL</a>
F8E9: 68                           pla                       ;RECOVER MNEMONIC INDEX
F8EA: A8                           tay
F8EB: B9 C0 F9                     lda     <a href="#SymMNEML">MNEML</a>,Y
F8EE: 85 2C                        sta     <a href="#SymLMNEM">LMNEM</a>             ;FETCH 3-CHAR MNEMONIC
F8F0: B9 00 FA                     lda     <a href="#SymMNEMR">MNEMR</a>,Y           ;  (PACKED INTO 2-BYTES)
F8F3: 85 2D                        sta     <a href="#SymRMNEM">RMNEM</a>
F8F5: A9 00        <span id="SymPRMN1">PRMN1</span>           lda     #$00
F8F7: A0 05                        ldy     #$05
F8F9: 06 2D        <span id="SymPRMN2">PRMN2</span>           asl     <a href="#SymRMNEM">RMNEM</a>             ;SHIFT 5 BITS OF CHARACTER INTO A
F8FB: 26 2C                        rol     <a href="#SymLMNEM">LMNEM</a>
F8FD: 2A                           rol     A                 ;  (CLEARS CARRY)
F8FE: 88                           dey
F8FF: D0 F8                        bne     <a href="#SymPRMN2">PRMN2</a>
F901: 69 BF                        adc     #$BF              ;ADD "?" OFFSET
F903: 20 ED FD                     jsr     <a href="#Symcout">cout</a>              ;OUTPUT A CHAR OF MNEM
F906: CA                           dex
F907: D0 EC                        bne     <a href="#SymPRMN1">PRMN1</a>
F909: 20 48 F9                     jsr     <a href="#SymPRBLNK">PRBLNK</a>            ;OUTPUT 3 BLANKS
F90C: A4 2F                        ldy     <a href="#SymLENGTH">LENGTH</a>
F90E: A2 06                        ldx     #$06              ;CNT FOR 6 FORMAT BITS
F910: E0 03        <span id="SymPRADR1">PRADR1</span>          cpx     #$03
F912: F0 1C                        beq     <a href="#SymPRADR5">PRADR5</a>            ;IF X=3 THEN ADDR.
F914: 06 2E        <span id="SymPRADR2">PRADR2</span>          asl     <a href="#SymFORMAT">FORMAT</a>
F916: 90 0E                        bcc     <a href="#SymPRADR3">PRADR3</a>
F918: BD B9 F9                     lda     <a href="#SymCHAR1">CHAR1</a>-1,X
F91B: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
F91E: BD B3 F9                     lda     <a href="#SymCHAR2">CHAR2</a>-1,X
F921: F0 03                        beq     <a href="#SymPRADR3">PRADR3</a>
F923: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
F926: CA           <span id="SymPRADR3">PRADR3</span>          dex
F927: D0 E7                        bne     <a href="#SymPRADR1">PRADR1</a>
F929: 60                           rts

F92A: 88           <span id="SymPRADR4">PRADR4</span>          dey
F92B: 30 E7                        bmi     <a href="#SymPRADR2">PRADR2</a>
F92D: 20 DA FD                     jsr     <a href="#SymPRBYTE">PRBYTE</a>
F930: A5 2E        <span id="SymPRADR5">PRADR5</span>          lda     <a href="#SymFORMAT">FORMAT</a>
F932: C9 E8                        cmp     #$E8              ;HANDLE REL ADR MODE
F934: B1 3A                        lda     (<a href="#SymPCL">PCL</a>),Y           ;SPECIAL (PRINT TARGET,
F936: 90 F2                        bcc     <a href="#SymPRADR4">PRADR4</a>            ;  NOT OFFSET)
F938: 20 56 F9     <span id="SymRELADR">RELADR</span>          jsr     <a href="#Sympcadj3">pcadj3</a>
F93B: AA                           tax                       ;PCL,PCH+OFFSET+1 TO A,Y
F93C: E8                           inx
F93D: D0 01                        bne     <a href="#SymPRNTYX">PRNTYX</a>            ;+1 TO Y,X
F93F: C8                           iny
F940: 98           <span id="SymPRNTYX">PRNTYX</span>          tya
F941: 20 DA FD     <span id="SymPRNTAX">PRNTAX</span>          jsr     <a href="#SymPRBYTE">PRBYTE</a>            ;OUTPUT TARGET ADR
F944: 8A           <span id="SymPRNTX">PRNTX</span>           txa                       ;  OF BRANCH AND RETURN
F945: 4C DA FD                     jmp     <a href="#SymPRBYTE">PRBYTE</a>

F948: A2 03        <span id="SymPRBLNK">PRBLNK</span>          ldx     #$03              ;BLANK COUNT
F94A: A9 A0        <span id="SymPRBL2">PRBL2</span>           lda     #$A0              ;LOAD A SPACE
F94C: 20 ED FD     <span id="SymPRBL3">PRBL3</span>           jsr     <a href="#Symcout">cout</a>              ;OUTPUT A BLANK
F94F: CA                           dex
F950: D0 F8                        bne     <a href="#SymPRBL2">PRBL2</a>             ;LOOP UNTIL COUNT=0
F952: 60                           rts

F953: 38           <span id="Sympcadj">pcadj</span>           sec                       ;0=1 BYTE, 1=2 BYTE,
F954: A5 2F        <span id="Sympcadj2">pcadj2</span>          lda     <a href="#SymLENGTH">LENGTH</a>            ;  2=3 BYTE
F956: A4 3B        <span id="Sympcadj3">pcadj3</span>          ldy     <a href="#SymPCH">PCH</a>
F958: AA                           tax                       ;TEST DISPLACEMENT SIGN
F959: 10 01                        bpl     <a href="#Sympcadj4">pcadj4</a>            ;  (FOR REL BRANCH)
F95B: 88                           dey                       ;EXTEND NEG BY DECR PCH
F95C: 65 3A        <span id="Sympcadj4">pcadj4</span>          adc     <a href="#SymPCL">PCL</a>
F95E: 90 01                        bcc     <a href="#SymRTS2">RTS2</a>              ;PCL+LENGTH(OR DISPL)+1 TO A
F960: C8                           iny                       ;  CARRY INTO Y (PCH)
F961: 60           <span id="SymRTS2">RTS2</span>            rts

                   ; FMT1 BYTES:    XXXXXXY0 INSTRS
                   ; IF Y=0         THEN RIGHT HALF BYTE
                   ; IF Y=1         THEN LEFT HALF BYTE
                   ;                   (X=INDEX)
                   ; 
F962: 0F           <span id="SymFMT1">FMT1</span>            DFB     $0F
F963: 22                           DFB     $22
F964: FF                           DFB     $FF
F965: 33                           DFB     $33
F966: CB                           DFB     $CB
F967: 62                           DFB     $62
F968: FF                           DFB     $FF
F969: 73                           DFB     $73
F96A: 03                           DFB     $03
F96B: 22                           DFB     $22
F96C: FF                           DFB     $FF
F96D: 33                           DFB     $33
F96E: CB                           DFB     $CB
F96F: 66                           DFB     $66
F970: FF                           DFB     $FF
F971: 77                           DFB     $77
F972: 0F                           DFB     $0F
F973: 20                           DFB     $20
F974: FF                           DFB     $FF
F975: 33                           DFB     $33
F976: CB                           DFB     $CB
F977: 60                           DFB     $60
F978: FF                           DFB     $FF
F979: 70                           DFB     $70
F97A: 0F                           DFB     $0F
F97B: 22                           DFB     $22
F97C: FF                           DFB     $FF
F97D: 39                           DFB     $39
F97E: CB                           DFB     $CB
F97F: 66                           DFB     $66
F980: FF                           DFB     $FF
F981: 7D                           DFB     $7D
F982: 0B                           DFB     $0B
F983: 22                           DFB     $22
F984: FF                           DFB     $FF
F985: 33                           DFB     $33
F986: CB                           DFB     $CB
F987: A6                           DFB     $A6
F988: FF                           DFB     $FF
F989: 73                           DFB     $73
F98A: 11                           DFB     $11
F98B: 22                           DFB     $22
F98C: FF                           DFB     $FF
F98D: 33                           DFB     $33
F98E: CB                           DFB     $CB
F98F: A6                           DFB     $A6
F990: FF                           DFB     $FF
F991: 87                           DFB     $87
F992: 01                           DFB     $01
F993: 22                           DFB     $22
F994: FF                           DFB     $FF
F995: 33                           DFB     $33
F996: CB                           DFB     $CB
F997: 60                           DFB     $60
F998: FF                           DFB     $FF
F999: 70                           DFB     $70
F99A: 01                           DFB     $01
F99B: 22                           DFB     $22
F99C: FF                           DFB     $FF
F99D: 33                           DFB     $33
F99E: CB                           DFB     $CB
F99F: 60                           DFB     $60
F9A0: FF                           DFB     $FF
F9A1: 70                           DFB     $70
F9A2: 24                           DFB     $24
F9A3: 31                           DFB     $31
F9A4: 65                           DFB     $65
F9A5: 78                           DFB     $78
                   ; ZZXXXY01 INSTR'S
F9A6: 00           <span id="SymFMT2">FMT2</span>            DFB     $00               ;ERR
F9A7: 21                           DFB     $21               ;IMM
F9A8: 81                           DFB     $81               ;Z-PAGE
F9A9: 82                           DFB     $82               ;ABS
F9AA: 59                           DFB     $59               ;(ZPAG,X)
F9AB: 4D                           DFB     $4D               ;(ZPAG),Y
F9AC: 91                           DFB     $91               ;ZPAG,X
F9AD: 92                           DFB     $92               ;ABS,X
F9AE: 86                           DFB     $86               ;ABS,Y
F9AF: 4A                           DFB     $4A               ;(ABS)
F9B0: 85                           DFB     $85               ;ZPAG,Y
F9B1: 9D                           DFB     $9D               ;RELATIVE
F9B2: 49                           DFB     $49               ;(ZPAG)      (new)
F9B3: 5A                           DFB     $5A               ;(ABS,X)     (new)
                   ; 
F9B4: D9           <span id="SymCHAR2">CHAR2</span>           DFB     $D9               ;'Y'
F9B5: 00                           DFB     $00               ; (byte F of FMT2)
F9B6: D8                           DFB     $D8               ;'Y'
F9B7: A4                           DFB     $A4               ;'$'
F9B8: A4                           DFB     $A4               ;'$'
F9B9: 00                           DFB     $00
                   ; 
F9BA: AC           <span id="SymCHAR1">CHAR1</span>           DFB     “,”               ;','
F9BB: A9                           DFB     “)”               ;')'
F9BC: AC                           DFB     “,”               ;','
F9BD: A3                           DFB     “#”               ;'#'
F9BE: A8                           DFB     “(”               ;'('
F9BF: A4                           DFB     “$”               ;'$'
F9C0: 1C           <span id="SymMNEML">MNEML</span>           DFB     $1C
F9C1: 8A                           DFB     $8A
F9C2: 1C                           DFB     $1C
F9C3: 23                           DFB     $23
F9C4: 5D                           DFB     $5D
F9C5: 8B                           DFB     $8B
F9C6: 1B                           DFB     $1B
F9C7: A1                           DFB     $A1
F9C8: 9D                           DFB     $9D
F9C9: 8A                           DFB     $8A
F9CA: 1D                           DFB     $1D
F9CB: 23                           DFB     $23
F9CC: 9D                           DFB     $9D
F9CD: 8B                           DFB     $8B
F9CE: 1D                           DFB     $1D
F9CF: A1                           DFB     $A1
F9D0: 1C                           DFB     $1C               ;BRA
F9D1: 29                           DFB     $29
F9D2: 19                           DFB     $19
F9D3: AE                           DFB     $AE
F9D4: 69                           DFB     $69
F9D5: A8                           DFB     $A8
F9D6: 19                           DFB     $19
F9D7: 23                           DFB     $23
F9D8: 24                           DFB     $24
F9D9: 53                           DFB     $53
F9DA: 1B                           DFB     $1B
F9DB: 23                           DFB     $23
F9DC: 24                           DFB     $24
F9DD: 53                           DFB     $53
F9DE: 19                           DFB     $19
F9DF: A1                           DFB     $A1               ; (A) FORMAT ABOVE
F9E0: AD                           DFB     $AD               ; TSB
F9E1: 1A                           DFB     $1A
F9E2: 5B                           DFB     $5B
F9E3: 5B                           DFB     $5B
F9E4: A5                           DFB     $A5
F9E5: 69                           DFB     $69
F9E6: 24                           DFB     $24
F9E7: 24                           DFB     $24               ; (B) FORMAT
F9E8: AE                           DFB     $AE
F9E9: AE                           DFB     $AE
F9EA: A8                           DFB     $A8
F9EB: AD                           DFB     $AD
F9EC: 29                           DFB     $29
F9ED: 8A                           DFB     $8A
F9EE: 7C                           DFB     $7C
F9EF: 8B                           DFB     $8B               ; (C) FORMAT
F9F0: 15                           DFB     $15
F9F1: 9C                           DFB     $9C
F9F2: 6D                           DFB     $6D
F9F3: 9C                           DFB     $9C
F9F4: A5                           DFB     $A5
F9F5: 69                           DFB     $69
F9F6: 29                           DFB     $29
F9F7: 53                           DFB     $53               ; (D) FORMAT
F9F8: 84                           DFB     $84
F9F9: 13                           DFB     $13
F9FA: 34                           DFB     $34
F9FB: 11                           DFB     $11
F9FC: A5                           DFB     $A5
F9FD: 69                           DFB     $69
F9FE: 23                           DFB     $23               ; (E) FORMAT
F9FF: A0                           DFB     $A0
                   ; 
FA00: D8           <span id="SymMNEMR">MNEMR</span>           DFB     $D8
FA01: 62                           DFB     $62
FA02: 5A                           DFB     $5A
FA03: 48                           DFB     $48
FA04: 26                           DFB     $26
FA05: 62                           DFB     $62
FA06: 94                           DFB     $94
FA07: 88                           DFB     $88
FA08: 54                           DFB     $54
FA09: 44                           DFB     $44
FA0A: C8                           DFB     $C8
FA0B: 54                           DFB     $54
FA0C: 68                           DFB     $68
FA0D: 44                           DFB     $44
FA0E: E8                           DFB     $E8
FA0F: 94                           DFB     $94
FA10: C4                           DFB     $C4               ;BRA
FA11: B4                           DFB     $B4
FA12: 08                           DFB     $08
FA13: 84                           DFB     $84
FA14: 74                           DFB     $74
FA15: B4                           DFB     $B4
FA16: 28                           DFB     $28
FA17: 6E                           DFB     $6E
FA18: 74                           DFB     $74
FA19: F4                           DFB     $F4
FA1A: CC                           DFB     $CC
FA1B: 4A                           DFB     $4A
FA1C: 72                           DFB     $72
FA1D: F2                           DFB     $F2
FA1E: A4                           DFB     $A4
FA1F: 8A                           DFB     $8A               ; (A) FORMAT
FA20: 06                           DFB     $06               ; TSB
FA21: AA                           DFB     $AA
FA22: A2                           DFB     $A2
FA23: A2                           DFB     $A2
FA24: 74                           DFB     $74
FA25: 74                           DFB     $74
FA26: 74                           DFB     $74
FA27: 72                           DFB     $72               ; (B) FORMAT
FA28: 44                           DFB     $44
FA29: 68                           DFB     $68
FA2A: B2                           DFB     $B2
FA2B: 32                           DFB     $32
FA2C: B2                           DFB     $B2
FA2D: 72                           DFB     $72
FA2E: 22                           DFB     $22
FA2F: 72                           DFB     $72               ; (C) FORMAT
FA30: 1A                           DFB     $1A
FA31: 1A                           DFB     $1A
FA32: 26                           DFB     $26
FA33: 26                           DFB     $26
FA34: 72                           DFB     $72
FA35: 72                           DFB     $72
FA36: 88                           DFB     $88
FA37: C8                           DFB     $C8               ; (D) FORAMT
FA38: C4                           DFB     $C4
FA39: CA                           DFB     $CA
FA3A: 26                           DFB     $26
FA3B: 48                           DFB     $48
FA3C: 44                           DFB     $44
FA3D: 44                           DFB     $44
FA3E: A2                           DFB     $A2
FA3F: C8                           DFB     $C8               ; (E) FORMAT

FA40: 85 45        <span id="SymIRQ">IRQ</span>             sta     $45               ;+ Trash $45 for those who want it
FA42: A5 45                        lda     $45               ;+
FA44: 4C 03 C8                     jmp     <a href="#SymNEWIRQ">NEWIRQ</a>            ;+

                   ; 
                   ; NEWBRK is called by the interrupt handler which has
                   ; set the hardware to its default state and encoded
                   ; the state in the accumulator.  Software that wants
                   ; to do break processing using full system resources
                   ; can restore the machine state from this value.
                   ; 
FA47: 85 44        <span id="SymNEWBRK">NEWBRK</span>          sta     <a href="#SymMACSTAT">MACSTAT</a>           ;save state of machine
FA49: 7A                           ply                       ;restore registers for save
FA4A: FA                           plx
FA4B: 68                           pla
                   ; 
FA4C: 28           <span id="SymBREAK">BREAK</span>           plp                       ;Note: same as old BREAK routine!!
FA4D: 20 4A FF                     jsr     <a href="#SymSAVE">SAVE</a>              ;save reg's on BRK
FA50: 68                           pla                       ;including PC
FA51: 85 3A                        sta     <a href="#SymPCL">PCL</a>
FA53: 68                           pla
FA54: 85 3B                        sta     <a href="#SymPCH">PCH</a>
FA56: 6C F0 03                     jmp     (<a href="#SymBRKV">BRKV</a>)            ;call BRK HANDLER

                   ; 
FA59: 20 82 F8     <span id="SymOLDBRK">OLDBRK</span>          jsr     <a href="#SymINSDS1">INSDS1</a>            ;PRINT USER PC
FA5C: 20 DA FA                     jsr     <a href="#Symrgdsp1">rgdsp1</a>            ;  AND REGS
FA5F: 4C 65 FF                     jmp     <a href="#SymMON">MON</a>               ;GO TO MONITOR (NO PASS GO, NO $200!)

                   <span style="background-color: #72be72">NOTE: pdf page 464</span>
                   <span style="background-color: #72be72">The IIc boot code is more different than the IIe code that I expected. -James</span>
                   ; 
FA62: D8           <span id="SymRESET">RESET</span>           cld                       ;DO THIS FIRST THIS TIME
FA63: 20 84 FE                     jsr     <a href="#SymSETNORM">SETNORM</a>
FA66: 20 2F FB                     jsr     <a href="#SymINIT">INIT</a>
FA69: 20 4D CE                     jsr     <a href="#SymZZQUIT">ZZQUIT</a>            ;+ Setvid &amp; Setkbd
FA6C: 20 40 C7                     jsr     <a href="#Syminitmouse">initmouse</a>         ;initialize the mouse
FA6F: 20 04 CC                     jsr     <a href="#SymCLRPORT">CLRPORT</a>           ;clear port setup bytes
FA72: 9C FC 04                     stz     <a href="#Symaciabuf">aciabuf</a>           ;and the commahead buffer
FA75: AD 5F C0                     lda     <a href="#SymSETAN3">SETAN3</a>            ; AN3 = TTL HI
FA78: 20 BD FA                     jsr     <a href="#SymRESET_X">RESET_X</a>           ;initialize other devices
FA7B: 2C 10 C0                     bit     <a href="#SymKBDSTRB">KBDSTRB</a>           ; CLEAR KEYBOARD
FA7E: 80 05                        bra     <a href="#SymBEEPSKIP">BEEPSKIP</a>          ;+ Bell already beeped

FA80: FF                           nop                       ;+ align code
FA81: D8           <span id="SymNEWMON">NEWMON</span>          cld
FA82: 20 3A FF                     jsr     <a href="#SymBELL">BELL</a>              ; CAUSES DELAY IF KEY BOUNCES
FA85: AD F3 03     <span id="SymBEEPSKIP">BEEPSKIP</span>        lda     <a href="#SymSOFTEV">SOFTEV</a>+1          ;IS RESET HI
FA88: 49 A5                        eor     #$A5              ;A FUNNY COMPLEMENT OF THE
FA8A: CD F4 03                     cmp     <a href="#SymPWREDUP">PWREDUP</a>           ; PWR UP BYTE ???
FA8D: D0 17                        bne     <a href="#SymPWRUP">PWRUP</a>             ; NO SO PWRUP
FA8F: AD F2 03                     lda     <a href="#SymSOFTEV">SOFTEV</a>            ; YES SEE IF COLD START
FA92: D0 0F                        bne     <a href="#SymNOFIX">NOFIX</a>             ; HAS BEEN DONE YET?
FA94: A9 E0                        lda     #$E0              ; DOES SEV POINT AT BASIC?
FA96: CD F3 03                     cmp     <a href="#SymSOFTEV">SOFTEV</a>+1
FA99: D0 08                        bne     <a href="#SymNOFIX">NOFIX</a>             ; YES SO REENTER SYSTEM
FA9B: A0 03                        ldy     #3                ; NO SO POINT AT WARM START
FA9D: 8C F2 03                     sty     <a href="#SymSOFTEV">SOFTEV</a>            ; FOR NEXT RESET
FAA0: 4C 00 E0                     jmp     <a href="#SymBASIC">BASIC</a>             ; AND DO THE COLD START

FAA3: 6C F2 03     <span id="SymNOFIX">NOFIX</span>           jmp     (<a href="#SymSOFTEV">SOFTEV</a>)

FAA6: 20 CA FC     <span id="SymPWRUP">PWRUP</span>           jsr     <a href="#SymCOLDSTART">COLDSTART</a>         ;Trash memory, init ports
FAA9: A2 05                        ldx     #5                ; SET PAGE 3 VECTORS
FAAB: BD FC FA     <span id="SymSETPLP">SETPLP</span>          lda     <a href="#SymPWRCON">PWRCON</a>-1,X        ; WITH CNTRL B ADRS
FAAE: 9D EF 03                     sta     <a href="#SymBRKV">BRKV</a>-1,X          ; OF CURRENT BASIC
FAB1: CA                           dex
FAB2: D0 F7                        bne     <a href="#SymSETPLP">SETPLP</a>
FAB4: A9 C4                        lda     #$C4              ; LOAD HI SLOT +1
FAB6: 80 5A                        bra     <a href="#SymPWRUP2">PWRUP2</a>            ;branch around mnemonics

                   ; 
                   ; Extension to MNEML (left mnemonics)
                   ; 
FAB8: 8A                           DFB     $8A               ;PHY
FAB9: 8B                           DFB     $8B               ;PLY
FABA: A5                           DFB     $A5               ;STZ
FABB: AC                           DFB     $AC               ;TRB
FABC: 00                           DFB     $00               ;???

                   ; 
                   ; This extension to the monitor reset routine ($FA62)
                   ; checks for apple keys.  If both are pressed, it goes
                   ; into an exerciser mode.  If the open apple key only is
                   ; pressed, memory is selectively trashed and a cold start
                   ; is done.
                   ; 
FABD: A9 FF        <span id="SymRESET_X">RESET_X</span>         lda     #$FF
FABF: 8D FB 04                     sta     <a href="#SymVMODE">VMODE</a>             ;initialize mode
FAC2: 20 3A FF                     jsr     <a href="#SymBELL">BELL</a>              ;+ Need bell delay for 3.5" drive
FAC5: 20 F8 C5                     jsr     <a href="#SymPCNVRST">PCNVRST</a>           ;+ Reset protocol converter
FAC8: 0E 62 C0                     asl     <a href="#SymBUTN1">BUTN1</a>
FACB: 2C 61 C0                     bit     <a href="#SymBUTN0">BUTN0</a>
FACE: 10 5E                        bpl     <a href="#SymRTS2D">RTS2D</a>
FAD0: 90 D4                        bcc     <a href="#SymPWRUP">PWRUP</a>             ;open apple only, reboot
FAD2: 4C C1 C7                     jmp     <a href="#Symbanger">banger</a>            ;bot apples, exercise 'er

FAD5: EA                           nop                       ; + align code
FAD6: EA                           nop                       ; +
FAD7: 20 8E FD     <span id="SymREGDSP">REGDSP</span>          jsr     <a href="#SymCROUT">CROUT</a>             ;DISPLAY USER REG CONTENTS
FADA: A9 44        <span id="Symrgdsp1">rgdsp1</span>          lda     #$44              ;WITH LABELS
FADC: 85 40                        sta     <a href="#SymA3L">A3L</a>               ;Memory state now printed
FADE: A9 00                        lda     #$00
FAE0: 85 41                        sta     <a href="#SymA3H">A3H</a>
FAE2: A2 FA                        ldx     #$FA
FAE4: A9 A0        <span id="SymRDSP1">RDSP1</span>           lda     #$A0
FAE6: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
                   ; RTBL-$FA,X
FAE9: BD 9A CE                     lda     <a href="#Symrtbl">rtbl</a>-250,X
FAEC: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FAEF: A9 BD                        lda     #$BD
FAF1: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FAF4: B5 4A                        lda     <a href="#SymACC">ACC</a>+5,X
FAF6: 80 0A                        bra     <a href="#SymRGDSP2">RGDSP2</a>            ;make room for mnemonics

                   ; 
                   ; Right half of new mnemonics, indexed from MNEMR
                   ; 
FAF8: 74                           DFB     $74               ;PHY
FAF9: 74                           DFB     $74               ;PLY
FAFA: 76                           DFB     $76               ;STZ
FAFB: C6                           DFB     $C6               ;TRB
FAFC: 00                           DFB     $00               ;???
                   ; 
FAFD: 59 FA        <span id="SymPWRCON">PWRCON</span>          DW      <a href="#SymOLDBRK">OLDBRK</a>
FAFF: 00 E0 45                     HEX     $00,$E0,$45

FB02: 20 DA FD     <span id="SymRGDSP2">RGDSP2</span>          jsr     <a href="#SymPRBYTE">PRBYTE</a>
FB05: E8                           inx
FB06: 30 DC                        bmi     <a href="#SymRDSP1">RDSP1</a>
FB08: 60                           rts

FB09: C1 F0 F0 EC+                 ASC     “Apple ][”
FB11: C4                           DFB     $C4               ;optional filler
                   ; 
FB12: 86 00        <span id="SymPWRUP2">PWRUP2</span>          stx     <a href="#SymLOC0">LOC0</a>              ; SETPG3 MUST RETURN X=0
FB14: 85 01                        sta     <a href="#SymLOC1">LOC1</a>              ; SET PTR H
FB16: 20 60 FB                     jsr     <a href="#SymAPPLEII">APPLEII</a>           ;Display our banner...
FB19: 6C 00 00                     jmp     (<a href="#SymLOC0">LOC0</a>)            ;JUMP $C600

FB1C: FF                           nop
FB1D: FF                           nop
                   ; 
FB1E: 4C 00 C9     <span id="SymPREAD">PREAD</span>           jmp     <a href="#SymMPADDLE">MPADDLE</a>           ;read mouse paddle

FB21: A0 00                        ldy     #$00              ;INIT COUNT
FB23: EA                           nop                       ;COMPENSATE FOR 1ST COUNT
FB24: EA                           nop
FB25: BD 64 C0     <span id="SymPREAD2">PREAD2</span>          lda     <a href="#SymPADDL0">PADDL0</a>,X          ;COUNT Y=REG EVERY 12 USEC.
FB28: 10 04                        bpl     <a href="#SymRTS2D">RTS2D</a>
FB2A: C8                           iny
FB2B: D0 F8                        bne     <a href="#SymPREAD2">PREAD2</a>            ;EXIT AT 255 MAX
FB2D: 88                           dey
FB2E: 60           <span id="SymRTS2D">RTS2D</span>           rts

FB2F: A9 00        <span id="SymINIT">INIT</span>            lda     #$00              ;CLR STATUS FOR DEBUG SOFTWARE
FB31: 85 48                        sta     <a href="#SymSTATUS">STATUS</a>
FB33: AD 56 C0                     lda     <a href="#SymLORES">LORES</a>
FB36: AD 54 C0                     lda     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;INIT VIDEO MODE
FB39: AD 51 C0     <span id="SymSETTXT">SETTXT</span>          lda     <a href="#SymTXTSET">TXTSET</a>            ;SET FOR TEXT MODE
FB3C: A9 00                        lda     #$00              ;FULL SCREEN WINDOW
FB3E: F0 0B                        beq     <a href="#SymSETWND">SETWND</a>

FB40: AD 50 C0     <span id="SymSETGR">SETGR</span>           lda     <a href="#SymTXTCLR">TXTCLR</a>            ;SET FOR GRAPHICS MODE
FB43: AD 53 C0                     lda     <a href="#SymMIXSET">MIXSET</a>            ;LOWER 4 LINES AS TEXT WINDOW
FB46: 20 36 F8                     jsr     <a href="#SymCLRTOP">CLRTOP</a>
FB49: A9 14                        lda     #$14
FB4B: 85 22        <span id="SymSETWND">SETWND</span>          sta     <a href="#SymWNDTOP">WNDTOP</a>            ;SET WINDOW
FB4D: EA                           nop
FB4E: EA                           nop
FB4F: 20 0A CE                     jsr     <a href="#SymWNDREST">WNDREST</a>           ;40/80 column width
FB52: 80 05                        bra     <a href="#SymVTAB23">VTAB23</a>

FB54: 09 80        <span id="SymDOCTL">DOCTL</span>           ora     #$80              ;controls need high bit
FB56: 4C 54 CD                     jmp     <a href="#SymCTLCHAR0">CTLCHAR0</a>          ;execute control char

FB59: A9 17        <span id="SymVTAB23">VTAB23</span>          lda     #$17              ;VTAB TO ROW 23
FB5B: 85 25                        sta     <a href="#SymCV">CV</a>                ;VTABS TO ROW IN A-REG
FB5D: 4C 22 FC                     jmp     <a href="#SymVTAB">VTAB</a>              ;don't set OURCV!!

FB60: 20 58 FC     <span id="SymAPPLEII">APPLEII</span>         jsr     <a href="#SymHOME">HOME</a>              ;CLEAR THE SCRN
FB63: A0 09                        ldy     #9
FB65: B9 BA C5     <span id="SymSTITLE">STITLE</span>          lda     <a href="#SymAPPLE2C">APPLE2C</a>-1,Y       ;GET A CHAR
FB68: 99 0D 04                     sta     <a href="#SymLINE1">LINE1</a>+13,Y        ;PUT IT AT TOP CENTER OF SCREEN
FB6B: 88                           dey
FB6C: D0 F7                        bne     <a href="#SymSTITLE">STITLE</a>
FB6E: 60                           rts

FB6F: AD F3 03     <span id="SymSETPWRC">SETPWRC</span>         lda     <a href="#SymSOFTEV">SOFTEV</a>+1          ;ROUTINE TO CALCULATE THE 'FUNNY
FB72: 49 A5                        eor     #$A5              ;COMPLEMENT' FOR THE RESET VECTOR
FB74: 8D F4 03                     sta     <a href="#SymPWREDUP">PWREDUP</a>
FB77: 60                           rts

                   ; CHECK FOR A PUASE (CONTROL-S).
FB78: C9 8D        <span id="SymVIDWAIT">VIDWAIT</span>         cmp     #$8D              ;ONLY WHEN I HAVE A CR
FB7A: D0 18                        bne     <a href="#SymNOWAIT">NOWAIT</a>            ;NOT SO, DO REGULAR
FB7C: AC 00 C0                     ldy     <a href="#SymKBD">KBD</a>               ;IS KEY PRESSED?
FB7F: 10 13                        bpl     <a href="#SymNOWAIT">NOWAIT</a>            ;NO.
FB81: C0 93                        cpy     #$93              ;YES -- IS IT CTRL-S?
FB83: D0 0F                        bne     <a href="#SymNOWAIT">NOWAIT</a>            ;NOPE - IGNORE
FB85: 2C 10 C0                     bit     <a href="#SymKBDSTRB">KBDSTRB</a>           ;CLEAR STROBE
FB88: AC 00 C0     <span id="SymKBDWAIT">KBDWAIT</span>         ldy     <a href="#SymKBD">KBD</a>               ;WAIT TILL NEXT KEY TO RESUME
FB8B: 10 FB                        bpl     <a href="#SymKBDWAIT">KBDWAIT</a>           ;WAIT FOR KEYPRESS
FB8D: C0 83                        cpy     #$83              ;IS IT CONTROL-C?
FB8F: F0 03                        beq     <a href="#SymNOWAIT">NOWAIT</a>            ;YES, SO LEAVE IT
FB91: 2C 10 C0                     bit     <a href="#SymKBDSTRB">KBDSTRB</a>           ;CLR STROBE
FB94: 2C 7B 06     <span id="SymNOWAIT">NOWAIT</span>          bit     <a href="#SymVFACTV">VFACTV</a>            ;is video firmware active?
FB97: 30 64                        bmi     <a href="#SymVIDOUT">VIDOUT</a>            ;=&gt;no, do normal 40 column
FB99: 89 60                        bit     #$60              ;is it a control?
FB9B: F0 B7                        beq     <a href="#SymDOCTL">DOCTL</a>             ;=&gt;YES, DO IT
FB9D: 20 B8 C3                     jsr     <a href="#Symstorch">storch</a>            ;print w/inverse mask
FBA0: EE 7B 05     <span id="SymNEWADV">NEWADV</span>          inc     <a href="#SymOURCH">OURCH</a>             ;advance cursor
FBA3: AD 7B 05                     lda     <a href="#SymOURCH">OURCH</a>             ;and update others
FBA6: 2C 1F C0                     bit     <a href="#SymRD80VID">RD80VID</a>           ;but only if not 80 columns
FBA9: 30 05                        bmi     <a href="#SymNEWADV1">NEWADV1</a>           ;=&gt;80 columns, leav'em
FBAB: 8D 7B 04                     sta     <a href="#SymOLDCH">OLDCH</a>
FBAE: 85 24                        sta     <a href="#SymCH">CH</a>
FBB0: 80 46        <span id="SymNEWADV1">NEWADV1</span>         bra     <a href="#SymADV2">ADV2</a>              ;check for CR

FBB2: FF                           DFB     $FF               ;NOP
                   ; 
FBB3: 06           <span id="SymF8VERSION">F8VERSION</span>       DFB     <a href="#SymGOODF8">GOODF8</a>            ;//e, chels ID byte

FBB4: 10 06        <span id="SymDOCOUT1">DOCOUT1</span>         bpl     <a href="#SymDCX">DCX</a>
FBB6: C9 A0                        cmp     #$A0
FBB8: 90 02                        bcc     <a href="#SymDCX">DCX</a>
FBBA: 25 32                        and     <a href="#SymINVFLG">INVFLG</a>
FBBC: 4C F6 FD     <span id="SymDCX">DCX</span>             jmp     <a href="#SymCOUTZ">COUTZ</a>

FBBF: 03                           DFB     $03               ;REVISION BYTE
                   ; 
FBC0: 00                           DFB     $00               ;chels ID byte

FBC1: 48           <span id="SymBASCALC">BASCALC</span>         pha                       ;CALC BASE ADDR IN BASL,H
FBC2: 4A                           lsr     A                 ;FOR GIVEN LIN NO.
FBC3: 29 03                        and     #$03              ; 0&lt;=LINE NO.&lt;=$17
FBC5: 09 04                        ora     #$04              ;ARG=000ABCDE, GENERATE
FBC7: 85 29                        sta     <a href="#SymBASH">BASH</a>              ; BASH=000001CD
FBC9: 68                           pla                       ; AND
FBCA: 29 18                        and     #$18              ; BASL=EABAB000
FBCC: 90 02                        bcc     <a href="#SymBASCLC2">BASCLC2</a>
FBCE: 69 7F                        adc     #$7F
FBD0: 85 28        <span id="SymBASCLC2">BASCLC2</span>         sta     <a href="#SymBASL">BASL</a>
FBD2: 0A                           asl     A
FBD3: 0A                           asl     A
FBD4: 05 28                        ora     <a href="#SymBASL">BASL</a>
FBD6: 85 28                        sta     <a href="#SymBASL">BASL</a>
FBD8: 60                           rts

FBD9: C9 87        <span id="SymCHKBELL">CHKBELL</span>         cmp     #$87              ;BELL CHAR? (CONTROL-G)
FBDB: D0 12                        bne     <a href="#SymRTS2B">RTS2B</a>             ; NO, RETURN.
FBDD: A9 40        <span id="SymBELL1">BELL1</span>           lda     #$40              ; YES...
FBDF: 20 A8 FC                     jsr     <a href="#SymWAIT">WAIT</a>              ;DELAY .01 SECONDS
FBE2: A0 C0                        ldy     #$C0
FBE4: A9 0C        <span id="SymBELL2">BELL2</span>           lda     #$0C              ;TOGGLE SPEAKER AT 1 KHZ
FBE6: 20 A8 FC                     jsr     <a href="#SymWAIT">WAIT</a>              ; FOR .1 SEC.
FBE9: AD 30 C0                     lda     <a href="#SymSPKR">SPKR</a>
FBEC: 88                           dey
FBED: D0 F5                        bne     <a href="#SymBELL2">BELL2</a>
FBEF: 60           <span id="SymRTS2B">RTS2B</span>           rts

FBF0: A4 24        <span id="SymSTORADV">STORADV</span>         ldy     <a href="#SymCH">CH</a>                ;get 40 column position
FBF2: 91 28                        sta     (<a href="#SymBASL">BASL</a>),Y          ;and store
FBF4: E6 24        <span id="SymADVANCE">ADVANCE</span>         inc     <a href="#SymCH">CH</a>                ;increment cursor
FBF6: A5 24                        lda     <a href="#SymCH">CH</a>
FBF8: C5 21        <span id="SymADV2">ADV2</span>            cmp     <a href="#SymWNDWDTH">WNDWDTH</a>           ;BEYOND WINDOW WIDTH?
FBFA: B0 66                        bcs     <a href="#SymCR">CR</a>                ; YES, CR TO NEXT LINE.
FBFC: 60           <span id="SymRTS3">RTS3</span>            rts                       ; NO, RETURN.

                   <span style="background-color: #89acb7">NOTE: </span>
FBFD: C9 A0        <span id="SymVIDOUT">VIDOUT</span>          cmp     #$A0              ;CONTROL CHAR?
FBFF: B0 EF                        bcs     <a href="#SymSTORADV">STORADV</a>           ; NO, OUTPUT IT.
FC01: A8                           tay                       ;INVERSE VIDEO?
FC02: 10 EC                        bpl     <a href="#SymSTORADV">STORADV</a>           ; YES, OUTPUT IT.
FC04: C9 8D        <span id="SymVIDOUT1">VIDOUT1</span>         cmp     #$8D              ;CR?
FC06: F0 6B                        beq     <a href="#SymNEWCR">NEWCR</a>             ;Yes, use new routine.
FC08: C9 8A                        cmp     #$8A              ;LINE FEED?
FC0A: F0 5A                        beq     <a href="#SymLF">LF</a>                ; IF SO, DO IT.
FC0C: C9 88                        cmp     #$88              ;BACK SPACE? (CONTROL-H)
FC0E: D0 C9                        bne     <a href="#SymCHKBELL">CHKBELL</a>           ; NO, CHECK FOR BELL.
FC10: 20 E2 FE                     jsr     <a href="#SymDECCH">DECCH</a>             ;decrement all cursor H indices
FC13: 10 E7                        bpl     <a href="#SymRTS3">RTS3</a>              ;IF POSITIVE, OK; ELSE MOVE UP.
FC15: A5 21                        lda     <a href="#SymWNDWDTH">WNDWDTH</a>           ;get window width,
FC17: 20 EB FE                     jsr     <a href="#SymWDTHCH">WDTHCH</a>            ;and set CH's to WNDWDTH-1
FC1A: A5 22        <span id="SymUP">UP</span>              lda     <a href="#SymWNDTOP">WNDTOP</a>            ;CURSOR V INDEX
FC1C: C5 25                        cmp     <a href="#SymCV">CV</a>
FC1E: B0 DC                        bcs     <a href="#SymRTS3">RTS3</a>              ;top line, exit
FC20: C6 25                        dec     <a href="#SymCV">CV</a>                ;not top, go up one
FC22: 80 62        <span id="SymVTAB">VTAB</span>            bra     <a href="#SymNEWVTAB">NEWVTAB</a>           ;go update OURCV

FC24: 20 C1 FB     <span id="SymVTABZ">VTABZ</span>           jsr     <a href="#SymBASCALC">BASCALC</a>           ;calculate the base address
FC27: A5 20                        lda     <a href="#SymWNDLFT">WNDLFT</a>            ;get the left window edge
FC29: 2C 1F C0                     bit     <a href="#SymRD80VID">RD80VID</a>           ;80 columns?
FC2C: 10 02                        bpl     <a href="#SymVTAB40">VTAB40</a>            ;=&gt;no, left edge ok
FC2E: 4A                           lsr     A                 ;divdie width by 2
FC2F: 18                           clc                       ;prepare to add
FC30: 65 28        <span id="SymVTAB40">VTAB40</span>          adc     <a href="#SymBASL">BASL</a>              ;add width to base
FC32: 85 28                        sta     <a href="#SymBASL">BASL</a>
FC34: 60           <span id="SymRTS4">RTS4</span>            rts

                   ; NEWOPS translates the opcode in the Y register
                   ; to a mnemonic table index and returns with Z=1.
                   ; If Y is not a new opcode, Z=0.
                   ; 
FC35: 98           <span id="SymNEWOPS">NEWOPS</span>          tya                       ;get the opcode
FC36: A2 16                        ldx     #<a href="#SymNUMOPS">NUMOPS</a>           ;check through new opcodes
FC38: DD FE FE     <span id="SymNEWOP1">NEWOP1</span>          cmp     <a href="#SymOPTBL">OPTBL</a>,X           ;does it match?
FC3B: F0 43                        beq     <a href="#SymGETINDX">GETINDX</a>           ;=&gt;yes, get new index
FC3D: CA                           dex
FC3E: 10 F8                        bpl     <a href="#SymNEWOP1">NEWOP1</a>            ;else check next one
FC40: 60                           rts                       ;not found, exit with BNE

FC41: FF                           nop
FC42: 80 19        <span id="SymCLREOP">CLREOP</span>          bra     <a href="#SymCLREOP1">CLREOP1</a>           ;ESC F IS CLR TO END OF PAGE

FC44: A5 25        <span id="SymCLREOP2">CLREOP2</span>         lda     <a href="#SymCV">CV</a>
FC46: 48           <span id="SymCLEOP1">CLEOP1</span>          pha                       ;SAVE CURRENT LINE NO. ON STACK
FC47: 20 24 FC                     jsr     <a href="#SymVTABZ">VTABZ</a>             ;CALC BASE ADDRESS
FC4A: 20 9E FC                     jsr     <a href="#SymCLEOLZ">CLEOLZ</a>            ;CLEAR TO EOL. (SETS CARRY)
FC4D: A0 00                        ldy     #$00              ;CLEAR FROM H INDEX=0 FOR REST
FC4F: 68                           pla                       ;INCREMENT CURRENT LINE NO.
FC50: 1A                           inc     A
FC51: C5 23                        cmp     <a href="#SymWNDBTM">WNDBTM</a>            ;DONE TO BOTTOM OF WINDOW?
FC53: 90 F1                        bcc     <a href="#SymCLEOP1">CLEOP1</a>            ; NO, KEEP CLEARING LINES.
FC55: B0 CB                        bcs     <a href="#SymVTAB">VTAB</a>              ; YES, TAB TO CURRENT LINE

FC57: FF                           DFB     $FF

FC58: 20 A5 CD     <span id="SymHOME">HOME</span>            jsr     <a href="#SymHOMECUR">HOMECUR</a>           ;move cursor home
FC5B: 80 E7                        bra     <a href="#SymCLREOP2">CLREOP2</a>           ;then clear to end of page

FC5D: 20 9D CC     <span id="SymCLREOP1">CLREOP1</span>         jsr     <a href="#SymGETCUR">GETCUR</a>            ;load Y with proper CH
FC60: 80 E2                        bra     <a href="#SymCLREOP2">CLREOP2</a>           ;before clearing page

FC62: 80 0F        <span id="SymCR">CR</span>              bra     <a href="#SymNEWCR">NEWCR</a>             ;only LF if not Pascal

FC64: FF                           DFB     $FF
FC65: FF                           DFB     $FF

FC66: E6 25        <span id="SymLF">LF</span>              inc     <a href="#SymCV">CV</a>                ;INCR CURSOR V. (DOWN 1 LINE)
FC68: A5 25                        lda     <a href="#SymCV">CV</a>
FC6A: C5 23                        cmp     <a href="#SymWNDBTM">WNDBTM</a>            ;OFF SCREEN?
FC6C: 90 1A                        bcc     <a href="#SymNEWVTABZ">NEWVTABZ</a>          ;set base+WNDLFT
FC6E: C6 25                        dec     <a href="#SymCV">CV</a>                ;DECR CURSOR V. (BACK TO BOTTOM)
FC70: 4C 35 CB     <span id="SymSCROLL">SCROLL</span>          jmp     <a href="#SymSCROLLUP">SCROLLUP</a>          ;scroll the screen

FC73: 20 E9 FE     <span id="SymNEWCR">NEWCR</span>           jsr     <a href="#SymCLRCH">CLRCH</a>             ;set CH's to 0
FC76: 2C FB 04                     bit     <a href="#SymVMODE">VMODE</a>             ;is it Pascal?
FC79: 10 0A                        bpl     <a href="#SymCRRTS">CRRTS</a>             ;pascal, no LF
FC7B: 20 44 FD                     jsr     <a href="#SymNOESCAPE">NOESCAPE</a>          ;else clear escape mode
FC7E: 80 E6                        bra     <a href="#SymLF">LF</a>                ;tend do LF

FC80: BD 15 FF     <span id="SymGETINDX">GETINDX</span>         lda     <a href="#SymINDX">INDX</a>,X            ;lookup index for mnemonic
FC83: A0 00                        ldy     #0                ;exit with BEQ
FC85: 60           <span id="SymCRRTS">CRRTS</span>           rts

FC86: A5 25        <span id="SymNEWVTAB">NEWVTAB</span>         lda     <a href="#SymCV">CV</a>                ;update //e CV
FC88: 8D FB 05     <span id="SymNEWVTABZ">NEWVTABZ</span>        sta     <a href="#SymOURCV">OURCV</a>
FC8B: 80 97                        bra     <a href="#SymVTABZ">VTABZ</a>             ;and calc base+WNDLFT

FC8D: 20 9D CC     <span id="SymNEWCLREOL">NEWCLREOL</span>       jsr     <a href="#SymGETCUR">GETCUR</a>            ;get current cursor
FC90: A9 A0        <span id="SymNEWCLEOLZ">NEWCLEOLZ</span>       lda     #$A0              ;get a blank
FC92: 2C 7B 06                     bit     <a href="#SymVFACTV">VFACTV</a>            ;if video firmware active,
FC95: 30 02                        bmi     <a href="#SymNEWC1">NEWC1</a>             ;=&gt;don't use inverse mask
FC97: 25 32                        and     <a href="#SymINVFLG">INVFLG</a>
FC99: 4C C2 CB     <span id="SymNEWC1">NEWC1</span>           jmp     <a href="#SymDOCLR">DOCLR</a>             ;go do clear

FC9C: 80 EF        <span id="SymCLREOL">CLREOL</span>          bra     <a href="#SymNEWCLREOL">NEWCLREOL</a>         ;get cursor and clear

FC9E: 80 F0        <span id="SymCLEOLZ">CLEOLZ</span>          bra     <a href="#SymNEWCLEOLZ">NEWCLEOLZ</a>         ;clear from Y

FCA0: A0 00        <span id="SymCLRLIN">CLRLIN</span>          ldy     #0                ;clear entire line
FCA2: 80 EC                        bra     <a href="#SymNEWCLEOLZ">NEWCLEOLZ</a>

FCA4: 7C 2A CD     <span id="SymCTLDO">CTLDO</span>           jmp     (<a href="#SymCTLADR">CTLADR</a>,X)        ;jump to proper routine

FCA7: EA                           nop
FCA8: 38           <span id="SymWAIT">WAIT</span>            sec
FCA9: 48           <span id="SymWAIT2">WAIT2</span>           pha
FCAA: E9 01        <span id="SymWAIT3">WAIT3</span>           sbc     #$01
FCAC: D0 FC                        bne     <a href="#SymWAIT3">WAIT3</a>             ;1.0204 usec
FCAE: 68                           pla                       ;(13+2712*A+512*A*A)
FCAF: E9 01                        sbc     #$01
FCB1: D0 F6                        bne     <a href="#SymWAIT2">WAIT2</a>
FCB3: 60           <span id="SymRTS6">RTS6</span>            rts

FCB4: E6 42        <span id="SymNXTA4">NXTA4</span>           inc     <a href="#SymA4L">A4L</a>               ;INCR 2-BYTE A4
FCB6: D0 02                        bne     <a href="#SymNXTA1">NXTA1</a>             ; AND A1
FCB8: E6 43                        inc     <a href="#SymA4H">A4H</a>
FCBA: A5 3C        <span id="SymNXTA1">NXTA1</span>           lda     <a href="#SymA1L">A1L</a>               ;INCR 2-BYTE A1.
FCBC: C5 3E                        cmp     <a href="#SymA2L">A2L</a>               ; AND COMPARE TO A2
FCBE: A5 3D                        lda     <a href="#SymA1H">A1H</a>               ; (CARRY SET IF &gt;=)
FCC0: E5 3F                        sbc     <a href="#SymA2H">A2H</a>
FCC2: E6 3C                        inc     <a href="#SymA1L">A1L</a>
FCC4: D0 02                        bne     <a href="#SymRTS4B">RTS4B</a>
FCC6: E6 3D                        inc     <a href="#SymA1H">A1H</a>
FCC8: 60           <span id="SymRTS4B">RTS4B</span>           rts

FCC9: 60           <span id="SymHEADR">HEADR</span>           rts                       ;don't do it

FCCA: A0 B0        <span id="SymCOLDSTART">COLDSTART</span>       ldy     #$B0              ;let it precess down
FCCC: 64 3C                        stz     <a href="#SymA1L">A1L</a>
FCCE: A2 BF                        ldx     #$BF              ;start from BFXX down
FCD0: 86 3D        <span id="SymBLAST">BLAST</span>           stx     <a href="#SymA1H">A1H</a>
FCD2: A9 A0                        lda     #$A0              ;store blanks
FCD4: 91 3C                        sta     (<a href="#SymA1L">A1L</a>),Y
FCD6: 88                           dey
FCD7: 91 3C                        sta     (<a href="#SymA1L">A1L</a>),Y
FCD9: CA                           dex                       ;back down to next page
FCDA: E0 01                        cpx     #1                ;stay away from stack
FCDC: D0 F2                        bne     <a href="#SymBLAST">BLAST</a>             ;fall into COMINIT
                   ; 
FCDE: 8D 01 C0                     sta     <a href="#SymSET80COL">SET80COL</a>          ;init ALT screen holes
FCE1: AD 55 C0                     lda     <a href="#SymTXTPAGE2">TXTPAGE2</a>          ;for serial and comm ports
FCE4: A2 88                        ldx     #$88              ;C = 1 from CPX #1
FCE6: BD 8B CF     <span id="SymCOM1">COM1</span>            lda     <a href="#Symcomtbl">comtbl</a>-1,X        ;XFER from rom
FCE9: 90 0A                        bcc     <a href="#SymCOM2">COM2</a>              ;branch if defaults ok
FCEB: DD 77 04                     cmp     $0477,X           ;test for prior setup
FCEE: 18                           clc                       ;branch if not valid
FCEF: D0 04                        bne     <a href="#SymCOM2">COM2</a>              ;If $4F8 &amp; $4FF = TBL values
FCF1: E0 82                        cpx     #$82
FCF3: 90 06                        bcc     <a href="#SymCOM3">COM3</a>
FCF5: 9D 77 04     <span id="SymCOM2">COM2</span>            sta     $0477,X
FCF8: CA                           dex                       ;mvoe all 8...
FCF9: D0 EB                        bne     <a href="#SymCOM1">COM1</a>
FCFB: AD 54 C0     <span id="SymCOM3">COM3</span>            lda     <a href="#SymTXTPAGE1">TXTPAGE1</a>          ;restore switches
FCFE: 8D 00 C0                     sta     <a href="#SymCLR80COL">CLR80COL</a>          ;to default states
FD01: 60                           rts

FD02: F1                           DFB     $F1               ;+
FD03: FF FF FF FF+                 DS      5,$FF
FD08: BF FE FE FE                  ASC     “?~~~”

FD0C: A4 24        <span id="SymRDKEY">RDKEY</span>           ldy     <a href="#SymCH">CH</a>                ;get char at current position
FD0E: B1 28                        lda     (<a href="#SymBASL">BASL</a>),Y          ;for those who restore it
FD10: EA                           nop                       ;if a program controls input
FD11: EA                           nop                       ;hooks, no cursor may be displayed
FD12: EA                           nop
FD13: EA                           nop
FD14: EA                           nop
FD15: EA                           nop
FD16: EA                           nop
FD17: EA                           nop
FD18: 6C 38 00     <span id="SymKEYIN0">KEYIN0</span>          jmp     (<a href="#SymKSWL">KSWL</a>)            ;GO TO USER KEY-IN

FD1B: 91 28        <span id="SymKEYIN">KEYIN</span>           sta     (<a href="#SymBASL">BASL</a>),Y          ;erase false images
FD1D: 20 4C CC                     jsr     <a href="#Symshowcur">showcur</a>           ;display true cursor
FD20: 20 70 CC     <span id="SymDONXTCUR">DONXTCUR</span>        jsr     <a href="#Symupdate">update</a>            ;look for key, blink II cursor
FD23: 10 FB                        bpl     <a href="#SymDONXTCUR">DONXTCUR</a>          ;loop until keypress
FD25: 48           <span id="SymGOTKEY">GOTKEY</span>          pha                       ;save character
FD26: A9 08                        lda     #<a href="#SymM_CTL">M_CTL</a>            ;were escapes enabled?
FD28: 2C FB 04                     bit     <a href="#SymVMODE">VMODE</a>
FD2B: D0 1D                        bne     <a href="#SymNOESC2">NOESC2</a>            ;=&gt;no, there is no escape
FD2D: 68                           pla                       ;yes, there may be a way out!!
FD2E: C9 9B                        cmp     #<a href="#SymESC">ESC</a>              ;escape?
FD30: D0 06                        bne     <a href="#SymLOOKPICK">LOOKPICK</a>          ;=&gt;no escape
FD32: 4C CC CC                     jmp     <a href="#SymNEWESC">NEWESC</a>            ;=&gt;go do escape sequence

FD35: 4C ED CC     <span id="SymRDCHAR">RDCHAR</span>          jmp     <a href="#SymESCRDKEY">ESCRDKEY</a>          ;do RDKEY with escape

FD38: 2C 7B 06     <span id="SymLOOKPICK">LOOKPICK</span>        bit     <a href="#SymVFACTV">VFACTV</a>            ;only process f_arrow
FD3B: 30 07                        bmi     <a href="#SymNOESCAPE">NOESCAPE</a>          ;if video firmware is active
FD3D: C9 95                        cmp     #<a href="#SymPICK">PICK</a>             ;was it PICK? (-&gt;,CTL-U)
FD3F: D0 03                        bne     <a href="#SymNOESCAPE">NOESCAPE</a>          ;no, just return
FD41: 20 1D CC                     jsr     <a href="#SymPICKY">PICKY</a>             ;yes, pick the character
                   ; 
                   ; NOESCAPE is used by GETCOUT too.
                   ; 
FD44: 48           <span id="SymNOESCAPE">NOESCAPE</span>        pha                       ;save it
FD45: A9 08        <span id="SymNOESC1">NOESC1</span>          lda     #<a href="#SymM_CTL">M_CTL</a>            ;disable escape sequences
FD47: 0C FB 04                     tsb     <a href="#SymVMODE">VMODE</a>             ;and enable controls
FD4A: 68           <span id="SymNOESC2">NOESC2</span>          pla                       ;by setting M_CTL
FD4B: 60                           rts

FD4C: FE                           DFB     $FE

FD4D: 20 A6 C3     <span id="SymNOTCR">NOTCR</span>           jsr     <a href="#SymGETCOUT">GETCOUT</a>           ;disable controls and print
FD50: C9 88                        cmp     #$88              ;CHECK FOR EDIT KEYS
FD52: F0 1D                        beq     <a href="#SymBCKSPC">BCKSPC</a>            ;  - BACKSPACE
FD54: C9 98                        cmp     #$98
FD56: F0 0A                        beq     <a href="#SymCANCEL">CANCEL</a>            ;  - CONTROL-X
FD58: E0 F8                        cpx     #$F8
FD5A: 90 03                        bcc     <a href="#SymNOTCR1">NOTCR1</a>            ;MARGIN?
FD5C: 20 3A FF                     jsr     <a href="#SymBELL">BELL</a>              ; YES, SOUND BELL
FD5F: E8           <span id="SymNOTCR1">NOTCR1</span>          inx                       ;ADVANCE INPUT INDEX
FD60: D0 13                        bne     <a href="#SymNXTCHAR">NXTCHAR</a>
FD62: A9 DC        <span id="SymCANCEL">CANCEL</span>          lda     #$DC              ;BACKSLASH AFTER CANCELLED LINE
FD64: 20 A6 C3                     jsr     <a href="#SymGETCOUT">GETCOUT</a>
FD67: 20 8E FD     <span id="SymGETLNZ">GETLNZ</span>          jsr     <a href="#SymCROUT">CROUT</a>             ;OUTPUT 'CR'
FD6A: A5 33        <span id="SymGETLN">GETLN</span>           lda     <a href="#SymPROMPT">PROMPT</a>            ;OUTPUT PROMPT CHAR
FD6C: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FD6F: A2 01        <span id="SymGETLN1">GETLN1</span>          ldx     #$01              ;INIT INPUT INDEX
FD71: 8A           <span id="SymBCKSPC">BCKSPC</span>          txa
FD72: F0 F3                        beq     <a href="#SymGETLNZ">GETLNZ</a>            ;WILL BACKSPACE TO 0
FD74: CA                           dex
FD75: 20 ED CC     <span id="SymNXTCHAR">NXTCHAR</span>         jsr     <a href="#SymESCRDKEY">ESCRDKEY</a>          ;do new RDCHAR (allow escapes)
FD78: C9 95                        cmp     #<a href="#SymPICK">PICK</a>             ;USE SCREEN CHAR\
FD7A: D0 08                        bne     <a href="#SymADDINP">ADDINP</a>            ; FOR CONTROL-U
FD7C: 20 1D CC                     jsr     <a href="#SymPICKY">PICKY</a>             ;lift char from screen
FD7F: EA                           nop
FD80: EA                           nop
FD81: EA                           nop                       ;no upshifting needed
FD82: EA                           nop
FD83: EA                           nop
FD84: 9D 00 02     <span id="SymADDINP">ADDINP</span>          sta     <a href="#SymIN">IN</a>,X              ;ADD TO INPUT BUFFER
FD87: C9 8D                        cmp     #$8D
FD89: D0 C2                        bne     <a href="#SymNOTCR">NOTCR</a>
FD8B: 20 9C FC     <span id="SymCROUT1">CROUT1</span>          jsr     <a href="#SymCLREOL">CLREOL</a>            ;CLR TO EOL IF CR
FD8E: A9 8D        <span id="SymCROUT">CROUT</span>           lda     #$8D
FD90: D0 5B                        bne     <a href="#Symcout">cout</a>              ;(ALWAYS)

                   ; 
FD92: A4 3D        <span id="SymPRA1">PRA1</span>            ldy     <a href="#SymA1H">A1H</a>               ;PRINT CR,A1 IN HEX
FD94: A6 3C                        ldx     <a href="#SymA1L">A1L</a>
FD96: 20 8E FD     <span id="SymPRYX2">PRYX2</span>           jsr     <a href="#SymCROUT">CROUT</a>
FD99: 20 40 F9                     jsr     <a href="#SymPRNTYX">PRNTYX</a>
FD9C: A0 00                        ldy     #$00
FD9E: A9 AD                        lda     #$AD              ;PRINT "-"
FDA0: 4C ED FD                     jmp     <a href="#Symcout">cout</a>

FDA3: A5 3C        <span id="SymXAM8">XAM8</span>            lda     <a href="#SymA1L">A1L</a>
FDA5: 09 07                        ora     #$07              ;SET TO FINISH AT
FDA7: 85 3E                        sta     <a href="#SymA2L">A2L</a>               ; MOD 8=7
FDA9: A5 3D                        lda     <a href="#SymA1H">A1H</a>
FDAB: 85 3F                        sta     <a href="#SymA2H">A2H</a>
FDAD: A5 3C        <span id="SymMOD8CHK">MOD8CHK</span>         lda     <a href="#SymA1L">A1L</a>
FDAF: 29 07                        and     #$07
FDB1: D0 03                        bne     <a href="#SymDATAOUT">DATAOUT</a>
FDB3: 20 92 FD     <span id="SymXAM">XAM</span>             jsr     <a href="#SymPRA1">PRA1</a>
FDB6: A9 A0        <span id="SymDATAOUT">DATAOUT</span>         lda     #$A0
FDB8: 20 ED FD                     jsr     <a href="#Symcout">cout</a>              ;OUTPUT BLANK
FDBB: B1 3C                        lda     (<a href="#SymA1L">A1L</a>),Y
FDBD: 20 DA FD                     jsr     <a href="#SymPRBYTE">PRBYTE</a>            ;OUTPUT BYTE IN HEX
FDC0: 20 BA FC                     jsr     <a href="#SymNXTA1">NXTA1</a>
FDC3: 90 E8                        bcc     <a href="#SymMOD8CHK">MOD8CHK</a>           ;NOT DONE YET. GO CHECK MOD 8
FDC5: 60           <span id="SymRTS4C">RTS4C</span>           rts                       ;DONE.

FDC6: 4A           <span id="SymXAMPM">XAMPM</span>           lsr     A                 ;DETERMINE IF MONITOR MOD IS
FDC7: 90 EA                        bcc     <a href="#SymXAM">XAM</a>               ; EXAMINE, ADD OR SUBTRACT
FDC9: 4A                           lsr     A
FDCA: 4A                           lsr     A
FDCB: A5 3E                        lda     <a href="#SymA2L">A2L</a>
FDCD: 90 02                        bcc     <a href="#SymADD">ADD</a>
FDCF: 49 FF                        eor     #$FF              ;FORM 2'S COMPLEMENT FOR SUBTRACT.
FDD1: 65 3C        <span id="SymADD">ADD</span>             adc     <a href="#SymA1L">A1L</a>
FDD3: 48                           pha
FDD4: A9 BD                        lda     #$BD              ;PRINT '=', THEN RESULT
FDD6: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FDD9: 68                           pla
                   ; 
FDDA: 48           <span id="SymPRBYTE">PRBYTE</span>          pha                       ;PRINT BYTE AS 2 HEX DIGITA
FDDB: 4A                           lsr     A                 ; (DESTROYS A-REG)
FDDC: 4A                           lsr     A
FDDD: 4A                           lsr     A
FDDE: 4A                           lsr     A
FDDF: 20 E5 FD                     jsr     <a href="#SymPRHEXZ">PRHEXZ</a>
FDE2: 68                           pla
                   ; 
FDE3: 29 0F        <span id="SymPRHEX">PRHEX</span>           and     #$0F              ;PRINT HEX DIGIT IN A-REG
FDE5: 09 B0        <span id="SymPRHEXZ">PRHEXZ</span>          ora     #$B0              ;LSBITS ONLY.
FDE7: C9 BA                        cmp     #$BA
FDE9: 90 02                        bcc     <a href="#Symcout">cout</a>
FDEB: 69 06                        adc     #$06
                   ; 
FDED: 6C 36 00     <span id="Symcout">cout</span>            jmp     (<a href="#SymCSWL">CSWL</a>)            ;VECTOR TO USER OUTPUT ROUTINE

FDF0: 2C 7B 06     <span id="Symcout1">cout1</span>           bit     <a href="#SymVFACTV">VFACTV</a>            ;video firmware active?
FDF3: 4C B4 FB                     jmp     <a href="#SymDOCOUT1">DOCOUT1</a>           ;mask II mode characters

FDF6: 84 35        <span id="SymCOUTZ">COUTZ</span>           sty     <a href="#SymYSAV1">YSAV1</a>             ;SAVE Y-REG
FDF8: 48                           pha                       ;SAVE A -REG
FDF9: 20 78 FB                     jsr     <a href="#SymVIDWAIT">VIDWAIT</a>           ;OUTPUT CHR AND CHECK FOR CTRL-S
FDFC: 68                           pla                       ;RESTORE A-REG
FDFD: A4 35                        ldy     <a href="#SymYSAV1">YSAV1</a>             ;AND Y-REG
FDFF: 60                           rts                       ;RETURN TO SENDER...

FE00: C6 34        <span id="SymBL1">BL1</span>             dec     <a href="#SymYSAV">YSAV</a>
FE02: F0 9F                        beq     <a href="#SymXAM8">XAM8</a>
                   ; 
FE04: CA           <span id="SymBLANK">BLANK</span>           dex                       ;BLANK TO MON
FE05: D0 16                        bne     <a href="#SymSETMDZ">SETMDZ</a>            ;AFTER BLANK
FE07: C9 BA                        cmp     #$BA              ;DATA STORE MODE?
FE09: D0 BB                        bne     <a href="#SymXAMPM">XAMPM</a>             ; NO; XAM, ADD, OR SUBTRACT.
                   ; 
FE0B: 85 31        <span id="SymSTOR">STOR</span>            sta     <a href="#SymMODE">MODE</a>              ;KEEP IN STORE MODE
FE0D: A5 3E                        lda     <a href="#SymA2L">A2L</a>
FE0F: 91 40                        sta     (<a href="#SymA3L">A3L</a>),Y           ;STORE AS LOW BYTE AT (A3)
FE11: E6 40                        inc     <a href="#SymA3L">A3L</a>
FE13: D0 02                        bne     <a href="#SymRTS5">RTS5</a>              ;INCR A3, RETURN.
FE15: E6 41                        inc     <a href="#SymA3H">A3H</a>
FE17: 60           <span id="SymRTS5">RTS5</span>            rts

FE18: A4 34        <span id="SymSETMODE">SETMODE</span>         ldy     <a href="#SymYSAV">YSAV</a>              ;SAVE CONVERTED ':', '+',
FE1A: B9 FF 01                     lda     <a href="#SymIN">IN</a>-1,Y            ; '-', '.' AS MODE
FE1D: 85 31        <span id="SymSETMDZ">SETMDZ</span>          sta     <a href="#SymMODE">MODE</a>
FE1F: 60                           rts

FE20: A2 01        <span id="SymLT">LT</span>              ldx     #$01
FE22: B5 3E        <span id="SymLT2">LT2</span>             lda     <a href="#SymA2L">A2L</a>,X             ;COPY A2 (2 BYTES) TO
FE24: 95 42                        sta     <a href="#SymA4L">A4L</a>,X             ; A4 AND A5
FE26: 95 44                        sta     <a href="#SymA5L">A5L</a>,X
FE28: CA                           dex
FE29: 10 F7                        bpl     <a href="#SymLT2">LT2</a>
FE2B: 60                           rts

FE2C: B1 3C        <span id="SymMOVE">MOVE</span>            lda     (<a href="#SymA1L">A1L</a>),Y           ;MOVE (A) THRU (A2) TO (A4)
FE2E: 91 42                        sta     (<a href="#SymA4L">A4L</a>),Y
FE30: 20 B4 FC                     jsr     <a href="#SymNXTA4">NXTA4</a>
FE33: 90 F7                        bcc     <a href="#SymMOVE">MOVE</a>
FE35: 60                           rts

FE36: B1 3C        <span id="SymVERIFY">VERIFY</span>          lda     (<a href="#SymA1L">A1L</a>),Y           ;VERIFY (A1) THRU (A2)
FE38: D1 42                        cmp     (<a href="#SymA4L">A4L</a>),Y           ; WITH (A4)
FE3A: F0 1C                        beq     <a href="#SymVFYOK">VFYOK</a>
FE3C: 20 92 FD                     jsr     <a href="#SymPRA1">PRA1</a>
FE3F: B1 3C                        lda     (<a href="#SymA1L">A1L</a>),Y
FE41: 20 DA FD                     jsr     <a href="#SymPRBYTE">PRBYTE</a>
FE44: A9 A0                        lda     #$A0
FE46: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FE49: A9 A8                        lda     #$A8
FE4B: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FE4E: B1 42                        lda     (<a href="#SymA4L">A4L</a>),Y
FE50: 20 DA FD                     jsr     <a href="#SymPRBYTE">PRBYTE</a>
FE53: A9 A9                        lda     #$A9
FE55: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FE58: 20 B4 FC     <span id="SymVFYOK">VFYOK</span>           jsr     <a href="#SymNXTA4">NXTA4</a>
FE5B: 90 D9                        bcc     <a href="#SymVERIFY">VERIFY</a>
FE5D: 60                           rts

FE5E: 20 75 FE     <span id="SymLIST">LIST</span>            jsr     <a href="#Syma1pc">a1pc</a>              ;MOVE A1 (2 BYTES) TO
FE61: A9 14                        lda     #$14              ; PC IF SPEC'D AND
FE63: 48           <span id="SymLIST2">LIST2</span>           pha                       ;+DISASSEMBLE 20 INSTRUCTIONS.
FE64: 20 C4 C5                     jsr     <a href="#Symshowinst">showinst</a>          ;+Display a line
FE67: 68                           pla
FE68: 3A                           dec     A                 ;+Count down
FE69: D0 F8                        bne     <a href="#SymLIST2">LIST2</a>
FE6B: 60                           rts

FE6C: 4C 86 C9     <span id="SymMINI">MINI</span>            jmp     <a href="#SymGETINST1">GETINST1</a>          ;+Go to the mini assembler

FE6F: C6 34        <span id="SymTRACE">TRACE</span>           dec     <a href="#SymYSAV">YSAV</a>              ;+Stay on T for trace
FE71: 4C 43 CA     <span id="SymSTEPZ">STEPZ</span>           jmp     <a href="#Symstep">step</a>              ;+Off to the step routine

FE74: 00                           DFB     $00               ;+Extra bytes

FE75: 8A           <span id="Syma1pc">a1pc</span>            txa                       ;IF USER SPECIFIED AN ADDRESS,
FE76: F0 07                        beq     <a href="#SymA1PCRTS">A1PCRTS</a>           ; COPY IT FROM A1 TO PC.
FE78: B5 3C        <span id="SymA1PCLP">A1PCLP</span>          lda     <a href="#SymA1L">A1L</a>,X             ;YEP, SO COPY IT.
FE7A: 95 3A                        sta     <a href="#SymPCL">PCL</a>,X
FE7C: CA                           dex
FE7D: 10 F9                        bpl     <a href="#SymA1PCLP">A1PCLP</a>
FE7F: 60           <span id="SymA1PCRTS">A1PCRTS</span>         rts

FE80: A0 3F        <span id="SymSETINV">SETINV</span>          ldy     #$3F              ;SET FOR INVERSE VID
FE82: D0 02                        bne     <a href="#SymSETIFLG">SETIFLG</a>           ; VIA COUT1

FE84: A0 FF        <span id="SymSETNORM">SETNORM</span>         ldy     #$FF              ;SET FOR NORMAL VID
FE86: 84 32        <span id="SymSETIFLG">SETIFLG</span>         sty     <a href="#SymINVFLG">INVFLG</a>
FE88: 60                           rts

FE89: A9 00        <span id="SymSETKBD">SETKBD</span>          lda     #$00              ;DO 'IN#0'
FE8B: 85 3E        <span id="SymINPORT">INPORT</span>          sta     <a href="#SymA2L">A2L</a>               ;DO 'IN#AGREG'
FE8D: A2 38        <span id="SymINPRT">INPRT</span>           ldx     #<a href="#SymKSWL">KSWL</a>
FE8F: A0 1B                        ldy     #&lt;<a href="#SymKEYIN">KEYIN</a>
FE91: D0 08                        bne     <a href="#SymIOPRT">IOPRT</a>

FE93: A9 00        <span id="SymSETVID">SETVID</span>          lda     #$00              ;DO 'PR#0'
FE95: 85 3E        <span id="SymOUTPORT">OUTPORT</span>         sta     <a href="#SymA2L">A2L</a>               ;DO 'PR#AREG'
FE97: A2 36        <span id="SymOUTPRT">OUTPRT</span>          ldx     #<a href="#SymCSWL">CSWL</a>
FE99: A0 F0                        ldy     #&lt;<a href="#Symcout1">cout1</a>
FE9B: A5 3E        <span id="SymIOPRT">IOPRT</span>           lda     <a href="#SymA2L">A2L</a>
FE9D: 29 0F                        and     #$0F
FE9F: D0 06                        bne     <a href="#SymNOTPRT0">NOTPRT0</a>           ;not slot 0
FEA1: C0 1B                        cpy     #&lt;<a href="#SymKEYIN">KEYIN</a>           ;Conintue if KEYIN
FEA3: F0 39                        beq     <a href="#SymIOPRT1">IOPRT1</a>
FEA5: 80 1B                        bra     <a href="#SymOPRT0">OPRT0</a>             ;=&gt;do PR#0

FEA7: 09 C0        <span id="SymNOTPRT0">NOTPRT0</span>         ora     #&lt;<a href="#SymIOADR">IOADR</a>-64
FEA9: A0 00                        ldy     #$00
FEAB: 94 00        <span id="SymIOPRT2">IOPRT2</span>          sty     <a href="#SymLOC0">LOC0</a>,X
FEAD: 95 01                        sta     <a href="#SymLOC1">LOC1</a>,X
FEAF: 60                           rts

FEB0: 4C 00 E0     <span id="SymXBASIC">XBASIC</span>          jmp     <a href="#SymBASIC">BASIC</a>             ;TO BASIC, COLD START

FEB3: 4C 03 E0     <span id="SymBASCONT">BASCONT</span>         jmp     <a href="#SymBASIC2">BASIC2</a>            ;TO BASIC, WARM START

FEB6: 20 75 FE     <span id="SymGO">GO</span>              jsr     <a href="#Syma1pc">a1pc</a>              ;ADDR TO PC IF SPECIFIED
FEB9: 20 3F FF                     jsr     <a href="#SymRESTORE">RESTORE</a>           ;RESTORE FAKE REGISTERS
FEBC: 6C 3A 00                     jmp     (<a href="#SymPCL">PCL</a>)             ; AND GO!

FEBF: 4C D7 FA     <span id="SymREGZ">REGZ</span>            jmp     <a href="#SymREGDSP">REGDSP</a>            ;GO DISPLAY REGISTERS

FEC2: 3A           <span id="SymOPRT0">OPRT0</span>           dec     A                 ;Need $FF
FEC3: 8D FB 07                     sta     <a href="#SymCURSOR">CURSOR</a>            ;set checkerboard cursor
                   NOTE: $FF-M_CTL
FEC6: A9 F7                        lda     #$F7              ;reset mode
FEC8: 80 04                        bra     <a href="#SymDOPR0">DOPR0</a>

FECA: 4C F8 03     <span id="SymUSR">USR</span>             jmp     <a href="#SymUSRADR">USRADR</a>            ;JUMP TO CONTROL-Y VECTOR IN RAM

FECD: 60           <span id="SymWRITE">WRITE</span>           rts                       ;Tape write not needed

FECE: 8D 7B 06     <span id="SymDOPR0">DOPR0</span>           sta     <a href="#SymVFACTV">VFACTV</a>            ;say video firmware inactive
FED1: 8D 0E C0                     sta     <a href="#SymCLRALTCHAR">CLRALTCHAR</a>        ;switch in normal char set
FED4: 0C FB 04                     tsb     <a href="#SymVMODE">VMODE</a>             ;don't change M_CTL
FED7: DA                           phx                       ;save X and Y
FED8: 5A                           phy                       ;for rest of PR#0
FED9: 20 CD CD                     jsr     <a href="#SymCHK80">CHK80</a>             ;convert to 40 if needed
FEDC: 7A                           ply
FEDD: FA                           plx
FEDE: A9 FD        <span id="SymIOPRT1">IOPRT1</span>          lda     #&gt;<a href="#Symcout1">cout1</a>           ;set I/O page
FEE0: 80 C9                        bra     <a href="#SymIOPRT2">IOPRT2</a>            ;=&gt;go set output hook

                   ; 
                   ; DECCH decrements the current cursor
                   ; CLRCH sets all cursors to 0
                   ; SETCUR sets cursors to value in Acc.
                   ; See explanatory note with GETCUR
                   ; 
FEE2: 5A           <span id="SymDECCH">DECCH</span>           phy                       ;(from $FC10)
FEE3: 20 9D CC                     jsr     <a href="#SymGETCUR">GETCUR</a>            ;get current CH
FEE6: 88                           dey                       ;decrement it
FEE7: 80 05                        bra     <a href="#SymSETCUR1">SETCUR1</a>           ;go update cursors

FEE9: A9 01        <span id="SymCLRCH">CLRCH</span>           lda     #1                ;set all cursors to 0
FEEB: 3A           <span id="SymWDTHCH">WDTHCH</span>          dec     A                 ;dec window width (from $FC17)
FEEC: 5A           <span id="SymSETCUR">SETCUR</span>          phy                       ;save Y
FEED: A8                           tay                       ;need value in Y
FEEE: 20 AD CC     <span id="SymSETCUR1">SETCUR1</span>         jsr     <a href="#SymGETCUR2">GETCUR2</a>           ;save new CH
FEF1: 7A                           ply                       ;restore Y
FEF2: AD 7B 05                     lda     <a href="#SymOURCH">OURCH</a>             ;and get new CH into acc
FEF5: 60                           rts                       ;(Need LDA to set flags)

FEF6: 20 00 FE     <span id="SymCRMON">CRMON</span>           jsr     <a href="#SymBL1">BL1</a>               ;HANDLE CR AS BLANK
FEF9: 68                           pla                       ; THEN POP STACK
FEFA: 68                           pla                       ;AND RETURN TO MON
FEFB: D0 6C                        bne     <a href="#SymMONZ">MONZ</a>              ;(ALWAYS)
                   ; 
FEFD: 60           <span id="SymREAD">READ</span>            rts                       ;Tape read not needed

                   ; 
                   ; OPTBL is a table containing the new opcodes that
                   ; wouldn't fit into the existing lookup table.
                   ; 
FEFE: 12           <span id="SymOPTBL">OPTBL</span>           DFB     $12               ;ORA (ZPAG)
FEFF: 14                           DFB     $14               ;TRB ZPAG
FF00: 1A                           DFB     $1A               ;INC A
FF01: 1C                           DFB     $1C               ;TRB ABS
FF02: 32                           DFB     $32               ;AND (ZPAG)
FF03: 34                           DFB     $34               ;BIT ZPAG,X
FF04: 3A                           DFB     $3A               ;DEC A
FF05: 3C                           DFB     $3C               ;BIT ABS,X
FF06: 52                           DFB     $52               ;EOR (ZPAG)
FF07: 5A                           DFB     $5A               ;PHY
FF08: 64                           DFB     $64               ;STZ ZPAG
FF09: 72                           DFB     $72               ;ADC (ZPAG)
FF0A: 74                           DFB     $74               ;STZ ZPAG,X
FF0B: 7A                           DFB     $7A               ;PLY
FF0C: 7C                           DFB     $7C               ;JMP (ABS,X)
FF0D: 89                           DFB     $89               ;BIT IMM
FF0E: 92                           DFB     $92               ;STA (ZPAG)
FF0F: 9C                           DFB     $9C               ;STZ ABS
FF10: 9E                           DFB     $9E               ;STZ ABS,X
FF11: B2                           DFB     $B2               ;LDA (ZPAG)
FF12: D2                           DFB     $D2               ;CMP (ZPAG)
FF13: F2                           DFB     $F2               ;SBC (ZPAG)
FF14: FC                           DFB     $FC               ;??? (the unknown opcode)
                   ; 
                   ; INDX contains pointers to the mnemonics for each of
                   ; the opcodes in OPTBL.  Pointers with BIT 7
                   ; set indicate extensions to MNEML or MNEMR.
                   ; 
FF15: 38           <span id="SymINDX">INDX</span>            DFB     $38
FF16: FB                           DFB     $FB
FF17: 37                           DFB     $37
FF18: FB                           DFB     $FB
FF19: 39                           DFB     $39
FF1A: 21                           DFB     $21
FF1B: 36                           DFB     $36
FF1C: 21                           DFB     $21
FF1D: 3A                           DFB     $3A
FF1E: F8                           DFB     $F8
FF1F: FA                           DFB     $FA
FF20: 3B                           DFB     $3B
FF21: FA                           DFB     $FA
FF22: F9                           DFB     $F9
FF23: 22                           DFB     $22
FF24: 21                           DFB     $21
FF25: 3C                           DFB     $3C
FF26: FA                           DFB     $FA
FF27: FA                           DFB     $FA
FF28: 3D                           DFB     $3D
FF29: 3E                           DFB     $3E
FF2A: 3F                           DFB     $3F
FF2B: FC                           DFB     $FC               ;???
FF2C: 00                           DFB     $00

FF2D: A9 C5        <span id="SymPRERR">PRERR</span>           lda     #$C5              ;PRINT 'ERR', THEN FALL INTO
FF2F: 20 ED FD                     jsr     <a href="#Symcout">cout</a>              ; FWEEPER.
FF32: A9 D2                        lda     #$D2
FF34: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
FF37: 20 ED FD                     jsr     <a href="#Symcout">cout</a>
                   ; 
FF3A: A9 87        <span id="SymBELL">BELL</span>            lda     #$87              ;MAKE A JOYFUL NOISE, THEN RETURN.
FF3C: 4C ED FD                     jmp     <a href="#Symcout">cout</a>

FF3F: A5 48        <span id="SymRESTORE">RESTORE</span>         lda     <a href="#SymSTATUS">STATUS</a>            ;RESTORE 6502 REGISTER CONTENTS
FF41: 48                           pha                       ; USED BY DEBUG SOFTWARE
FF42: A5 45                        lda     <a href="#SymA5H">A5H</a>
FF44: A6 46        <span id="SymRESTR1">RESTR1</span>          ldx     <a href="#SymXREG">XREG</a>
FF46: A4 47                        ldy     <a href="#SymYREG">YREG</a>
FF48: 28                           plp
FF49: 60                           rts

FF4A: 85 45        <span id="SymSAVE">SAVE</span>            sta     <a href="#SymA5H">A5H</a>               ;SAVE 6502 REGISTER CONTENTS
FF4C: 86 46        <span id="SymSAV1">SAV1</span>            stx     <a href="#SymXREG">XREG</a>              ; FOR DEBUG SOFTWARE
FF4E: 84 47                        sty     <a href="#SymYREG">YREG</a>
FF50: 08                           php
FF51: 68                           pla
FF52: 85 48                        sta     <a href="#SymSTATUS">STATUS</a>
FF54: BA                           tsx
FF55: 86 49                        stx     <a href="#SymSPNT">SPNT</a>
FF57: D8                           cld
FF58: 60                           rts

FF59: 20 84 FE     <span id="SymOLDRST">OLDRST</span>          jsr     <a href="#SymSETNORM">SETNORM</a>           ;SET SCREEN MODE
FF5C: 20 2F FB                     jsr     <a href="#SymINIT">INIT</a>              ; AND INIT KBD/SCREEN
FF5F: 20 93 FE                     jsr     <a href="#SymSETVID">SETVID</a>            ; AS I/O DEVS.
FF62: 20 89 FE                     jsr     <a href="#SymSETKBD">SETKBD</a>
                   ; 
FF65: D8           <span id="SymMON">MON</span>             cld                       ;MUST SET HEX MODE!
FF66: 20 3A FF                     jsr     <a href="#SymBELL">BELL</a>              ;FWEEPER.
FF69: A9 AA        <span id="SymMONZ">MONZ</span>            lda     #$AA              ;'*' PROMPT FOR MONITOR
FF6B: 85 33                        sta     <a href="#SymPROMPT">PROMPT</a>
FF6D: 20 67 FD                     jsr     <a href="#SymGETLNZ">GETLNZ</a>            ;READ A LINE OF INPUT
FF70: 20 C7 FF                     jsr     <a href="#SymZMODE">ZMODE</a>             ;CLEAR MONITOR MODE, SCAN IDX
FF73: 20 A7 FF     <span id="SymNXTITM">NXTITM</span>          jsr     <a href="#SymGETNUM">GETNUM</a>            ;GET ITEM, NON-HEX
FF76: 84 34                        sty     <a href="#SymYSAV">YSAV</a>              ; CHAR IN A-REG
                   NOTE: ;SUBTBL-CHRTBL
FF78: A0 17                        ldy     #$17              ;X-REG=0 IF NO HEX INPUT
FF7A: 88           <span id="SymCHRSRCH">CHRSRCH</span>         dey
FF7B: 30 E8                        bmi     <a href="#SymMON">MON</a>               ;COMMAND NOT FOUND, BEEP &amp; TRY AGAIN.
FF7D: D9 CC FF                     cmp     <a href="#SymCHRTBL">CHRTBL</a>,Y          ;FIND COMMAND CHAR IN TABLE
FF80: D0 F8                        bne     <a href="#SymCHRSRCH">CHRSRCH</a>           ;NOT THIS TIME
FF82: 20 BE FF                     jsr     <a href="#SymTOSUB">TOSUB</a>             ;GOT IT! CALL CORRESPONDING SUBROUTINE
FF85: A4 34                        ldy     <a href="#SymYSAV">YSAV</a>              ;PROCESS NEXT ENTRY ON HIS LINE
FF87: 4C 73 FF                     jmp     <a href="#SymNXTITM">NXTITM</a>

FF8A: A2 03        <span id="SymDIG">DIG</span>             ldx     #$03
FF8C: 0A                           asl     A
FF8D: 0A                           asl     A                 ;GOT HEX DIGIT,
FF8E: 0A                           asl     A                 ; SHIFT INTO A2
FF8F: 0A                           asl     A
FF90: 0A           <span id="SymNXTBIT">NXTBIT</span>          asl     A
FF91: 26 3E                        rol     <a href="#SymA2L">A2L</a>
FF93: 26 3F                        rol     <a href="#SymA2H">A2H</a>
FF95: CA                           dex                       ;LEAVE X=$FF IF DIG
FF96: 10 F8                        bpl     <a href="#SymNXTBIT">NXTBIT</a>
FF98: A5 31        <span id="SymNXTBAS">NXTBAS</span>          lda     <a href="#SymMODE">MODE</a>
FF9A: D0 06                        bne     <a href="#SymNXTBS2">NXTBS2</a>            ;IF MODE IS ZERO,
FF9C: B5 3F                        lda     <a href="#SymA2H">A2H</a>,X             ; THEN COPY A2 TO A1 AND A3
FF9E: 95 3D                        sta     <a href="#SymA1H">A1H</a>,X
FFA0: 95 41                        sta     <a href="#SymA3H">A3H</a>,X
FFA2: E8           <span id="SymNXTBS2">NXTBS2</span>          inx
FFA3: F0 F3                        beq     <a href="#SymNXTBAS">NXTBAS</a>
FFA5: D0 06                        bne     <a href="#SymNXTCHR">NXTCHR</a>

FFA7: A2 00        <span id="SymGETNUM">GETNUM</span>          ldx     #$00              ;CLEAR A2
FFA9: 86 3E                        stx     <a href="#SymA2L">A2L</a>
FFAB: 86 3F                        stx     <a href="#SymA2H">A2H</a>
FFAD: 20 B4 C5     <span id="SymNXTCHR">NXTCHR</span>          jsr     <a href="#SymGETUP">GETUP</a>             ;Get char, iny, upshift
FFB0: 49 B0                        eor     #$B0
FFB2: C9 0A                        cmp     #$0A
FFB4: 90 D4                        bcc     <a href="#SymDIG">DIG</a>               ;it's a digit
FFB6: 69 88                        adc     #$88
FFB8: C9 FA                        cmp     #$FA
FFBA: 4C CB CF                     jmp     <a href="#SymLOOKASC">LOOKASC</a>           ;+ Check for quote

FFBD: 00                           DFB     $00               ;BRK

FFBE: A9 FE        <span id="SymTOSUB">TOSUB</span>           lda     #&gt;<a href="#SymGO">GO</a>              ;DISPATCH TO SUBROUTINE, BY
FFC0: 48                           pha                       ; PUSHING THE HI-ORDER SUBR ADDR,
FFC1: B9 E3 FF                     lda     <a href="#SymSUBTBL">SUBTBL</a>,Y          ; THEN THE LO-ORDER SUBR ADDR
FFC4: 48                           pha                       ; ONTO THE STACK,
FFC5: A5 31                        lda     <a href="#SymMODE">MODE</a>              ; (CLEARING THE MODE, SAVE THE OLD
FFC7: A0 00        <span id="SymZMODE">ZMODE</span>           ldy     #$00              ; MODE IN A-REG),
FFC9: 84 31                        sty     <a href="#SymMODE">MODE</a>
FFCB: 60                           rts                       ; AND 'RTS' TO THE SUBROUTINE!

FFCC: BC           <span id="SymCHRTBL">CHRTBL</span>          DFB     $BC               ;^C  (BASIC WARM START)
FFCD: B2                           DFB     $B2               ;^Y  (USER VECTOR)
FFCE: BE                           DFB     $BE               ;^E  (OPEN AND DISPLAY REGISTERS)
FFCF: 9A                           DFB     $9A               ;+!  (Mini assembler)
FFD0: EF                           DFB     $EF               ;V   (MEMORY VERIFY)
FFD1: C4                           DFB     $C4               ;^K  (IN#SLOT)
FFD2: A9                           DFB     $A9               ;^P  (PR#SLOT)
FFD3: BB                           DFB     $BB               ;^B  (BASIC COLD START)
FFD4: A6                           DFB     $A6               ;'-' (SUBSTRACTION)
FFD5: A4                           DFB     $A4               ;'+' (ADDITION)
FFD6: 06                           DFB     $06               ;M   (MEMORY MOVE)
FFD7: 95                           DFB     $95               ;'&lt;' (DELIMITER FOR MOVE, VFY)
FFD8: 07                           DFB     $07               ;N   (SET NORMAL VIDEO)
FFD9: 02                           DFB     $02               ;I   (SET INVERSE VIDEO)
FFDA: 05                           DFB     $05               ;L   (DISASSEMBLE 20 INSTRS)
FFDB: 00                           DFB     $00               ;G   (EXECUTE PROGRAM)
FFDC: 93                           DFB     $93               ;':' (MEMORY FILL)
FFDD: A7                           DFB     $A7               ;'.' (ADDRESS DELIMITER)
FFDE: C6                           DFB     $C6               ;'CR' (END OF INPUT)
FFDF: 99                           DFB     $99               ;BLANK
FFE0: EC                           DFB     $EC               ;+S  (Step)
FFE1: ED                           DFB     $ED               ;+T  (Trace)
FFE2: EA                           DFB     $EA               ;+
                   ; 
                   ; Table of low order monitor routine
                   ; dispatch addresses.
                   ; 
FFE3: B2           <span id="SymSUBTBL">SUBTBL</span>          DFB     &lt;<a href="#SymBASCONT">BASCONT</a>-1
FFE4: C9                           DFB     &lt;<a href="#SymUSR">USR</a>-1
FFE5: BE                           DFB     &lt;<a href="#SymREGZ">REGZ</a>-1
FFE6: 6B                           DFB     &lt;<a href="#SymMINI">MINI</a>-1
FFE7: 35                           DFB     &lt;<a href="#SymVERIFY">VERIFY</a>-1
FFE8: 8C                           DFB     &lt;<a href="#SymINPRT">INPRT</a>-1
FFE9: 96                           DFB     &lt;<a href="#SymOUTPRT">OUTPRT</a>-1
FFEA: AF                           DFB     &lt;<a href="#SymXBASIC">XBASIC</a>-1
FFEB: 17                           DFB     &lt;<a href="#SymSETMODE">SETMODE</a>-1
FFEC: 17                           DFB     &lt;<a href="#SymSETMODE">SETMODE</a>-1
FFED: 2B                           DFB     &lt;<a href="#SymMOVE">MOVE</a>-1
FFEE: 1F                           DFB     &lt;<a href="#SymLT">LT</a>-1
FFEF: 83                           DFB     &lt;<a href="#SymSETNORM">SETNORM</a>-1
FFF0: 7F                           DFB     &lt;<a href="#SymSETINV">SETINV</a>-1
FFF1: 5D                           DFB     &lt;<a href="#SymLIST">LIST</a>-1
FFF2: B5                           DFB     &lt;<a href="#SymGO">GO</a>-1
FFF3: 17                           DFB     &lt;<a href="#SymSETMODE">SETMODE</a>-1
FFF4: 17                           DFB     &lt;<a href="#SymSETMODE">SETMODE</a>-1
FFF5: F5                           DFB     &lt;<a href="#SymCRMON">CRMON</a>-1
FFF6: 03                           DFB     &lt;<a href="#SymBLANK">BLANK</a>-1
FFF7: 70                           DFB     &lt;<a href="#SymSTEPZ">STEPZ</a>-1
FFF8: 6E                           DFB     &lt;<a href="#SymTRACE">TRACE</a>-1
FFF9: 00                           DFB     $00
FFFA: FB 03                        DW      <a href="#SymNMI">NMI</a>               ;NON-MASKABLE INTERRUPT VECTOR
FFFC: 62 FA                        DW      <a href="#SymRESET">RESET</a>             ;RESET VECTOR
FFFE: 03 C8                        DW      <a href="#SymNEWIRQ">NEWIRQ</a>            ;INTERRUPT REQUEST VECTOR
                                   ADREND  ↑ ~$F800
                                   ADREND  ↑ $C000
</pre>


</div>

<!-- SymbolTable is optional; remove this entire section from the template if you don't want it -->
<div id="symbol-table">
    <h2>Symbol Table</h2>
<table>
  <tr><th>Label</th><th>Value</th></tr>  <tr><td><a href="#SymBASICINIT">BASICINIT</a></td><td><code>$C317</code></td></tr>
  <tr><td><a href="#Symchok">chok</a></td><td><code>$C130</code></td></tr>
  <tr><td><a href="#Symcout">cout</a></td><td><code>$FDED</code></td></tr>
  <tr><td><a href="#Symcout1">cout1</a></td><td><code>$FDF0</code></td></tr>
  <tr><td><a href="#SymCOUTZ">COUTZ</a></td><td><code>$FDF6</code></td></tr>
  <tr><td><a href="#Symentr1">entr1</a></td><td><code>$C111</code></td></tr>
  <tr><td><a href="#Symfixch">fixch</a></td><td><code>$C140</code></td></tr>
  <tr><td><a href="#SymHOME">HOME</a></td><td><code>$FC58</code></td></tr>
  <tr><td><a href="#SymHOOKUP">HOOKUP</a></td><td><code>$CE20</code></td></tr>
  <tr><td><a href="#SymKEYIN">KEYIN</a></td><td><code>$FD1B</code></td></tr>
  <tr><td><a href="#Symmoveirq">moveirq</a></td><td><code>$CFA0</code></td></tr>
  <tr><td><a href="#SymNOESCAPE">NOESCAPE</a></td><td><code>$FD44</code></td></tr>
  <tr><td><a href="#SymPASREAD">PASREAD</a></td><td><code>$CF35</code></td></tr>
  <tr><td><a href="#SymPINIT">PINIT</a></td><td><code>$CF41</code></td></tr>
  <tr><td><a href="#SymPSTATUS">PSTATUS</a></td><td><code>$CEB1</code></td></tr>
  <tr><td><a href="#SymPWRITE">PWRITE</a></td><td><code>$CEC2</code></td></tr>
  <tr><td><a href="#Symserisout">serisout</a></td><td><code>$C11C</code></td></tr>
  <tr><td><a href="#Symserrts">serrts</a></td><td><code>$C189</code></td></tr>
  <tr><td><a href="#Symservid">servid</a></td><td><code>$C144</code></td></tr>
  <tr><td><a href="#SymSET80">SET80</a></td><td><code>$CDBE</code></td></tr>
  <tr><td><a href="#Symsetup">setup</a></td><td><code>$C21C</code></td></tr>
  <tr><td><a href="#Symswzznm">swzznm</a></td><td><code>$C7E5</code></td></tr>
  <tr><td><a href="#Symtoofar">toofar</a></td><td><code>$C15C</code></td></tr>
</table>

</div>

<div id="footer">
    <hr/>
    <p>HTML generated by <a href="https://6502bench.com/">6502bench SourceGen</a> v1.8.4
    on 2023/03/05 <!--14:40:01 -06:00--></p>
    <p>Expression style: Merlin</p>
    <!-- parameters: cols=16,8,18,100;extraCols=Address,Bytes;byteSpc=True;commaBulk=True;nonuPfx=':';varPfx=']';labelBrk=False;notes=True;gfx=True;opWrap=32 -->
</div>

</body>
</html>
